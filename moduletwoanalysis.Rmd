---
title: "module2_eco_pol_factors"
output:
  html_document:
    fig_width: 7
    fig_height: 6
    fig_caption: yes
    keep_md: yes
    theme: paper
    df_print: paged
  
---

```{r load packages, warning = FALSE, message = FALSE, echo=FALSE}
  knitr::opts_chunk$set(warning = FALSE, message = FALSE)

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(hablar))
suppressPackageStartupMessages(library(tsibble))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(DT))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(ggbiplot))

```

The module2 of the survey on the perception of risk and benefit from energy technologies in India. 

Following is the complete data set with 1099 responses. 

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
moduletwo <- read_excel( "~/Desktop/thesis_surveydata/political_factors_complete.xlsx")
save(moduletwo, file = "moduletwo.rda")
module2 <- data.frame(moduletwo)
module2[module2 == "Rather not say/ Don't know"] <- "Rather not say/Don't know"
module2 %>%
  filter(!row_number() %in% c(1,2))

# loaded data set for module 2 eco -pol variables and removes the rows with question number and question text
```


Following graph show the distribution of perceived risk on the likert scale



```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
 
#plotting perceived risk from different technologies

module2%>%
  filter(!row_number() %in% c(1,2)) %>% 
  select(starts_with("RISKY"))%>%
  gather(Technology, Perceived_Risk, Risky_Hydro:Risky_INDLPG, factor_key = TRUE)%>%
  separate(Technology, c("Risky", "Technology"), extra = "merge", fill = "left")%>%
  select(-Risky) %>%
  group_by(Technology, Perceived_Risk) %>%
  dplyr::summarise(n=n())

colorsequence<- c("#8C4646","#D9695F","#F2A679","#F2D091","#5D8C7B","#808080")
df_barplot<-module2%>%
  filter(!row_number() %in% c(1,2)) %>% 
  select(starts_with("RISKY"))%>%
  gather(Technology, Perceived_Risk, Risky_Hydro:Risky_INDLPG, factor_key = TRUE)%>%
  separate(Technology, c("Risky", "Technology"), extra = "merge", fill = "left")%>%
  select(-Risky) %>% 
  group_by(Technology, Perceived_Risk) %>%
  dplyr::summarise(n=n())


df_barplot %>% ggplot(aes(fill= fct_rev(factor(Perceived_Risk, levels=c("Extremely risky", "Very risky","Moderately risky","Slightly risky","Not at all risky","Rather not say/Don't know"))), y=n , x=Technology)) + 
  geom_bar(position="fill",stat="identity")+
  scale_x_discrete(limits = c("Solar", "INDSolar", "INDFirewoodetc" ,"Wind" , "Hydro", "INDWind", "INDHydro", "INDDiesel" , "INDBiogas","INDKerosene", "Oil", "Coal","Gas", "INDLPG","Nuclear"))+
  scale_fill_manual("legend", values = c("Extremely risky" = "#8C4646", "Very risky" = "#D9695F", "Moderately risky" = "#F2A679", "Slightly risky" = "#F2D091","Not at all risky" = "#5D8C7B", "Rather not say/Don't know" = "grey94"))+
  coord_flip()+
  theme_classic()


```


Following graph show the distribution of perceived  benefit on the likert scale



```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)


df_barplotben <- module2%>%
  filter(!row_number() %in% c(1,2)) %>% 
  select(starts_with("Ben"))%>%
  gather(Technology, Perceived_Benefit, Ben_Hydro:Ben_INDKerosene, factor_key = TRUE)%>%
  separate(Technology, c("Ben", "Technology"), extra = "merge", fill = "left")%>%
  select(-Ben) %>% 
  group_by(Technology, Perceived_Benefit) %>%
  dplyr::summarise(n=n())


df_barplotben %>% ggplot(aes(fill= factor(Perceived_Benefit, levels=c("Rather not say/Don't know","Not at all beneficial","Slightly beneficial","Moderately beneficial","Very beneficial", "Extremely beneficial")), y=n , x=Technology)) + 
  geom_bar(position="fill",stat="identity")+
  scale_fill_manual("legend", values = c("Rather not say/Don't know" = "grey94" ,"Not at all beneficial" = "orange","Slightly beneficial"="yellow" ,"Moderately beneficial" = "palegreen","Very beneficial"= "green3", "Extremely beneficial"= "green4"))+
  scale_x_discrete(limits = c("Solar", "INDSolar", "INDFirewoodetc" , "INDLPG", "Wind" , "Hydro", "INDWind", "INDHydro", "INDDiesel" , "INDBiogas","INDKerosene", "Oil", "Coal","Gas","Nuclear"))+
  theme_classic()+
  coord_flip()

# fix Rather not say issue.

```



Now I am converting the likert scale for various scales used in the survey to numeric values from 1 to 5, Rather Not Say/Don't know is printed as NA. Some variables had to be reverse coded as well. 

```{r, eval =TRUE, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
#This chunk contains the coding schemes of various scales used in survey one: eco-political factors, kahan scale and acceptance scale
codedmodule2 <- module2 %>%
  
#remove row 1
  filter(!row_number() %in% c(1,2)) %>% 
  
# replace risky likert scale with numbers
  mutate_at(vars(starts_with("Risky")), funs(case_when(. =="Not at all risky" ~ 1, 
                                                       . =="Slightly risky" ~ 2, 
                                                       . =="Moderately risky" ~ 3, 
                                                       . =="Very risky" ~ 4, 
                                                       . =="Extremely risky" ~ 5))) %>%

# replace beneficial likert scale with numbers  
  mutate_at(vars(starts_with("Ben")), funs(case_when(. =="Not at all beneficial" ~ 1,
                                                     . =="Slightly beneficial" ~ 2,
                                                     . =="Moderately beneficial" ~ 3,
                                                     . =="Very beneficial" ~ 4,
                                                     . =="Extremely beneficial" ~ 5 ))) %>%

# replace nuclear acceptance likert scale with numbers
  mutate_at(vars(N_accept,N_reluctantlyaccept,N_reject), funs(case_when(. == "Strongly disagree" ~ 1, 
                                                                        . == "Somewhat disagree" ~ 2,
                                                                        . == "Neither agree nor disagree" ~3,
                                                                        . == "Somewhat agree" ~ 4,
                                                                        . == "Strongly agree" ~ 5))) %>%
  
# code likert scale for variables for Kahan scale into numbers
  mutate_at(vars(starts_with (c("K_I","K_H","DISPLACE", "POLLUTE", "HEALTH", "JOBS", "BEAUTY", "PRIDE", "NPRIDE", "DEV", "PROSPER", "RELY"))), funs(case_when(. == "Strongly disagree" ~ 1, 
               . == "Somewhat disagree" ~ 2,
               . == "Neither agree nor disagree" ~3,
               . == "Somewhat agree" ~ 4,
               . == "Strongly agree" ~ 5))) %>%
  
# reverse code for likert scale for variables for Kahan scale into numbers
  mutate_at(vars(starts_with (c("K_S","K_E"))), funs(case_when(. == "Strongly disagree" ~ 5, 
                                                               . == "Somewhat disagree" ~ 4,
                                                               . == "Neither agree nor disagree" ~3,
                                                               . == "Somewhat agree" ~ 2,
                                                               . == "Strongly agree" ~ 1))) %>%

# code eco-pol scale variables into numbers
  mutate_at(vars(SYSTEMDEMO,SYSTEMRELIGION,SYSTEMTECHNO,SYSTEMTOTAL,WEALTHLIM,MECHANISATION,DECISIONDECEN,INDUSTRYLARGE,ECONOMYGLOBAL,OWNERPVT,OWNERNOREG), funs(case_when(. == "Strongly disagree" ~ 1, 
                        . == "Somewhat disagree" ~ 2,
                        . == "Neither agree nor disagree" ~3,
                        . == "Somewhat agree" ~ 4,
                        . == "Strongly agree" ~ 5))) %>%

# reverse code eco-pol scale variables into numbers 
 mutate_at(vars(DECISIONCEN, INDUSTRYSMALL, ECONOMYLOCAL, ENVOVERDEV,OWNERPUB, OWNERREG), funs(case_when(. == "Strongly disagree" ~ 5, 
                                                                                                         . == "Somewhat disagree" ~ 4,
                                                                                                         . == "Neither agree nor disagree" ~3,
                                                                                                         . == "Somewhat agree" ~ 2,
                                                                                                         . == "Strongly agree" ~ 1)))

codedmodule2
```




Following table shows the summary statistics of perceived risk from different energy technologies. 

```{r, eval=TRUE, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# summary statistics for risks from different energy sources

risksummary <- codedmodule2 %>%
  summarize_at(vars(starts_with(c("RISKY"))), list(~mean(., na.rm = TRUE), ~median(., na.rm = TRUE), ~sd(.,na.rm = TRUE),~var(.,na.rm = TRUE), ~n())) %>%
  #add row index so later spreading indexed correctly
  add_rownames()%>%
  #melt to long format
  gather(technology, value, -rowname) %>%
  # separate risky from variable suffix
  separate(technology, c("Risky", "var"), extra = "merge", fill = "left") %>%
  #separate mean from variable prefix
  separate(var, c("technology", "summary")) %>%
  # spread summary values back to wide form
  spread(summary,value) %>%
  #clean up
  select(-rowname, -Risky) %>%
  arrange(mean) %>%
  setNames(paste0('perceivedrisk.', names(.))) %>%
  dplyr::rename(technology= perceivedrisk.technology)

risksummary


```


Following table shows the summary statistics of perceived benefit from different energy technologies. 

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# summary statistics for benefits from different energy sources

benefitsummary <- codedmodule2 %>%
  summarize_at(vars(starts_with(c("Ben"))), list(~mean(., na.rm = TRUE), ~median(., na.rm = TRUE), ~sd(.,na.rm = TRUE),~var(.,na.rm = TRUE), ~n())) %>%
  #add row index so later spreading indexed correctly
  add_rownames()%>%
  #melt to long format
  gather(technology, value, -rowname) %>%
  # separate Ben from variable suffix
  separate(technology, c("Ben", "var"), extra = "merge", fill = "left") %>%
  #separate mean from variable prefix
  separate(var, c("technology", "summary")) %>%
  # spread summary values back to wide form
  spread(summary,value) %>%
  #clean up
  select(-rowname, -Ben) %>%
  arrange(mean)%>%
  setNames(paste0('perceivedbenefit.', names(.))) %>%
  dplyr::rename(technology = perceivedbenefit.technology)
benefitsummary

#round off to two decimal places
```


bar plots for means of perceived risk and benefit from various energy technologies

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

full_join(risksummary,benefitsummary, by = NULL, copy = FALSE, keep = FALSE) %>%
  select(technology, perceivedrisk.mean, perceivedbenefit.mean) %>%
  mutate(technology = fct_reorder(technology, perceivedrisk.mean, .desc = TRUE))%>%
   gather(key = "level", value = "mean",
       perceivedrisk.mean, perceivedbenefit.mean) %>%
  ggplot(aes(x=technology, y= mean, fill = level, ))+
  geom_bar(stat="identity", position=position_dodge())+
  ylim(0,4)+
  scale_fill_manual("legend", values = c("perceivedbenefit.mean" = "palegreen3", "perceivedrisk.mean" = "firebrick2"))+
  coord_flip()


```



bar plots for median of perceived risk and benefit from various energy technologies

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
  
full_join(risksummary,benefitsummary, by = NULL, copy = FALSE, keep = FALSE) %>%
  select(technology, perceivedrisk.median, perceivedbenefit.median) %>%
  mutate(technology = fct_reorder(technology, perceivedrisk.median, .desc = TRUE))%>%
   gather(key = "level", value = "median",
       perceivedrisk.median, perceivedbenefit.median) %>%
  ggplot(aes(x=technology, y= median, fill = level, ))+
  geom_bar(stat="identity", position=position_dodge())+
  ylim(0,4)+
  scale_fill_manual("legend", values = c("perceivedbenefit.median" = "palegreen3", "perceivedrisk.median" = "firebrick2"))+
  coord_flip()
  

```





Conducted PCA on all independent variables in the data set. The following table shows the variables that are part of the resultant principal components. 


```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

#PCA on all variables

pcaresults <- codedmodule2 %>%
  select(!starts_with(c("Risky","BEN", "Gender","Caste","Religion","State", "Age", "Otherreligion", "Urban_Rural","Language", "Survey_Date", "N_accept", "N_reject", "N_reluctantlyaccept")))%>%
  na.omit()%>%
  prcomp(center = TRUE, scale. = TRUE)

rotations = pcaresults["rotation"]

#calculate total variance explained by each principal component
var_explained <- pcaresults$sdev^2 / sum(pcaresults$sdev^2)


rotationsDF <- do.call(rbind.data.frame, rotations)
rotationsDF
```




Following tibble shows variance explained by each Principal component 

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

data.frame(var_explained, row.names=names(rotationsDF))
  
```

Scree plot of the previous table. Including only till PC7

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

qplot(c(1:90), var_explained) + 
  geom_line() + 
  xlab("Principal Component") + 
  ylab("Variance Explained") +
  ggtitle("Scree Plot") +
  ylim(0, 0.20)+
  xlim(1,7)

```




Coding and Combining items on Kahan scale 

Median score for Kahan on invidualism scale 

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

#median score for Kahan invidualism scale 

codedmodule2 %>%
  select((starts_with(c("K_I", "K_S"))))%>%
  gather(key = "K_I", value = "score")%>%
  na.omit()%>%
  summarise(median = median(c(score)))


```

Kahan scale median score for Hierarchy scale


```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# Kahan scale median score for Hierarchy scale
codedmodule2 %>%
  select((starts_with(c("K_H", "K_E"))))%>%
  gather(key = "K_H", value = "score")%>%
  na.omit()%>%
  summarise(median = median(c(score)))
```

Calculating individualism score and hierarchy score for each respondent


```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
#calculating individualism score and hierarchy score for each respondent

Kscalescores <- codedmodule2 %>%
  select(starts_with(c("Risky","K_I","K_S", "K_H", "K_E")))%>%
  rowwise()%>%
  na.omit()%>%
  dplyr::mutate(Individualism_score = mean(c_across(K_IINTRFER:K_SPROTECT)))%>%
  dplyr::mutate(Hierarchy_score = mean(c_across(K_HEQUAL:K_ERADEQ2)))%>%
  dplyr::select(!starts_with(c("K_I","K_S", "K_H", "K_E")))

Kscalescores


```


scatter plot of Kahan scale scores around the median scores on Individualism and Hierarchy scales.

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

#scatter plot of Kahan scale scores around the median scores on Individualism and Hierarchy scales. 

Kscalescores %>%
  ggplot(aes(Individualism_score, Hierarchy_score))+
  geom_point()+
  geom_hline(yintercept=2, colour="black", lwd=1)+
  geom_vline(xintercept=3, colour="black", lwd=1)


```

checking distribution of scores on Individualism scale

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
# checking distribution of scores on Individualism scale 

Kscalescores %>%
  ggplot(aes(x=Individualism_score, y = ..count..), fill = "lightgray")+
  geom_density()
  


```





checking distribution of scores on Hierarchy scale 
```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
# checking distribution of scores on Hierarchy scale 
Kscalescores %>%
  ggplot(aes(x=Hierarchy_score, y = ..count..), fill = "lightgray")+
  geom_density()
```

Coding and combining items on the eco-political scale - characteristics of the perceiver


```{r, echo= FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
ecopolscalescores <- codedmodule2 %>%
  select(starts_with(c("Risky","SYSTEMDEMO","SYSTEMRELIGION","SYSTEMTECHNO","SYSTEMTOTAL","WEALTHLIM","MECHANISATION","DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","INDUSTRYSMALL","ECONOMYGLOBAL","ECONOMYLOCAL", "ENVOVERDEV","DEVOVERENV","OWNERPVT","OWNERNOREG","OWNERPUB", "OWNERREG", "Gender","Caste","Religion", "State")))%>%
  rowwise()%>%
  na.omit()%>%
  dplyr::mutate(Pro_decentralisation = mean(c_across("DECISIONDECEN":"DECISIONCEN")))%>%
   dplyr::mutate(Pro_largescale = mean(c_across("INDUSTRYLARGE":"INDUSTRYSMALL")))%>%
   dplyr::mutate(Pro_global = mean(c_across("ECONOMYGLOBAL":"ECONOMYLOCAL")))%>%
   dplyr::mutate(Pro_ecogrowth = mean(c_across("ENVOVERDEV":"DEVOVERENV")))%>%
   dplyr::mutate(Pro_private = mean(c_across("OWNERPVT":"OWNERREG")))%>%
  dplyr::select(!c("DECISIONDECEN","DECISIONCEN", "INDUSTRYLARGE","INDUSTRYSMALL","ECONOMYGLOBAL", "ECONOMYLOCAL","ENVOVERDEV",     "DEVOVERENV","OWNERPVT","OWNERNOREG","OWNERPUB", "OWNERREG"))

ecopolscalescores
```

PCA test on the new eco-pol scale - characteristics of the perceiver

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
# PCA test on qualities of the perceiver

ecopolscalepca <- ecopolscalescores %>%
  select(!starts_with(c("Risky","Gender","Caste","Religion","State")))%>%
  prcomp(center = TRUE,scale. = TRUE)


var_explained_ecopol = ecopolscalepca$sdev^2 / sum(ecopolscalepca$sdev^2)

summary(ecopolscalepca)

```




```{r, echo=FALSE}

rotationsecopol = ecopolscalepca["rotation"]
rotationsDFecopol <- do.call(rbind.data.frame, rotationsecopol)
rotationsDFecopol
```



```{r, echo=FALSE}

qplot(c(1:11), var_explained_ecopol) + 
  geom_line() + 
  xlab("Principal Component") + 
  ylab("Variance Explained") +
  ggtitle("Scree Plot") +
  ylim(0.05, 0.20)+
  xlim(1,7)

```







