---
title: "models with mice"
output:
  pdf_document:
    toc: yes
    toc_depth: 2
    keep_tex: yes
    keep_md: yes
    latex_engine: xelatex
geometry: "left=0.5cm,right=0.5cm,top=0.5cm,bottom=0.5cm"
header-includes:
  - \usepackage{dcolumn}
  - \usepackage{array}
  - \usepackage{pdflscape}
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
html_document:
  toc: yes
  toc_depth: '2'
  df_print: paged
---


```{r load packages, warning = FALSE, message = FALSE, echo=FALSE}
  knitr::opts_chunk$set(warning = FALSE, message = FALSE)

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(tidyr))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(lavaan))
suppressPackageStartupMessages(library(tsibble))
suppressPackageStartupMessages(library(DT))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(psych)) 
suppressPackageStartupMessages(library(foreign))
suppressPackageStartupMessages(library(MASS))
suppressPackageStartupMessages(library(Hmisc))
suppressPackageStartupMessages(library(reshape2))
suppressPackageStartupMessages(library(naniar))
suppressPackageStartupMessages(library(mice))
library(officer)
library(magrittr)
library(kableExtra)


```

```{r setup, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

moduletwo <- read_excel(here::here("thesis_surveydata/political_factors_complete.xlsx"))
module2 <- data.frame(moduletwo)
module2[module2 == "Rather not say/ Don't know"] <- "Rather not say/Don't know"



# loaded data set for module 2 eco -pol variables and removes the rows with question number and question text
```

```{r, eval =TRUE, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
#This chunk contains the coding schemes of various scales used in survey one: eco-political factors, kahan scale and acceptance scale
codedmodule2 <- module2 %>%
  
#remove row 1
  filter(!row_number() %in% c(1,2)) %>% 
  
# replace risky likert scale with numbers
  mutate_at(vars(starts_with("Risky")), funs(case_when(. =="Not at all risky" ~ 1, 
                                                       . =="Slightly risky" ~ 2, 
                                                       . =="Moderately risky" ~ 3, 
                                                       . =="Very risky" ~ 4, 
                                                       . =="Extremely risky" ~ 5))) %>%

# replace beneficial likert scale with numbers  
  mutate_at(vars(starts_with("Ben")), funs(case_when(. =="Not at all beneficial" ~ 1,
                                                     . =="Slightly beneficial" ~ 2,
                                                     . =="Moderately beneficial" ~ 3,
                                                     . =="Very beneficial" ~ 4,
                                                     . =="Extremely beneficial" ~ 5 ))) %>%

# replace nuclear acceptance likert scale with numbers
  mutate_at(vars(N_accept,N_reluctantlyaccept,N_reject), funs(case_when(. == "Strongly disagree" ~ 1, 
                                                                        . == "Somewhat disagree" ~ 2,
                                                                        . == "Neither agree nor disagree" ~3,
                                                                        . == "Somewhat agree" ~ 4,
                                                                        . == "Strongly agree" ~ 5))) %>%
  
  
# code likert scale for variables for Kahan scale into numbers
  mutate_at(vars(starts_with (c("K_S","K_E","DISPLACE", "POLLUTE", "HEALTH", "JOBS", "BEAUTY", "PRIDE", "NPRIDE","DEV","PROSPER", "RELY"))), funs(case_when(. == "Strongly disagree" ~ 1, 
               . == "Somewhat disagree" ~ 2,
               . == "Neither agree nor disagree" ~3,
               . == "Somewhat agree" ~ 4,
               . == "Strongly agree" ~ 5))) %>%
  
# NO reverse code for likert scale for variables for Kahan scale into numbers
  mutate_at(vars(starts_with (c("K_H","K_I"))), funs(case_when(. == "Strongly disagree" ~ 1, 
                                                               . == "Somewhat disagree" ~ 2,
                                                               . == "Neither agree nor disagree" ~3,
                                                               . == "Somewhat agree" ~ 4,
                                                               . == "Strongly agree" ~ 5))) %>%

# code eco-pol scale variables into numbers
mutate_at(vars(SYSTEMDEMO,SYSTEMRELIGION,SYSTEMTECHNO,SYSTEMTOTAL,WEALTHLIM,MECHANISATION,DECISIONDECEN,INDUSTRYSMALL,ECONOMYLOCAL,ENVOVERDEV,OWNERPUB, OWNERREG), funs(case_when(. == "Strongly disagree" ~ 1, 
                        . == "Somewhat disagree" ~ 2,
                        . == "Neither agree nor disagree" ~3,
                        . == "Somewhat agree" ~ 4,
                        . == "Strongly agree" ~ 5))) %>%

# NO reverse code eco-pol scale variables into numbers 
 mutate_at(vars(DECISIONCEN,INDUSTRYLARGE,ECONOMYGLOBAL,OWNERPVT,OWNERNOREG), funs(case_when(. == "Strongly disagree" ~ 1, 
                                                                                                         . == "Somewhat disagree" ~ 2,
                                                                                                         . == "Neither agree nor disagree" ~3,
                                                                                                         . == "Somewhat agree" ~ 4,
                                                                                                         . == "Strongly agree" ~ 5))) %>%
  mutate_all(~ifelse(. == "Rather not say/ Don't know", "Rather not say/Don't know", .))%>%
  mutate_all(~ifelse(. == "West bengal", "West Bengal", .))%>%
  mutate_all(~ifelse(. == "WEST BENGAL", "West Bengal", .))%>%
  mutate_all(~ifelse(. == "Up", "Uttar Pradesh", .))%>%
  mutate_all(~ifelse(. == "Tamilnadu", "Tamil Nadu", .))%>%
  mutate_all(~ifelse(. == "UP", "Uttar Pradesh", .))
  

#sum(is.na(codedmodule2)) # 13 % of the data is missing. 

```



# Bar plot: STATE X PDEVELOP

```{r, echo = FALSE}

# Load necessary libraries
library(dplyr)
library(ggplot2)
library(forcats)

# Df to include relevant variables 

WBques <- module2 %>%  filter(!row_number() %in% c(1,2)) %>% dplyr::select(State, DISPLACENUCLEAR, HEALTHNUCLEAR, BEAUTYNUCLEAR, POLLUTENUCLEAR ) %>%
  mutate_all(~ifelse(. == "Rather not say/ Don't know", "Rather not say/Don't know", .))%>%
  mutate_all(~ifelse(. == "West bengal", "West Bengal", .))%>%
  mutate_all(~ifelse(. == "WEST BENGAL", "West Bengal", .))%>%
  mutate_all(~ifelse(. == "Up", "Uttar Pradesh", .))%>%
  mutate_all(~ifelse(. == "Tamilnadu", "Tamil Nadu", .))%>%
  mutate_all(~ifelse(. == "UP", "Uttar Pradesh", .))

levels_defined <- c("Strongly agree", "Somewhat agree","Neither agree nor disagree", "Somewhat disagree","Strongly disagree","Rather not say/Don't know")


WBques_factors <- WBques
WBques_factors[] <- lapply(names(WBques_factors), function(colname) {
  if (colname != "State") {
    factor(WBques_factors[[colname]], levels = levels_defined)
  } else {
    WBques_factors[[colname]] # Keep the State column unchanged
  }
})

WBques_factors$State <- factor(WBques_factors$State, 
                               levels = c("West Bengal", "Uttar Pradesh", "Maharashtra", "Rajasthan", "Tamil Nadu"))


library(dplyr)
library(ggplot2)

# Assuming your updated data frame is named WBques_factors

# Create a summary table with counts for each level of DISPLACENUCLEAR within each State
WBques_summary <- WBques_factors %>%
  count(State, DISPLACENUCLEAR) %>%
  group_by(State) %>%
  mutate(Proportion = n / sum(n))

# Create a named vector with full statements for each variable
full_statements <- c(DISPLACENUCLEAR = "Nuclear energy is leading to displacement of people from their land",
                     BEAUTYNUCLEAR = "Nuclear energy spoils the natural beauty of the landscape",
                     POLLUTENUCLEAR = "Nuclear energy increases pollution of air/water/land",
                     HEALTHNUCLEAR = "Nuclear energy poses a great risk to the health of people living around it",
                     ENVOVERDEV = "Polluting industries that spoil the environment should be shut down even if it costs people their jobs")

# Reshape the data to long format for the selected variables
WBques_long <- WBques_factors %>%
  pivot_longer(cols = c(DISPLACENUCLEAR, HEALTHNUCLEAR, BEAUTYNUCLEAR, POLLUTENUCLEAR),
               names_to = "Question",
               values_to = "Response") %>%
  mutate(Question = recode(Question, !!!full_statements)) # Replace var names with full statements

# Create a summary table with proportions for each level of Response within each State and Question
WBques_summary <- WBques_long %>%
  count(State, Question, Response) %>%
  group_by(State, Question) %>%
  mutate(Proportion = n / sum(n))

# Define the color sequence, with the darkest red for "Strongly agree"
colorsequence <- c("#8C4646","#D9695F","#F2A679","#F2D091","#FFF2CC","#808080")

# Plot the graph with facets for each Question
#ggplot(WBques_summary, aes(x = State, y = Proportion, fill = factor(Response, levels = rev(levels_defined)))) +
  #geom_bar(stat = "identity", position = "fill") +
  #scale_fill_manual(values = rev(colorsequence), name = NULL) +
  #facet_wrap(~ Question, scales = "free_y", ncol = 1) +
  #coord_flip() +
  #labs(x = "State", y = "Proportion", title = "Proportion of Responses by State for Nuclear energy related questions") +
  #theme_minimal() +
  #theme(
    # Increase the size of the main title
    #plot.title = element_text(size = 16, face = "bold"),
    # Increase the size of the axis titles
    #axis.title = element_text(size = 14),
    # Increase the size of the facet strip text
    #strip.text.x = element_text(size = 12),
    # Adjust text angle for State labels if necessary
    #axis.text.y = element_text(angle = 0)
  #)

```


# barplot of demographics 


```{r, echo=FALSE}

library(dplyr)
library(tidyr)


demobar <- codedmodule2 %>% 
  dplyr::select("State", "Language", "age", "urban_rural", "gender", "caste" ,"religion") %>%
              mutate_all(~ifelse(. == "Rather not say/ Don't know", "Rather not say/Don't know", .))%>%
              mutate_all(~ifelse(. == "OBC", "Other Backward Classes (OBC)", .))%>%
              mutate_all(~ifelse(. == "SC", "Scheduled caste (SC)", .))%>%
              mutate_all(~ifelse(. == "ST", "Scheduled tribe (ST)", .))%>%
              mutate_all(~ifelse(. == "MAR", "Marathi", .))%>%
              mutate_all(~ifelse(. == "TA", "Tamil", .)) %>%
              mutate_all(~ifelse(. == "EN", "English", .))%>%
              mutate_all(~ifelse(. == "BN", "Bengali", .))%>%
              mutate_all(~ifelse(. == "MAR", "Marathi", .))%>%
              mutate_all(~ifelse(. == "HI", "Hindi", .))%>%
              na.omit()

#changing factor levels for each variable from high to low n 

demobar$State <- factor(demobar$State, levels = c("Rajasthan", "Maharashtra","West Bengal" , "Tamil Nadu", "Uttar Pradesh"))
demobar$Language <- factor(demobar$Language, levels = c("Hindi","Marathi","Bengali","Tamil", "English"))
demobar$age <- factor(demobar$age, levels = c( "18-24 years old" ,  "25-34 years old","35-44 years old", "45-54 years old", "55-64 years old","65-74 years old","75 years or older"  ))
demobar$urban_rural <- factor(demobar$urban_rural, levels = c("Rural","Urban"))
demobar$gender <- factor(demobar$gender, levels = c("Male","Female"))
demobar$caste <- factor(demobar$caste, levels = c("Scheduled tribe (ST)", "Scheduled caste (SC)", "Other Backward Classes (OBC)", "General","Brahmin","Rather not say/Don't know"))
demobar$religion <- factor(demobar$religion, levels = c("Hinduism", "Islam", "Christanity","Buddhism","Agnostism/ Atheism","Other (Please mention)"))


```

```{r, echo=FALSE, fig.width=11, fig.height=14, out.width='80%', out.height='80%'}

# Loading the required libraries
library(tidyverse)
library(gridExtra)
library(scales)

# Function to create bar plot
create_bar_plot <- function(data, variable_name, palette_name) {
  factor_levels <- levels(demobar[[variable_name]])
  data %>%
    filter(Variable == variable_name) %>%
    mutate(Category = factor(Category, levels = factor_levels)) %>%
    ggplot(aes(y = "", x = Percentage, fill = Category)) +
    geom_bar(position = "fill", stat = "identity", width = 1) +
    geom_text(aes(label = paste0(round(Percentage, 0), "%")), 
              position =  position_fill(vjust = 0.5)) +
    scale_x_continuous(labels = percent) +
    labs(y = NULL, x = "Percentage", fill = variable_name) +
    theme_classic() +
    theme(axis.text.y = element_blank(), strip.text = element_text(size = 10), legend.position = "top") +
    scale_fill_brewer(palette = palette_name)
}

# Gather data to long format and calculate counts and percentages
df_barplot <- demobar %>%
  gather(Variable, Category) %>%
  group_by(Variable, Category) %>%
  filter(!is.na(Category)) %>%
  summarise(n = n()) %>%
  mutate(Percentage = n / sum(n) * 100)

# Create separate plots for each variable
plot_state <- create_bar_plot(df_barplot, "State", "Spectral")
plot_language <- create_bar_plot(df_barplot, "Language", "Paired")
plot_age <- create_bar_plot(df_barplot, "age", "Set3")
plot_urban_rural <- create_bar_plot(df_barplot, "urban_rural", "Dark2")
plot_gender <- create_bar_plot(df_barplot, "gender", "Pastel1")
plot_caste <- create_bar_plot(df_barplot, "caste", "Set1")
plot_religion <- create_bar_plot(df_barplot, "religion", "Set2")

# Combine the plots with spacing
combined_plot <- gridExtra::arrangeGrob(plot_state, plot_language, plot_age, plot_urban_rural, plot_gender, plot_caste, plot_religion, ncol = 1, heights = c(1, 1, 1, 1, 1, 1, 1))

# Print the combined plot
#grid::grid.newpage()
#grid::grid.draw(combined_plot)

```




# Can do something with accept, reject and reluctantly accept. 

```{r, echo=FALSE}

## Can do something with accept, reject and reluctantly accept. 

#n_acceptreject<- module2 %>%
                #dplyr::select("N_accept", "N_reluctantlyaccept", "N_reject")

#summary(n_acceptreject)
```

# FORMICE DATASET

```{r, echo=FALSE}


formice1 <- codedmodule2[, grep("State|age|urban_rural|gender|caste|religion|Solar|SOLAR|Nuclear|NUCLEAR|Coal|COAL|K_S|K_E|K_H|K_I|WEALTHLIM|MECHANISATION|DECISIONDECEN|INDUSTRYSMALL|ECONOMYLOCAL|ENVOVERDEV|DEVOVERENV|OWNERPUB|OWNERREG|DECISIONCEN|INDUSTRYLARGE|ECONOMYGLOBAL|OWNERPVT|OWNERNOREG", names(codedmodule2))]%>%
        dplyr::select(-c("Language", "Risky_INDSolar", "Ben_INDSolar", "religiontext")) %>%
          mutate(across(age, ~factor(.x, ordered = TRUE)))%>%  
          mutate(across(urban_rural:religion, ~factor(.x, ordered = FALSE)))%>%
          mutate(across(State, ~factor(.x, ordered = FALSE))) %>%
          mutate(Uppercaste = ifelse(caste %in% c('Brahmin', 'General'), 1, 0)) %>%
          mutate(Male = ifelse(gender == 'Male', 1, 0))%>%
          mutate(Hindu = ifelse(religion == 'Hinduism', 1, 0))%>%
          mutate(Age = case_when(
                                  age == "18-24 years old" ~ 1,
                                  age == "25-34 years old" ~ 2,
                                  age == "35-44 years old" ~ 3,
                                  age == "45-54 years old" ~ 4,
                                  age == "55-64 years old" ~ 5,
                                  age == "65-74 years old" ~ 6,
                                  age == "75 years or older" ~ 7))
  

#dplyr:: select(starts_with (c("State", "age", "urban_rural", "gender", "caste", "religion","Risky_Solar", "Risky_Nuclear", "Risky_Coal", "Ben_Solar","Ben_Nuclear","Ben_Coal","K_S","K_E","K_H","K_I", "DISPLACE", "POLLUTE", "HEALTH", "JOBS", "BEAUTY", "PRIDE", "NPRIDE","DEV", "PROSPER", "RELY", "WEALTHLIM", "MECHANISATION", "DECISIONDECEN", "INDUSTRYSMALL", "ECONOMYLOCAL", "ENVOVERDEV", "OWNERPUB", "OWNERREG", "DECISIONCEN","INDUSTRYLARGE","ECONOMYGLOBAL","OWNERPVT","OWNERNOREG" )))

library(dplyr)

formice <- formice1 %>%
  mutate(across(Risky_Solar:age, ~factor(.x, ordered = TRUE)))%>%
  mutate(across(urban_rural:religion, ~factor(.x, ordered = FALSE)))%>%
  mutate(across(State, ~factor(.x, ordered = FALSE)))

#str(formice)
#summary(formice)

# litte's MCAR test 

#sum(is.na(formice))

#mcar_test(data= codedmodule2)
# p value = 1, which means MAR condition is met. 

```





# Kahan scale

## MAR condition and missing data pattern 
```{r, echo=FALSE}

kahanall <- codedmodule2 %>%
          dplyr::select(c(starts_with("K_"), "age", "gender", "caste", "State", "urban_rural", "religion")) %>%
          mutate(across(gender:religion, ~factor(.x, ordered = FALSE))) %>%
          mutate(across(age, ~factor(.x, ordered = TRUE)))
          
  
#str(kahanall)

#md.pattern(kahanall) #the variables with missing values: K_SHARM K_IPROTECT K_IPRIVACY K_SPROTECT K_SLIMCHOI K_IINTRFER K_HEQUAL K_HREVDIS1 

#mcar_test(data=kahanall) # p values is less than 0.05 - the condition for MCAR is not met 

# dataset with missing variables to compare and test group comaprisons 


MARkahan <- codedmodule2 %>%
          dplyr::select(c("K_SHARM", "K_IPROTECT", "K_IPRIVACY", "K_SPROTECT", "K_SLIMCHOI", "K_IINTRFER",  "K_HEQUAL", "K_HREVDIS1" , "age", "gender", "caste", "State", "urban_rural", "religion"))

MARkahan$K_SHARM_MAR <- MARkahan$K_SHARM

MARkahan$K_IPROTECT_MAR <- MARkahan$K_IPROTECT

MARkahan$K_SPROTECT_MAR <- MARkahan$K_SPROTECT

MARkahan$K_SLIMCHOI_MAR <- MARkahan$K_SLIMCHOI

library(finalfit)

# "K_SHARM" = "(C)Sometimes the government needs to make laws that keep people from hurting themselves.",
explanatory = c("age", "gender", "caste", "State", "urban_rural", "religion")
dependent = "K_SHARM_MAR"
#MARkahan %>% 
  #missing_compare(dependent, explanatory) %>% 
    #knitr::kable(row.names=FALSE, align = c("l", "l", "r", "r", "r"), 
        #caption = "comparisons between values of responders (Not missing) and 
        #non-responders (Missing) on the K_SHARM variable.") 

```




## Mifa
```{r, echo =FALSE}


library(mifa)
library(mice)
library(psych)


mikahan <- mifa(data= kahanall,
                cov_vars  = -c("age", "gender", "caste", "State", "urban_rural", "religion"),
                m = 50,
                n_pc= 2:4,
                ci = "fieller", 
                n_boot=1000,
                print = FALSE,
                progress= TRUE, 
                seed = 427,)


library(psych)

fit <- psych::fa(mikahan$cov_combined, nfactors = 2, rotate = "varimax")

#print.psych(fit, sort= TRUE, cut= 0.4)


kahanfit4 <- psych::fa(mikahan$cov_combined, nfactors = 3, rotate = "varimax")

#print.psych(kahanfit4, sort= TRUE, cut= 0.4)

```





\blandscape
\newpage

## EFA Pretty Table

```{r, echo=FALSE}

library(flextable)

flex <- function(data, title=NULL, col_widths=NULL) {
  tbl <- flextable(data) %>%
           #padding(padding = 1, part = "all") %>%
           #set_table_properties(layout = "autofit") %>%
           fontsize(size=10, part="all") %>%
           set_caption(title, 
                       autonum = officer::run_autonum(seq_id = "tab", 
                                                      pre_label = "Table ", 
                                                      post_label = "\n", 
                                                      bkm = "anytable"))
  
  # If col_widths is provided, set column widths
  if(!is.null(col_widths)) {
    for(col in names(col_widths)){
      tbl <- width(tbl, j = col, width = col_widths[[col]])
    }
  }

  return(tbl)
}


rename_map <- c(
  "K_SHARM" = " (C)Sometimes the government needs to make laws that keep people from hurting themselves.",
"K_SLIMCHOI" = "(C)The government should put limits on the choices individuals can make so they don’t get in the way of what’s
good for society.",
"K_SPROTECT" = "(C)The government should do more to advance society’s goals, even if that means limiting the freedom and
choices of individuals.",
"K_HEQUAL" = "(H)We have gone too far in pushing equal rights in this country.",
"K_ERADEQ1" = "(E)We need to dramatically reduce inequalities between the rich and the poor.",
"K_EWEALTH" = "(E)Our society would be better off if the distribution of wealth was more equal.",
"K_ERADEQ2" = "(E)We need to dramatically reduce inequalities between men and women.",
"K_HREVDIS1" = "(H)Nowadays it seems like there is just as much discrimination against upper castes as there is against Dalits.",
"K_EDISCRIM" = "(E)Discrimination against minorities is still a very serious problem in our society.",
"K_IINTRFER" = "(I)The government interferes far too much in our everyday lives.",
"K_IPRIVACY" = "(I)The government should stop telling people how to live their lives.",
"K_IPROTECT" = "(I)It’s not the government’s business to try to protect people from themselves."
)


fa_table <- function(x, cut) {
  #get sorted loadings
  loadings <- fa.sort(x)$loadings %>% round(3)
  #suppress loadings
  loadings[loadings > -cut & loadings < cut] <- ""
  #get additional info  
  add_info <- cbind(x$communalities, 
                    x$uniquenesses,
                    x$complexity) %>%
    # make it a data frame
    as.data.frame() %>%
    # column names
    rename("Communality" = V1,
           "Uniqueness" = V2,
           "Complexity" = V3) %>%
    #get the item names from the vector
    rownames_to_column("item")
  
  #build table
  loadings %>%
    unclass() %>%
    as.data.frame() %>%
    rownames_to_column("item") %>%
    left_join(add_info) %>%
    mutate(
      item = if_else(item %in% names(rename_map), rename_map[item], item),
      code = names(rename_map)[match(item, rename_map)], # extracting short form
      across(where(is.numeric), round, 3)
    ) %>%
    dplyr::select(code, everything()) # reorder columns to bring code to the front
}

fa_table(fit , .4) %>%
  rename(Egalitarianism = MR1, Communitarianism = MR2, Items= item, Code= code) %>%
  flex("Table 1: EFA on adapted Cultural Cognition Scale from Kahan et al(2007)", col_widths = list(Items = 4.5, Code = 1))


```





```{r, echo = FALSE}
fit[["Vaccounted"]] %>%
  as.data.frame() %>%
  rownames_to_column("Property") %>%
  rename(Egalitarianism = MR1, Communitarianism = MR2) %>%
    mutate(across(where(is.numeric), round, 3)) %>%
    flex("Table 2: Eigenvalues and Variance Explained for Cultural Cognition Scale")
```

\elandscape





## merging of imputation

```{r, echo=FALSE}

#kahan_imp <- mice(kahanall, m =5, maxit =30,  seed = 427, print = FALSE)

#kahan_imp$chainMean


```

## Kahan Factor scores (mean across all imputations)

```{r, echo=FALSE}

kahanallscores <- mice::complete(mice::mice(kahanall, m = 50, seed = 427, print = FALSE), "broad") 
            
kahanallscores <- kahanallscores %>%dplyr::select(-(contains(c("age", "urban_rural", "gender","caste","religion", "State"))))

#str(kahanallscores)

nkahanall <- kahanallscores %>%
  rowwise() %>%
  mutate(
    K_IINTRFER_mean = mean(c_across(starts_with("K_IINTRFER"))),
    K_IPRIVACY_mean = mean(c_across(starts_with("K_IPRIVACY"))),
    K_SHARM_mean = mean(c_across(starts_with("K_SHARM"))),
    K_IPROTECT_mean = mean(c_across(starts_with("K_IPROTECT"))),
    K_SLIMCHOI_mean = mean(c_across(starts_with("K_SLIMCHOI"))),
    K_SPROTECT_mean = mean(c_across(starts_with("K_SPROTECT"))),
    K_HEQUAL_mean = mean(c_across(starts_with("K_HEQUAL"))),
    K_HREVDIS1_mean = mean(c_across(starts_with("K_HREVDIS1"))),
    K_EDISCRIM_mean = mean(c_across(starts_with("K_EDISCRIM"))),
    K_ERADEQ1_mean = mean(c_across(starts_with("K_ERADEQ1"))),
    K_ERADEQ2_mean = mean(c_across(starts_with("K_ERADEQ2"))),
    K_EWEALTH_mean = mean(c_across(starts_with("K_EWEALTH")))
  ) %>%
  ungroup()%>%
  dplyr::select(contains("_mean")) %>%
   rename_with(~ gsub("_mean$", "", .x))



nkahanfinal <- data.frame(factor.scores(nkahanall[, 1:12], fit)$scores)


```

## corelation table
```{r, echo = FALSE}

#cor(nkahanall)

#before mice 
#cor.plot(kahanall %>% dplyr::select(-c("age", "gender", "caste", "State", "urban_rural", "religion")))

#after mice
 
#cor.plot(nkahanall)

#cov(nkahanall)

```



## Kahan scater plot from EFA scores 
```{r, echo = FALSE}

#nkahanfinal %>%
  #ggplot(aes(MR1, MR2))+
  #geom_count(aes(color = ..n.., size = ..n..))+
  #guides(color = 'legend')+
  #geom_hline(yintercept=0, colour="black", lwd=0.5)+
  #geom_vline(xintercept=0, colour="black", lwd=0.5)+
  #labs(x = "Hierarchy -Egalitarianism", y = "Individualism - Communitarianism")+
  #ylim(-2,3)+
  #xlim(-2,3)+
  #theme_minimal() 
```

## Alpha test

```{r, echo=FALSE}

KahanallHE <-nkahanall %>%
  dplyr::select(starts_with(c("K_H", "K_E")))

KahanallHE_alpha <- psych::alpha(KahanallHE, check.keys = TRUE) # alpha = 0.71	

KahanallC <-nkahanall %>%
  dplyr::select(starts_with(c("K_S")))

KahanallC_alpha <- psych::alpha(KahanallC, check.keys = TRUE) # alpha = 0.73


```




 


# Nuclear: Eco-pol scale

## MAR condition and missing data pattern

```{r, echo=FALSE}

ecopoln <- formice1 %>%
  dplyr::select(
    DECISIONDECEN, DECISIONCEN, INDUSTRYSMALL, INDUSTRYLARGE,
    ECONOMYLOCAL, ECONOMYGLOBAL, ENVOVERDEV,DEVOVERENV, OWNERPVT, OWNERPUB,
    OWNERREG, OWNERNOREG, WEALTHLIM, MECHANISATION,
    DISPLACENUCLEAR,  POLLUTENUCLEAR, HEALTHNUCLEAR, JOBSNUCLEAR, BEAUTYNUCLEAR,
    PRIDENUCLEAR, NPRIDENUCLEAR, DEVNUCLEAR, PROSPERNUCLEAR,
    RELYNUCLEAR,age, urban_rural, gender, caste, religion, State
  )

#md.pattern(ecopoln) #the variables with missing values: PRIDENUCLEAR PROSPERNUCLEAR JOBSNUCLEAR HEALTHNUCLEAR BEAUTYNUCLEAR POLLUTENUCLEAR DISPLACENUCLEAR RELYNUCLEAR  

#mcar_test(data=ecopoln) # p values is less than 0.76 - the condition for MCAR is met 

# dataset with missing variables to compare and test group comaprisons 

MARecopol <- codedmodule2 %>%
          dplyr::select(c(DECISIONDECEN, DECISIONCEN, INDUSTRYSMALL, INDUSTRYLARGE,
    ECONOMYLOCAL, ECONOMYGLOBAL, ENVOVERDEV, OWNERPVT, OWNERPUB,
    OWNERREG, OWNERNOREG, WEALTHLIM, MECHANISATION,
    DISPLACENUCLEAR,  POLLUTENUCLEAR, HEALTHNUCLEAR, JOBSNUCLEAR, BEAUTYNUCLEAR,
    PRIDENUCLEAR, NPRIDENUCLEAR, DEVNUCLEAR, PROSPERNUCLEAR,
    RELYNUCLEAR,age, urban_rural, gender, caste, religion, State))

MARecopol$JOBSNUCLEAR_MAR <- MARecopol$JOBSNUCLEAR

MARecopol$PRIDENUCLEAR_MAR <- MARecopol$PRIDENUCLEAR


library(finalfit)

# JOBSNUCLEAR
explanatory = c("age", "gender", "caste", "State", "urban_rural", "religion")
dependent = "JOBSNUCLEAR_MAR"
#MARecopol %>% 
  #missing_compare(dependent, explanatory) %>% 
    #knitr::kable(row.names=FALSE, align = c("l", "l", "r", "r", "r"), 
        #caption = "comparisons between values of responders (Not missing) and 
        #non-responders (Missing) on the JOBSNUCLEAR variable.") 









```



## Mifa

```{r, echo=FALSE}

 


miecopol <- mifa(data= ecopoln,
                cov_vars  = -c("age", "gender", "caste", "State", "urban_rural", "religion"),
                m=50,
                n_pc= 2:4,
                ci = "fieller", 
                n_boot=1000,
                print = FALSE,
                progress= TRUE, 
                seed = 429,)



ecopolfit2 <- psych::fa(miecopol$cov_combined, nfactors = 2, rotate = "varimax")

print.psych(ecopolfit2, sort= TRUE, cut=0.4)


```

## Factor Scores (mean across all imputations)

```{r, echo=FALSE}

ecopolallscores <- mice::complete(mice::mice(ecopoln, m = 50, seed = 429, print = FALSE), "broad") 
            
ecopolallscores <- ecopolallscores %>%dplyr::select(-(contains(c("age", "urban_rural", "gender","caste","religion", "State"))))

#str(ecopolallscores)


necopol <- ecopolallscores %>%
  rowwise() %>%
  mutate(DEVNUCLEAR_mean = mean(c_across(starts_with("DEVNUCLEAR"))),
         PROSPERNUCLEAR_mean = mean(c_across(starts_with("PROSPERNUCLEAR"))),
         NPRIDENUCLEAR_mean = mean(c_across(starts_with("NPRIDENUCLEAR"))),
         PRIDENUCLEAR_mean = mean(c_across(starts_with("PRIDENUCLEAR"))),
         JOBSNUCLEAR_mean = mean(c_across(starts_with("JOBSNUCLEAR"))),
         ECONOMYGLOBAL_mean = mean(c_across(starts_with("ECONOMYGLOBAL"))),
         WEALTHLIM_mean = mean(c_across(starts_with("WEALTHLIM"))),
         INDUSTRYLARGE_mean = mean(c_across(starts_with("INDUSTRYLARGE"))),
         DECISIONCEN_mean = mean(c_across(starts_with("DECISIONCEN"))),
         MECHANISATION_mean = mean(c_across(starts_with("MECHANISATION"))),
         OWNERNOREG_mean = mean(c_across(starts_with("OWNERNOREG"))),
         INDUSTRYSMALL_mean = mean(c_across(starts_with("INDUSTRYSMALL"))),
         DEVOVERENV_mean = mean(c_across(starts_with("DEVOVERENV"))),
         OWNERPVT_mean = mean(c_across(starts_with("OWNERPVT"))),
         RELYNUCLEAR_mean = mean(c_across(starts_with("RELYNUCLEAR"))),
         BEAUTYNUCLEAR_mean = mean(c_across(starts_with("BEAUTYNUCLEAR"))),
         HEALTHNUCLEAR_mean = mean(c_across(starts_with("HEALTHNUCLEAR"))),
         POLLUTENUCLEAR_mean = mean(c_across(starts_with("POLLUTENUCLEAR"))),
         DISPLACENUCLEAR_mean = mean(c_across(starts_with("DISPLACENUCLEAR"))),
         ENVOVERDEV_mean = mean(c_across(starts_with("ENVOVERDEV"))),
         OWNERPUB_mean = mean(c_across(starts_with("OWNERPUB"))),
         OWNERREG_mean = mean(c_across(starts_with("OWNERREG"))),
         DECISIONDECEN_mean = mean(c_across(starts_with("DECISIONDECEN"))),
         ECONOMYLOCAL_mean = mean(c_across(starts_with("ECONOMYLOCAL")))
  ) %>%
  ungroup()%>%
  dplyr::select(contains("_mean")) %>%
   rename_with(~ gsub("_mean$", "", .x))

  
  

necopolfinal <- data.frame(factor.scores(necopol[, 1:24], ecopolfit2)$scores) 
                

```



## Alpha test

```{r, echo=FALSE}

nPdevelop <-necopol %>%
  dplyr::select((c(BEAUTYNUCLEAR,  HEALTHNUCLEAR,  POLLUTENUCLEAR, DISPLACENUCLEAR, OWNERPUB, ENVOVERDEV)))

nPdevelop_alpha <- psych::alpha(nPdevelop, check.keys = TRUE) # alpha = 0.79	

nNdevelop <-necopol %>%
  dplyr::select((c(DEVNUCLEAR, PROSPERNUCLEAR,PRIDENUCLEAR, NPRIDENUCLEAR, JOBSNUCLEAR, ECONOMYGLOBAL,          WEALTHLIM,INDUSTRYLARGE, DECISIONCEN, MECHANISATION )))

nNdevelop_alpha <- psych::alpha(nNdevelop , check.keys = TRUE) # alpha = 0.79


```

\newpage
## Radar map

```{r, echo=FALSE}
library(ggplot2)
library(fmsb)

#nrow(ecopolfit2$loadings)

# Extract the loadings
loadings_matrix4 <- ecopolfit2$loadings[1:24, ]

loadings_df2 <- as.data.frame(as.matrix(loadings_matrix4))

# Adding rownames to the dataframe as a new column
loadings_df2 <- loadings_df2 %>%
  rownames_to_column(var = "variable") 

# Pivot to longer format first
long_loadings_df2 <- loadings_df2 %>%
  pivot_longer(cols = c(MR1, MR2), names_to = "Factors", values_to = "value")

# Pivot the longer format to wide format
wide_loadings_df2 <- long_loadings_df2 %>%
  pivot_wider(names_from = variable, values_from = value) %>%
  mutate(Factors = case_when(
    Factors == "MR1" ~ "Nationalist Development (Ndevelop)",
    Factors == "MR2" ~ "People Centered Development (Pdevelop)",
    TRUE ~ Factors
  )) %>%
  column_to_rownames("Factors")


# Define the variable ranges: maximum and minimum
max_min2 <- data.frame(
  DEVNUCLEAR = c(0.8, -0.6), PROSPERNUCLEAR = c(0.8, -0.6), NPRIDENUCLEAR = c(0.8, -0.6), PRIDENUCLEAR = c(0.8, -0.6),     JOBSNUCLEAR = c(0.8, -0.6), ECONOMYGLOBAL = c(0.8, -0.6), WEALTHLIM = c(0.8, -0.6), INDUSTRYLARGE = c(0.8, -0.6),   DECISIONCEN = c(0.8, -0.6), MECHANISATION = c(0.8, -0.6), OWNERNOREG = c(0.8, -0.6), INDUSTRYSMALL = c(0.8, -0.6), DEVOVERENV = c(0.8, -0.6), OWNERPVT = c(0.8, -0.6), RELYNUCLEAR = c(0.8, -0.6), BEAUTYNUCLEAR = c(0.8, -0.6), HEALTHNUCLEAR = c(0.8, -0.6), POLLUTENUCLEAR = c(0.8, -0.6), DISPLACENUCLEAR = c(0.8, -0.6), DECISIONDECEN = c(0.8, -0.6),
ECONOMYLOCAL = c(0.8, -0.6), ENVOVERDEV = c(0.8, -0.6), OWNERPUB = c(0.8, -0.6), OWNERREG = c(0.8, -0.6)   
)
rownames(max_min2) <- c("Max", "Min")

# Assuming you have a dataframe 'exam_scores' with matching column names
# Bind the variable ranges to the data

radar4 <- rbind(max_min2, wide_loadings_df2) %>%
    rename(
      "National development(nuclear)" = "DEVNUCLEAR",
      "Local prosperity(nuclear)" = "PROSPERNUCLEAR",
      "National pride(nuclear)" = "NPRIDENUCLEAR",
      "Community pride(nuclear)" = "PRIDENUCLEAR",
      "Job opportunities(nuclear)" = "JOBSNUCLEAR",
      "Pro Globaleconomy" = "ECONOMYGLOBAL",
      "Limits on Wealth " = "WEALTHLIM",
      "Pro Large Industries" = "INDUSTRYLARGE",
      "Pro Centralisation" = "DECISIONCEN",
      "Anti Mechanisation of work" = "MECHANISATION",
      "Anti Regulations" = "OWNERNOREG",
      "Anti Large Industries " = "INDUSTRYSMALL",
      "Development over Environment" = "DEVOVERENV",
      "Pro Private ownership " = "OWNERPVT",
      "Less Reliance on government(nuclear)" = "RELYNUCLEAR",
      "Spoils Natural Beauty(nuclear)" = "BEAUTYNUCLEAR",
      "Health risk(nuclear)" = "HEALTHNUCLEAR",
      "Pollution risk(nuclear) " = "POLLUTENUCLEAR",
      "Displacement risk(nuclear)" = "DISPLACENUCLEAR",
      "Environment over Development" = "ENVOVERDEV",
      "Pro Public ownership" = "OWNERPUB",
      "Pro Regulations" = "OWNERREG",
      "Pro Decentralisation" = "DECISIONDECEN",
      "Pro Localeconomy" = "ECONOMYLOCAL",
    )

```


```{r, echo=FALSE, fig.width=8, fig.height=6, out.width='100%', out.height='100%'}
library(fmsb)

create_beautiful_radarchart <- function(data, color = "#00AFBB", 
                                        vlabels = colnames(data), vlcex = 0.7,
                                        caxislabels = NULL, title = NULL, ...){
  radarchart(
    data, axistype = 1,
    # Customize the polygon
    pcol = color, pfcol = scales::alpha(color, 0.7), plwd = 2, plty = 1,
    centerzero=FALSE,
    # Customize the grid
    cglcol = "grey", cglty = 1, cglwd = 2,
    # Customize the axis
    axislabcol = "black", cexc = 7, # Increase label size for axis
    # Variable labels
    vlcex = vlcex, vlabels = vlabels, vlpos = 0.98,
    seg = 7, caxislabels = caxislabels, title = title, 
    # Increase title size
    cex.main = 4,
    ...
  )
}


# Reduce plot margin using par()
op <- par(mar = c(7, 3, 3, 3))
# Create the radar charts
create_beautiful_radarchart(
  data = radar4, caxislabels = c(-0.6, -0.4, -0.2, 0, 0.2, 0.4, 0.6, 0.8),
  color = c( "#F97D09","#00AFBB"),
  vlcex = 1.1
)

# Add an horizontal legend
legend(
  x = "bottomright", legend = rownames(radar4[-c(1,2),]), horiz = TRUE,
  bty = "n", pch = 20 , col = c("#F97D09","#00AFBB"),
  text.col = "black", cex = 1.5, pt.cex = 3,
  inset = c(0, 0)
  )
par(op)

```

\blandscape
\newpage

## Pretty table: Nuclear EFA

```{r, echo=FALSE}

library(flextable)

flex <- function(data, title=NULL, col_widths=NULL) {
  tbl <- flextable(data) %>%
           #padding(padding = 1, part = "all") %>%
           #set_table_properties(layout = "autofit") %>%
           fontsize(size=10, part="all") %>%
           set_caption(title, 
                       autonum = officer::run_autonum(seq_id = "tab", 
                                                      pre_label = "Table ", 
                                                      post_label = "\n", 
                                                      bkm = "anytable"))
  
  # If col_widths is provided, set column widths
  if(!is.null(col_widths)) {
    for(col in names(col_widths)){
      tbl <- width(tbl, j = col, width = col_widths[[col]])
    }
  }

  return(tbl)
}


rename_map2 <- c(
  "WEALTHLIM" = "A limit should be put to how much wealth a person can amass",
  "MECHANISATION" = "Rapid mechanization of work is taking away jobs from workers in this country",
  "DECISIONDECEN" = "Local politicians shouldn't have to ask permission from the central government to implement policies",
  "DECISIONCEN" = "Laws and policies would be implemented more smoothly if more power lay with the central government",
  "INDUSTRYLARGE" = "Large scale industries are required for the development of the country that will benefit everyone",
  "INDUSTRYSMALL" = "Large corporations are destroying the local industries in India and benefiting only a handful of people",
  "ECONOMYGLOBAL" = "Foreign companies have led to a range of benefits for the Indian people and society",
  "ECONOMYLOCAL" = "India would be better off if foreign companies didn't come to here",
  "ENVOVERDEV" = "Polluting industries that spoil the environment should be shut down even if it costs people their jobs",
  "DEVOVERENV" = "Economic growth and creating jobs should be prioritized over environmental protection",
  "OWNERPVT" = "All businesses and industries should be owned privately",
  "OWNERNOREG" = "There is too much red-tape and the government should not interfere with businesses and industries",
  "OWNERPUB" = "The government should own most large businesses and industries",
  "OWNERREG" = "Regardless of ownership, the government should pass strong regulations and implement them",
  "DISPLACENUCLEAR" = "Nuclear energy is leading to displacement of people from their land",
  "BEAUTYNUCLEAR" = "Nuclear energy spoils the natural beauty of the landscape",
  "POLLUTENUCLEAR" = "Nuclear energy increases pollution of air/water/land",
  "HEALTHNUCLEAR" = "Nuclear energy poses a great risk to the health of people living around it",
  "JOBSNUCLEAR" = "Nuclear energy will bring jobs to the local community",
  "PRIDENUCLEAR" = "I would be proud if my community used nuclear energy",
  "NPRIDENUCLEAR" = "Nuclear energy is a mark of pride for our nation",
  "DEVNUCLEAR" = "Nuclear energy pushes forward the country's development",
  "PROSPERNUCLEAR" = "Nuclear energy brings economic prosperity to the surrounding regions",
  "RELYNUCLEAR" = "I don't like the idea that I have to rely on the government for electricity from nuclear energy"
)


fa_table <- function(x, cut) {
  #get sorted loadings
  loadings <- fa.sort(x)$loadings %>% round(3)
  #suppress loadings
  loadings[loadings > -cut & loadings < cut] <- ""
  #get additional info  
  add_info <- cbind(x$communalities, 
                    x$uniquenesses,
                    x$complexity) %>%
    # make it a data frame
    as.data.frame() %>%
    # column names
    rename("Communality" = V1,
           "Uniqueness" = V2,
           "Complexity" = V3) %>%
    #get the item names from the vector
    rownames_to_column("item")
  
  #build table
  loadings %>%
    unclass() %>%
    as.data.frame() %>%
    rownames_to_column("item") %>%
    left_join(add_info) %>%
    mutate(
      item = if_else(item %in% names(rename_map2), rename_map2[item], item),
      code = names(rename_map2)[match(item, rename_map2)], # extracting short form
      across(where(is.numeric), round, 3)
    ) %>%
    dplyr::select(code, everything()) # reorder columns to bring code to the front
}

fa_table(ecopolfit2, .4) %>%
  rename(Ndevelop = MR1, Pdevelop = MR2, Items= item) %>%
  dplyr::mutate(code = case_when(
    code == "WEALTHLIM" ~ "Limits on Wealth",
    code == "MECHANISATION" ~ "Anti Mechanisation of work",
    code == "DECISIONDECEN" ~ "Pro Decentralisation",
    code == "DECISIONCEN" ~ "Pro Centralisation",
    code == "INDUSTRYLARGE" ~ "Pro Large Industries",
    code == "INDUSTRYSMALL" ~ "Anti Large Industries",
    code == "ECONOMYGLOBAL" ~ "Pro Globaleconomy",
    code == "ECONOMYLOCAL" ~ "Pro Localeconomy",
    code == "ENVOVERDEV" ~ "Environment over Development",
    code == "DEVOVERENV" ~ "Development over Environment",
    code == "OWNERPVT" ~ "Pro Private ownership",
    code == "OWNERNOREG" ~ "Anti Regulations",
    code == "OWNERPUB" ~ "Pro Public ownership",
    code == "OWNERREG" ~ "Pro Regulations",
    code == "DISPLACENUCLEAR" ~ "Displacement risk(nuclear)",
    code == "POLLUTENUCLEAR" ~ "Pollution risk(nuclear)",
    code == "HEALTHNUCLEAR" ~ "Health risk(nuclear)",
    code == "JOBSNUCLEAR" ~ "Job opportunities(nuclear)",
    code == "BEAUTYNUCLEAR" ~ "Spoils Natural Beauty(nuclear)",
    code == "PROSPERNUCLEAR" ~ "Local prosperity(nuclear)",
    code == "PRIDENUCLEAR" ~ "Community pride(nuclear)",
    code == "NPRIDENUCLEAR" ~ "National pride(nuclear)",
    code == "DEVNUCLEAR" ~ "National development(nuclear)",
    code == "RELYNUCLEAR" ~ "Less Reliance on government(nuclear)",
    TRUE ~ code # Default case to keep original value if no match
  )) %>%
  flex("Table 3: EFA on Eco-Pol Values Scale", col_widths = list(Items = 4.5, code = 1.5))


```

\elandscape








```{r, echo = FALSE}
ecopolfit2[["Vaccounted"]] %>%
  as.data.frame() %>%
  rownames_to_column("Property") %>%
  rename(Ndevelop = MR1, Pdevelop = MR2) %>%
    mutate(across(where(is.numeric), round, 3)) %>%
    flex("Table 4: Eigenvalues and Variance Explained Eco-Pol Scale")
```




# State Ns before MIFA

```{r, echo=FALSE}

#Statenacheck1 <- allformice %>%
  #na.omit()%>%
  #dplyr::select(State)

#summary(Statenacheck1)
```





# State Ns after MIFA

```{r, echo=FALSE}

#nuclear_missing <- allformice %>% dplyr::select(Risky_Nuclear,Uppercaste, Male, Hindu, urban_rural, Age, State)%>%
 #na.omit()

#summary(nuclear_missing)

```




## Nuclear: Ecopol (Mean across imputations)

## Binding datasets 

```{r, echo = FALSE}

# binding the imputed  factor analysis scores for kahan scale and eco-pol value scale to the larger dataset codedmodule2

ecopolnuclearfinal <- necopolfinal %>%
  rename(Ndevelop = MR1, Pdevelop = MR2)

kahannuclearfinal <- nkahanfinal%>%
  rename(Egalitarian = MR1, Communitarian = MR2)


allformicefinal<- cbind(formice1,ecopolnuclearfinal, kahannuclearfinal)

```


# LMs : final imputed datasets

```{r, echo=FALSE}


allformicefinal$State <- factor(allformicefinal$State, levels = c("Maharashtra","West Bengal" ,"Rajasthan","Tamil Nadu",  "Uttar Pradesh"))


nuclearfinal <- lm(Risky_Nuclear ~ Uppercaste + Male + Hindu + urban_rural + Age, data = allformicefinal)


nuclearfinal2 <- lm(Risky_Nuclear ~ Uppercaste + Male + Hindu + urban_rural + Age + State, data = allformicefinal)


nuclearfinal3 <- lm(Risky_Nuclear ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian, data = allformicefinal)

nuclearfinal4 <- lm(Risky_Nuclear ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian + Pdevelop + Ndevelop, data = allformicefinal)

#summary(nuclearfinal)
#summary(nuclearfinal2)
#summary(nuclearfinal3)
#summary(nuclearfinal4)

aic_values <- AIC(nuclearfinal, nuclearfinal2, nuclearfinal3, nuclearfinal4)

#print(aic_values)

bic_values <- BIC(nuclearfinal, nuclearfinal2, nuclearfinal3, nuclearfinal4)

#print(bic_values)

```


# correlation table 

```{r, echo = FALSE}

nforcor <- allformicefinal %>%
           dplyr::select(Risky_Nuclear, Communitarian , Egalitarian , Pdevelop , Ndevelop)

#cor.plot(nforcor)
```

# interaction vars tablle

```{r, echo = FALSE}

nuclearinterac <- lm(Risky_Nuclear ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian*State + Egalitarian*State + Pdevelop*State + Ndevelop*State , data = allformicefinal)

#summary(nuclearinterac)

```



\newpage
\blandscape
# Stargazer : all LMs

```{r, echo=FALSE, results='asis'}
library(stargazer)


cat("\\begingroup")
cat("\\setlength{\\tabcolsep}{1pt}")
cat("\\renewcommand{\\arraystretch}{0.7}")
stargazer(nuclearfinal, nuclearfinal2, nuclearfinal3, nuclearfinal4, nuclearinterac,
          title = "Table 6: 5 linear models: Perceived Risk of Nuclear Energy",
          type = "latex"
)
cat("\\endgroup")


```

\elandscape


# Paper 2

## NUCLEAR 

### only charcateristics of tech


```{r, echo=FALSE}

ecopoln2 <- formice1 %>%
  dplyr::select(DECISIONDECEN, DECISIONCEN, INDUSTRYSMALL, INDUSTRYLARGE,
    ECONOMYLOCAL, ECONOMYGLOBAL, ENVOVERDEV,DEVOVERENV, OWNERPVT, OWNERPUB,
    OWNERREG, OWNERNOREG, WEALTHLIM, MECHANISATION,
    DISPLACENUCLEAR,  POLLUTENUCLEAR, HEALTHNUCLEAR, JOBSNUCLEAR, BEAUTYNUCLEAR,
    PRIDENUCLEAR, NPRIDENUCLEAR, DEVNUCLEAR, PROSPERNUCLEAR,
    RELYNUCLEAR, age, urban_rural, gender, caste, religion, State
  )

#str(ecopoln2)
#md.pattern(ecopoln2) #the variables with missing values:  

#mcar_test(data=ecopoln2)
```




## Mifa: only charcateristics of tech

```{r, echo=FALSE}

 


miecopol2 <- mifa(data= ecopoln,
                cov_vars  = -c("age", "gender", "caste", "State", "urban_rural", "religion", DECISIONDECEN, DECISIONCEN, INDUSTRYSMALL, INDUSTRYLARGE,
    ECONOMYLOCAL, ECONOMYGLOBAL, ENVOVERDEV,DEVOVERENV, OWNERPVT, OWNERPUB,
    OWNERREG, OWNERNOREG, WEALTHLIM, MECHANISATION),
                m=50,
                n_pc= 2:4,
                ci = "fieller", 
                n_boot=1000,
                print = FALSE,
                progress= TRUE, 
                seed = 429,)



ecopolfitn2 <- psych::fa(miecopol2$cov_combined, nfactors = 2, rotate = "varimax")
print.psych(ecopolfitn2, sort= TRUE, cut= 0.4)


```



### Factor Scores (mean across all imputations)

```{r, echo=FALSE}

ecopoln2scores <- mice::complete(mice::mice(ecopoln2, m = 50, seed = 429, print = FALSE), "broad") 
            
ecopoln2scores <- ecopoln2scores %>%dplyr::select(-(contains(c("age", "urban_rural", "gender","caste","religion", "State",    "DECISIONDECEN", "DECISIONCEN", "INDUSTRYSMALL", "INDUSTRYLARGE","ECONOMYLOCAL", "ECONOMYGLOBAL", "ENVOVERDEV","DEVOVERENV", "OWNERPVT", "OWNERPUB","OWNERREG", "OWNERNOREG", "WEALTHLIM", "MECHANISATION"))))

#str(ecopolallscores)


ecopoln2means <- ecopoln2scores %>%
  rowwise() %>%
  mutate(DEVNUCLEAR_mean = mean(c_across(starts_with("DEVNUCLEAR"))),
         PROSPERNUCLEAR_mean = mean(c_across(starts_with("PROSPERNUCLEAR"))),
         NPRIDENUCLEAR_mean = mean(c_across(starts_with("NPRIDENUCLEAR"))),
         PRIDENUCLEAR_mean = mean(c_across(starts_with("PRIDENUCLEAR"))),
         JOBSNUCLEAR_mean = mean(c_across(starts_with("JOBSNUCLEAR"))),
         RELYNUCLEAR_mean = mean(c_across(starts_with("RELYNUCLEAR"))),
         BEAUTYNUCLEAR_mean = mean(c_across(starts_with("BEAUTYNUCLEAR"))),
         HEALTHNUCLEAR_mean = mean(c_across(starts_with("HEALTHNUCLEAR"))),
         POLLUTENUCLEAR_mean = mean(c_across(starts_with("POLLUTENUCLEAR"))),
         DISPLACENUCLEAR_mean = mean(c_across(starts_with("DISPLACENUCLEAR"))),
  ) %>%
  ungroup()%>%
  dplyr::select(contains("_mean")) %>%
   rename_with(~ gsub("_mean$", "", .x))

  
necopol2final <- data.frame(factor.scores(ecopoln2means[, 1:10], ecopolfitn2)$scores) 
                

```


### LMs : characteristics of tech 

```{r, echo = FALSE}

ecopoln2final <- necopol2final %>%
  rename(DevPride = MR1, SocialCosts = MR2)

kahannuclearfinal <- nkahanfinal%>%
  rename(Egalitarian = MR1, Communitarian = MR2)


n2allfinal <- cbind(formice1,ecopoln2final, kahannuclearfinal)%>%
   mutate(Netben_Nuclear = Ben_Nuclear - Risky_Nuclear,
         Netben_Solar = Ben_Solar - Risky_Solar,
         Netben_Coal = Ben_Coal - Risky_Coal)

nuclear2lm <- lm(Risky_Nuclear ~ Uppercaste + Male + Hindu +Age + urban_rural+ State + DevPride + SocialCosts + Egalitarian + Communitarian, data = n2allfinal)

#summary(nuclear2lm)

netnuclear2lm <- lm(Netben_Nuclear ~ Uppercaste + Male + Hindu +Age + urban_rural+ State + DevPride + SocialCosts + Egalitarian + Communitarian, data = n2allfinal)

#summary(netnuclear2lm)


bennuclear2lm <- lm(Ben_Nuclear ~ Uppercaste + Male + Hindu +Age+ urban_rural + State + DevPride + SocialCosts + Egalitarian + Communitarian, data = n2allfinal)

#summary(bennuclear2lm)


```



\newpage

### Stargazer : characteristics of tech

```{r, echo=FALSE, results='asis'}
library(stargazer)


cat("\\begingroup")
cat("\\setlength{\\tabcolsep}{1pt}")
cat("\\renewcommand{\\arraystretch}{0.7}")
stargazer(nuclear2lm,  bennuclear2lm, netnuclear2lm,
          title = "",
          type = "latex"
)
cat("\\endgroup")


```




###  LMs : Nuclear all eco-pol 

```{r, echo = FALSE}



allformicefinal2 <- allformicefinal%>%mutate(Netben_Nuclear = Ben_Nuclear - Risky_Nuclear,
         Netben_Solar = Ben_Solar - Risky_Solar,
         Netben_Coal = Ben_Coal - Risky_Coal)


nuclearfinal4 <- lm(Risky_Nuclear ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian + Pdevelop + Ndevelop, data = allformicefinal2)

bennuclear3lm <- lm(Ben_Nuclear ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian + Pdevelop + Ndevelop, data = allformicefinal2)

#summary(bennuclear3lm)


netnuclear3lm <- lm(Netben_Nuclear ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian + Pdevelop + Ndevelop, data = allformicefinal2)

#summary(netnuclear3lm)


```




## Solar

### Solar : MAR condition and missing data pattern


```{r, echo=FALSE}

ecopols <- formice1 %>%
  dplyr::select(
    DECISIONDECEN, DECISIONCEN, INDUSTRYSMALL, INDUSTRYLARGE,
    ECONOMYLOCAL, ECONOMYGLOBAL, ENVOVERDEV,DEVOVERENV, OWNERPVT, OWNERPUB,
    OWNERREG, OWNERNOREG, WEALTHLIM, MECHANISATION,
    DISPLACESOLAR,  POLLUTESOLAR, HEALTHSOLAR, JOBSSOLAR, BEAUTYSOLAR,
    PRIDESOLAR, NPRIDESOLAR, DEVSOLAR, PROSPERSOLAR,
    RELYSOLAR,age, urban_rural, gender, caste, religion, State
  )

#md.pattern(ecopols) #the variables with missing values:  

#mcar_test(data=ecopols)
```


### Solar : EFA Mifa all eco-pol 

```{r, echo=FALSE}

 


miecopols <- mifa(data= ecopols,
                cov_vars  = -c("age", "gender", "caste", "State", "urban_rural", "religion"),
                m=50,
                n_pc= 1:2,
                ci = "fieller", 
                n_boot=1000,
                print = FALSE,
                progress= TRUE, 
                seed = 528,)



# EFA with mifa

ecopolfits <- psych::fa(miecopols$cov_combined, nfactors = 2, rotate = "varimax")

#print.psych(ecopolfits, sort= TRUE, cut= 0.4)



```

### Solar 2 : EFA dataset : only charcateristics of tech


```{r, echo=FALSE}

ecopols2 <- formice1 %>%
  dplyr::select(
    DISPLACESOLAR,  POLLUTESOLAR, HEALTHSOLAR, JOBSSOLAR, BEAUTYSOLAR,
    PRIDESOLAR, NPRIDESOLAR, DEVSOLAR, PROSPERSOLAR,
    RELYSOLAR, age, urban_rural, gender, caste, religion, State
  )


#str(ecopols2)
#md.pattern(ecopols2) #the variables with missing values:  

#mcar_test(data=ecopols2)
```


### SOLAR2 : EFA Mifa : chaaracteristics of tech 

```{r, echo=FALSE}



miecopols2 <- mifa(data= ecopols2,
                cov_vars = -c("age", "gender", "caste", "State", "urban_rural", "religion"),
                m=10,
                n_pc= 2:4,
                ci = "fieller", 
                n_boot=1000,
                print = FALSE,
                progress= TRUE, 
                seed = 528,)




ecopolfits2 <- psych::fa(miecopols2$cov_combined, nfactors = 2, rotate = "varimax")

#print.psych(ecopolfits2, sort= TRUE, cut= 0.4)


```

### only tech characters : Factor Scores (mean across all imputations)

```{r, echo=FALSE}

ecopols2scores <- mice::complete(mice::mice(ecopols2, m = 50, seed = 429, print = FALSE), "broad") 
            
ecopols2scores <- ecopols2scores %>%dplyr::select(-(contains(c("age", "urban_rural", "gender","caste","religion", "State"))))

#str(ecopolallscores)


ecopols2means <- ecopols2scores %>%
  rowwise() %>%
  mutate(DEVSOLAR_mean = mean(c_across(starts_with("DEVSOLAR"))),
         PROSPERSOLAR_mean = mean(c_across(starts_with("PROSPERSOLAR"))),
         NPRIDESOLAR_mean = mean(c_across(starts_with("NPRIDESOLAR"))),
         PRIDESOLAR_mean = mean(c_across(starts_with("PRIDESOLAR"))),
         JOBSSOLAR_mean = mean(c_across(starts_with("JOBSSOLAR"))),
         RELYSOLAR_mean = mean(c_across(starts_with("RELYSOLAR"))),
         BEAUTYSOLAR_mean = mean(c_across(starts_with("BEAUTYSOLAR"))),
         HEALTHSOLAR_mean = mean(c_across(starts_with("HEALTHSOLAR"))),
         POLLUTESOLAR_mean = mean(c_across(starts_with("POLLUTESOLAR"))),
         DISPLACESOLAR_mean = mean(c_across(starts_with("DISPLACESOLAR"))),
  ) %>%
  ungroup()%>%
  dplyr::select(contains("_mean")) %>%
   rename_with(~ gsub("_mean$", "", .x))

  
  
# factor scores : characteristics of technology 
secopol2final <- data.frame(factor.scores(ecopols2means[, 1:10], ecopolfits2)$scores) 
                

```


### LMs : only characteristics of technology 

```{r, echo = FALSE}

ecopols2final <- secopol2final %>%
  rename(DevPride = MR1, SocialCosts = MR2)

kahannuclearfinal <- nkahanfinal%>%
  rename(Egalitarian = MR1, Communitarian = MR2)


s2allfinal <- cbind(formice1,ecopols2final, kahannuclearfinal)%>%
   mutate(Netben_Nuclear = Ben_Nuclear - Risky_Nuclear,
         Netben_Solar = Ben_Solar - Risky_Solar,
         Netben_Coal = Ben_Coal - Risky_Coal)

solar2lm <- lm(Risky_Solar ~ Uppercaste + Male + Hindu +Age+ urban_rural + State + DevPride + SocialCosts + Egalitarian + Communitarian , data = n2allfinal)

#summary(solar2lm)

netsolar2lm <- lm(Netben_Solar ~ Uppercaste + Male + Hindu +Age + urban_rural+ State + DevPride + SocialCosts + Egalitarian + Communitarian, data = n2allfinal)

#summary(netsolar2lm)


bensolar2lm <- lm(Ben_Solar ~ Uppercaste + Male + Hindu +Age + urban_rural+ State + DevPride + SocialCosts + Egalitarian + Communitarian, data = n2allfinal)

#summary(bensolar2lm)


```


\newpage 
### Stargazer : EFA characteristics of technology 

```{r, echo=FALSE, results='asis'}
library(stargazer)


cat("\\begingroup")
cat("\\setlength{\\tabcolsep}{1pt}")
cat("\\renewcommand{\\arraystretch}{0.7}")
stargazer(solar2lm,  bensolar2lm, netsolar2lm,
          title = "",
          type = "latex"
)
cat("\\endgroup")


```


```{r, echo=FALSE}


# covariance matrix fro mifa ecopol solar 
#miecopols$cov_combined

```



### Solar: Mifa with CFA (Pdevelop and Ndevelop)

```{r, echo = FALSE}

# dataset with all eco-pol vars 
#miecopols

## CFA on ecopol vars for solar energy 

ecopols_2fa <- '
  Ndevelop =~ DEVSOLAR + PRIDESOLAR + NPRIDESOLAR + PROSPERSOLAR + JOBSSOLAR
  Pdevelop =~ HEALTHSOLAR + BEAUTYSOLAR + DISPLACESOLAR + POLLUTESOLAR +ENVOVERDEV
'

secopol_cfa <- cfa(ecopols_2fa, sample.cov = miecopols$cov_combined, sample.nobs = 1099, std.lv = TRUE) # std.lv = TRUE to do variance standardization method
summary(secopol_cfa, fit.measure= TRUE, standardized = TRUE)



```


\blandscape
\newpage

### Pretty Table: CFA solar 

```{r, echo=FALSE}


# Extract parameter estimates
sparams <- parameterEstimates(secopol_cfa, standardized = TRUE)%>%
   slice(1:(n()-11))


sparams1 <- sparams %>%
  mutate(rhs = case_when(
  rhs == "DEVSOLAR" ~ "Solar energy pushes forward the country's development",
  rhs == "PRIDESOLAR" ~ "I would be proud if my community used Solar energy",
  rhs == "NPRIDESOLAR" ~ "Solar energy is a mark of pride for our nation",
  rhs == "PROSPERSOLAR" ~ "Solar energy brings economic prosperity to the surrounding regions",
  rhs == "JOBSSOLAR" ~ "Solar energy will bring jobs to the local community",
  rhs == "POLLUTESOLAR" ~ "Solar energy increases pollution of air/water/land",
  rhs == "HEALTHSOLAR" ~ "Solar energy poses a great risk to the health of people living around it",
  rhs == "BEAUTYSOLAR" ~ "Solar energy spoils the natural beauty of the landscape",
  rhs == "DISPLACESOLAR" ~ "Solar energy is leading to displacement of people from their land",
  rhs == "ENVOVERDEV" ~ "Polluting industries that spoil the environment should be shut down even if it costs people their jobs",
  rhs == "RELYSOLAR" ~ "I don't like the idea that I have to rely on the government for electricity from Solar energy",
  rhs == "INDUSTRYSMALL" ~ "Large corporations are destroying the local industries in India and benefiting only a handful of people",
  rhs == "OWNERREG" ~ "Regardless of ownership, the government should pass strong regulations and implement them",
  rhs == "MECHANISATION" ~ "Rapid mechanization of work is taking away jobs from workers in this country",
    TRUE ~ as.character(rhs)
  )) %>%
  dplyr::select(!c(lhs,op, std.nox)) %>%
    rename(
    "Items" = rhs,
    "Loadings" = est,
    "Standard Error" = se,
    "zvalue" = z) %>%
  mutate(across(c("Loadings", "Standard Error", "zvalue"), round, 3))
   

sparams1$Scale <- NA
sparams1$Scale[1:4] <- "People Centered Development"
sparams1$Scale[5:8] <- "Nationalist Development"
sparams1 <- sparams1[, c("Scale", setdiff(names(sparams1), "Scale"))]


CFAsolar <- knitr::kable(sparams1, booktabs = TRUE, caption = "Confirmatory Factor Analysis(CFA) on eco-pol scale (Solar Energy)") %>%
  kable_styling(latex_options = c("striped","scale_down", "hold_position", "repeat_header"))%>%
  column_spec(column = 2, width = "4cm")

# Print the table
CFAsolar %>%
  landscape()

```


```{r fit-measures-display, echo = FALSE}
# Extract fit measures
fit_measuress <- fitMeasures(secopol_cfa, fit.measures = c("CFI", "TLI", "RMSEA", "rmsea.ci.upper", "rmsea.ci.lower"))
fit_measuress2 <- fitMeasures(secopol_cfa)
# Convert to a data frame for presentation
fit_dfs <- data.frame(Measure = names(fit_measuress), Value = fit_measuress) %>%
  mutate(Measure = case_when(
    Measure == "cfi" ~ "Comparative Fit Index (CFI) ",
    Measure == "tli" ~ "Tucker-Lewis Index (TLI)",
    Measure == "rmsea" ~ "Root Mean Square Error of Approximation(RMSEA)",
    Measure == "rmsea.ci.upper" ~ "RMSEA 90 Percent confidence interval - lower",
    Measure == "rmsea.ci.lower" ~ "RMSEA 90 Percent confidence interval - upper",
    TRUE ~ as.character(Measure)
  )) %>%
  mutate(Value = round(Value, 3)) %>%
  remove_rownames()


#RMSEA - between 0.05 and 0.08 (reasonable fit), less than 0.05 close fit and greater than 0.10 is poor fit 
#CFI - greater than 0.90 or 0.95 indicates good fit
#TFI - CFI>TFI >0.90 - indicates good fit


```


# Confirmatory Factor Analysis(CFA): Solar 


```{r, echo =FALSE}
# Display fit measures using kable
knitr::kable(fit_dfs, caption = "Fit Measures: CFA Solar energy", booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position"))

```



\elandscape
### CFA SCORES (mean across all imputations)


```{r, echo=FALSE}

ecopolallscoress2 <- mice::complete(mice::mice(ecopols, m = 50, seed = 429, print = FALSE), "broad") 
            
ecopolallscoress2 <- ecopolallscoress2 %>%dplyr::select(-(contains(c("age", "urban_rural", "gender","caste","religion", "State"))))

#str(ecopolallscores)


secopol2 <- ecopolallscoress2 %>%
  rowwise() %>%
  mutate(DEVSOLAR_mean = mean(c_across(starts_with("DEVSOLAR"))),
         PROSPERSOLAR_mean = mean(c_across(starts_with("PROSPERSOLAR"))),
         NPRIDESOLAR_mean = mean(c_across(starts_with("NPRIDESOLAR"))),
         PRIDESOLAR_mean = mean(c_across(starts_with("PRIDESOLAR"))),
         JOBSSOLAR_mean = mean(c_across(starts_with("JOBSSOLAR"))),
         ECONOMYGLOBAL_mean = mean(c_across(starts_with("ECONOMYGLOBAL"))),
         WEALTHLIM_mean = mean(c_across(starts_with("WEALTHLIM"))),
         INDUSTRYLARGE_mean = mean(c_across(starts_with("INDUSTRYLARGE"))),
         DECISIONCEN_mean = mean(c_across(starts_with("DECISIONCEN"))),
         MECHANISATION_mean = mean(c_across(starts_with("MECHANISATION"))),
         OWNERNOREG_mean = mean(c_across(starts_with("OWNERNOREG"))),
         INDUSTRYSMALL_mean = mean(c_across(starts_with("INDUSTRYSMALL"))),
         DEVOVERENV_mean = mean(c_across(starts_with("DEVOVERENV"))),
         OWNERPVT_mean = mean(c_across(starts_with("OWNERPVT"))),
         RELYSOLAR_mean = mean(c_across(starts_with("RELYSOLAR"))),
         BEAUTYSOLAR_mean = mean(c_across(starts_with("BEAUTYSOLAR"))),
         HEALTHSOLAR_mean = mean(c_across(starts_with("HEALTHSOLAR"))),
         POLLUTESOLAR_mean = mean(c_across(starts_with("POLLUTESOLAR"))),
         DISPLACESOLAR_mean = mean(c_across(starts_with("DISPLACESOLAR"))),
         ENVOVERDEV_mean = mean(c_across(starts_with("ENVOVERDEV"))),
         OWNERPUB_mean = mean(c_across(starts_with("OWNERPUB"))),
         OWNERREG_mean = mean(c_across(starts_with("OWNERREG"))),
         DECISIONDECEN_mean = mean(c_across(starts_with("DECISIONDECEN"))),
         ECONOMYLOCAL_mean = mean(c_across(starts_with("ECONOMYLOCAL")))
  ) %>%
  ungroup()%>%
  dplyr::select(contains("_mean")) %>%
   rename_with(~ gsub("_mean$", "", .x))

  
```


```{r, echo = FALSE}

solarCFAscores <- predict(secopol_cfa, newdata = secopol2)

cfasolarscoresfinal  <- cbind(formice1, solarCFAscores, nkahanfinal) %>%
      rename(Egalitarian = MR1, Communitarian = MR2)%>%mutate(Netben_Nuclear = Ben_Nuclear - Risky_Nuclear,
         Netben_Solar = Ben_Solar - Risky_Solar,
         Netben_Coal = Ben_Coal - Risky_Coal)

```

###  CFA LMs: Risk, Ben, Net Ben X Pdevelop Ndevelop

```{r, echo = FALSE}


solarfinal4 <- lm(Risky_Solar ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian + Pdevelop + Ndevelop, data = cfasolarscoresfinal)

#summary(solarfinal4)

bensolar3lm <- lm(Ben_Solar ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian + Pdevelop + Ndevelop, data = cfasolarscoresfinal)

#summary(bensolar3lm)


netsolar3lm <- lm(Netben_Solar ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian + Pdevelop + Ndevelop, data = cfasolarscoresfinal)

#summary(netsolar3lm)


```




### Stargazer : CFA Pdevelop Ndevelop

```{r, echo=FALSE, results='asis'}
library(stargazer)


cat("\\begingroup")
cat("\\setlength{\\tabcolsep}{1pt}")
cat("\\renewcommand{\\arraystretch}{0.7}")
stargazer(solarfinal4,  bensolar3lm, netsolar3lm,
          title = "",
          type = "latex"
)
cat("\\endgroup")


```




## COAL
 
 
### Coal:MAR condition and missing data pattern
```{r, echo=FALSE}

ecopolc <- formice1 %>%
  dplyr::select(
    DECISIONDECEN, DECISIONCEN, INDUSTRYSMALL, INDUSTRYLARGE,
    ECONOMYLOCAL, ECONOMYGLOBAL, ENVOVERDEV,DEVOVERENV, OWNERPVT, OWNERPUB,
    OWNERREG, OWNERNOREG, WEALTHLIM, MECHANISATION,
    DISPLACECOAL,  POLLUTECOAL, HEALTHCOAL, JOBSCOAL, BEAUTYCOAL,
    PRIDECOAL, NPRIDECOAL, DEVCOAL, PROSPERCOAL,
    RELYCOAL,age, urban_rural, gender, caste, religion, State
  )

#md.pattern(ecopolc) #the variables with missing values:  

#mcar_test(data=ecopolc)
```







###  Mifa: EFA all ecopol

```{r, echo=FALSE}

 


miecopolc <- mifa(data= ecopolc,
                cov_vars  = -c("age", "gender", "caste", "State", "urban_rural", "religion"),
                m=50,
                n_pc= 2:4,
                ci = "fieller", 
                n_boot=1000,
                print = FALSE,
                progress= TRUE, 
                seed = 528,)



# EFA With mifa - all ecopol vars for coal
ecopolfitc <- psych::fa(miecopolc$cov_combined, nfactors = 3, rotate = "varimax")

print.psych(ecopolfitc, sort= TRUE, cut= 0.4)


```



### Dataset: only tech characters 


```{r, echo=FALSE}

ecopolc2 <- formice1 %>%
  dplyr::select(
    DISPLACECOAL,  POLLUTECOAL, HEALTHCOAL, JOBSCOAL, BEAUTYCOAL,
    PRIDECOAL, NPRIDECOAL, DEVCOAL, PROSPERCOAL,
    RELYCOAL,age, urban_rural, gender, caste, religion, State
  )

#md.pattern(ecopolc2) #the variables with missing values:  

#mcar_test(data=ecopolc2)
```


### EFA Mifa: only tech characters

```{r, echo=FALSE}



miecopolc2 <- mifa(data= ecopolc2,
                cov_vars  = -c("age", "gender", "caste", "State", "urban_rural", "religion"),
                m=50,
                n_pc= 2:4,
                ci = "fieller", 
                n_boot=1000,
                print = FALSE,
                progress= TRUE, 
                seed = 528,)



ecopolfitc2 <- psych::fa(miecopolc2$cov_combined, nfactors = 2, rotate = "varimax")

print.psych(ecopolfitc2, sort= TRUE, cut= 0.4)


```






```{r, echo = FALSE}

#cor.plot(ecopolc %>% dplyr::select(-c("age", "gender", "caste", "State", "urban_rural", "religion")))
```





### CFA Mifa: Pdevelop n Ndevelop

```{r, echo = FALSE}



# (DECISIONDECEN, DECISIONCEN, INDUSTRYSMALL, INDUSTRYLARGE,ECONOMYLOCAL, ECONOMYGLOBAL, ENVOVERDEV,DEVOVERENV, OWNERPVT, OWNERPUB,OWNERREG, OWNERNOREG, WEALTHLIM, MECHANISATION,DISPLACECOAL,  POLLUTECOAL, HEALTHCOAL, JOBSCOAL, BEAUTYCOAL,PRIDECOAL, NPRIDECOAL, DEVCOAL, PROSPERCOAL,RELYCOAL)



## CFA on ecopol vars for coal 

ecopolc_2fa <- '
  Ndevelop =~ DEVCOAL+ PROSPERCOAL + NPRIDECOAL + PRIDECOAL  + JOBSCOAL + ECONOMYGLOBAL+ WEALTHLIM+ INDUSTRYLARGE+ DECISIONCEN + MECHANISATION + DEVOVERENV
  Pdevelop =~ BEAUTYCOAL + + HEALTHCOAL + POLLUTECOAL 
  Pdevelop2 =~  DISPLACECOAL  + ENVOVERDEV +OWNERPUB
  
'

cecopol_cfa <- cfa(ecopolc_2fa, sample.cov = miecopolc$cov_combined, sample.nobs = 1099, std.lv = TRUE)
summary(cecopol_cfa, fit.measure= TRUE, standardized = TRUE)



```

\blandscape

\newpage
### Pretty Table
 

```{r, echo=FALSE}


# Extract parameter estimates
cparams <- parameterEstimates(cecopol_cfa, standardized = TRUE)%>%
   slice(1:(n()-17))


cparams1 <- cparams %>%
  mutate(rhs = case_when(
  rhs == "DISPLACECOAL" ~ "Coal powered plants is leading to displacement of people from their land",
  rhs == "BEAUTYCOAL" ~ "Coal powered plants spoils the natural beauty of the landscape",
  rhs == "POLLUTECOAL" ~ "Coal powered plants increases pollution of air/water/land",
  rhs == "HEALTHCOAL" ~ "Coal powered plants poses a great risk to the health of people living around it",
  rhs == "JOBSCOAL" ~ "Coal powered plants will bring jobs to the local community",
  rhs == "PRIDECOAL" ~ "I would be proud if my community used Coal powered plants",
  rhs == "NPRIDECOAL" ~ "Coal powered plants is a mark of pride for our nation",
  rhs == "DEVCOAL" ~ "Coal powered plants pushes forward the country's development",
  rhs == "PROSPERCOAL" ~ "Coal powered plants brings economic prosperity to the surrounding regions",
  rhs == "RELYCOAL" ~ "I don't like the idea that I have to rely on the government for electricity from Coal powered plants",
  rhs == "INDUSTRYSMALL" ~ "Large corporations are destroying the local industries in India and benefiting only a handful of people",
  rhs == "OWNERREG" ~ "Regardless of ownership, the government should pass strong regulations and implement them",
  rhs == "MECHANISATION" ~ "Rapid mechanization of work is taking away jobs from workers in this country",
  rhs == "OWNERNOREG" ~ "There is too much red-tape and the government should not interfere with businesses and industries",
  rhs == "DECISIONCEN" ~ "Laws and policies would be implemented more smoothly if more power lay with the central government",
  rhs == "OWNERPVT" ~ "All businesses and industries should be owned privately",
  rhs == "DEVOVERENV" ~ "Economic growth and creating jobs should be prioritized over environmental protection",
  rhs == "OWNERPUB" ~ "The government should own most large businesses and industries",
  rhs =="ENVOVERDEV" ~ "Polluting industries that spoil the environment should be shut down even if it costs people their jobs",
    TRUE ~ as.character(rhs)
  )) %>%
  dplyr::select(!c(lhs,op, std.nox)) %>%
    rename(
    "Items" = rhs,
    "Loadings" = est,
    "Standard Error" = se,
    "zvalue" = z) %>%
  mutate(across(c("Loadings", "Standard Error", "zvalue"), round, 3))
   

cparams1$Scale <- NA
cparams1$Scale[1:8] <- "People Centered Development"
cparams1$Scale[9:14] <- "Nationalist Development"
cparams1 <- cparams1[, c("Scale", setdiff(names(sparams1), "Scale"))]
CFAcoal <- knitr::kable(cparams1, booktabs = TRUE, caption = "Confirmatory Factor Analysis(CFA) on eco-pol scale (Coal)") %>%
  kable_styling(latex_options = c("striped","scale_down", "hold_position", "repeat_header"))%>%
  column_spec(column = 2, width = "4cm")

# Print the table
CFAcoal %>%
  landscape()

```

\elandscape



### EFA Scores: only tech characteristics 

```{r, echo=FALSE}



ecopolc2scores <- mice::complete(mice::mice(ecopolc2, m = 50, seed = 429, print = FALSE), "broad") 
            
ecopolc2scores <- ecopolc2scores %>%dplyr::select(-(contains(c("age", "urban_rural", "gender","caste","religion", "State"))))

#str(ecopolallscores)


ecopolc2means <- ecopolc2scores %>%
  rowwise() %>%
  mutate(DEVCOAL_mean = mean(c_across(starts_with("DEVCOAL"))),
         PROSPERCOAL_mean = mean(c_across(starts_with("PROSPERCOAL"))),
         NPRIDECOAL_mean = mean(c_across(starts_with("NPRIDECOAL"))),
         PRIDECOAL_mean = mean(c_across(starts_with("PRIDECOAL"))),
         JOBSCOAL_mean = mean(c_across(starts_with("JOBSCOAL"))),
         RELYCOAL_mean = mean(c_across(starts_with("RELYCOAL"))),
         BEAUTYCOAL_mean = mean(c_across(starts_with("BEAUTYCOAL"))),
         HEALTHCOAL_mean = mean(c_across(starts_with("HEALTHCOAL"))),
         POLLUTECOAL_mean = mean(c_across(starts_with("POLLUTECOAL"))),
         DISPLACECOAL_mean = mean(c_across(starts_with("DISPLACECOAL"))),
  ) %>%
  ungroup()%>%
  dplyr::select(contains("_mean")) %>%
   rename_with(~ gsub("_mean$", "", .x))

  
# factor scores - EFA 
cecopol2final <- data.frame(factor.scores(ecopolc2means[, 1:10], ecopolfitc2)$scores) 
                

```


### LMs : EFA only tech characs 

```{r, echo = FALSE}

ecopolc2final <- cecopol2final %>%
  rename(DevPride = MR1, SocialCosts = MR2)

kahannuclearfinal <- nkahanfinal%>%
  rename(Egalitarian = MR1, Communitarian = MR2)


c2allfinal <- cbind(formice1, ecopolc2final, kahannuclearfinal)%>%
   mutate(Netben_Nuclear = Ben_Nuclear - Risky_Nuclear,
         Netben_Solar = Ben_Solar - Risky_Solar,
         Netben_Coal = Ben_Coal - Risky_Coal)

coal2lm <- lm(Risky_Coal ~ Uppercaste + Male + Hindu +Age+ urban_rural + State + DevPride + SocialCosts + Egalitarian + Communitarian , data = c2allfinal)

#summary(coal2lm)

netcoal2lm <- lm(Netben_Coal ~ Uppercaste + Male + Hindu +Age+ urban_rural + State + DevPride + SocialCosts + Egalitarian + Communitarian, data = c2allfinal)

#summary(netcoal2lm)


bencoal2lm <- lm(Ben_Coal ~ Uppercaste + Male + Hindu +Age + urban_rural+ State + DevPride + SocialCosts + Egalitarian + Communitarian, data = c2allfinal)

#summary(bencoal2lm)


```


### CFA SCORES (mean across all imputations)

```{r, echo=FALSE}

ecopolallscoresc2 <- mice::complete(mice::mice(ecopolc, m = 50, seed = 429, print = FALSE), "broad") 
            
ecopolallscoresc2 <- ecopolallscoresc2 %>%dplyr::select(-(contains(c("age", "urban_rural", "gender","caste","religion", "State"))))

#str(ecopolallscores)


cecopol2 <- ecopolallscoresc2 %>%
  rowwise() %>%
  mutate(DEVCOAL_mean = mean(c_across(starts_with("DEVCOAL"))),
         PROSPERCOAL_mean = mean(c_across(starts_with("PROSPERCOAL"))),
         NPRIDECOAL_mean = mean(c_across(starts_with("NPRIDECOAL"))),
         PRIDECOAL_mean = mean(c_across(starts_with("PRIDECOAL"))),
         JOBSCOAL_mean = mean(c_across(starts_with("JOBSCOAL"))),
         ECONOMYGLOBAL_mean = mean(c_across(starts_with("ECONOMYGLOBAL"))),
         WEALTHLIM_mean = mean(c_across(starts_with("WEALTHLIM"))),
         INDUSTRYLARGE_mean = mean(c_across(starts_with("INDUSTRYLARGE"))),
         DECISIONCEN_mean = mean(c_across(starts_with("DECISIONCEN"))),
         MECHANISATION_mean = mean(c_across(starts_with("MECHANISATION"))),
         OWNERNOREG_mean = mean(c_across(starts_with("OWNERNOREG"))),
         INDUSTRYSMALL_mean = mean(c_across(starts_with("INDUSTRYSMALL"))),
         DEVOVERENV_mean = mean(c_across(starts_with("DEVOVERENV"))),
         OWNERPVT_mean = mean(c_across(starts_with("OWNERPVT"))),
         RELYCOAL_mean = mean(c_across(starts_with("RELYCOAL"))),
         BEAUTYCOAL_mean = mean(c_across(starts_with("BEAUTYCOAL"))),
         HEALTHCOAL_mean = mean(c_across(starts_with("HEALTHCOAL"))),
         POLLUTECOAL_mean = mean(c_across(starts_with("POLLUTECOAL"))),
         DISPLACECOAL_mean = mean(c_across(starts_with("DISPLACECOAL"))),
         ENVOVERDEV_mean = mean(c_across(starts_with("ENVOVERDEV"))),
         OWNERPUB_mean = mean(c_across(starts_with("OWNERPUB"))),
         OWNERREG_mean = mean(c_across(starts_with("OWNERREG"))),
         DECISIONDECEN_mean = mean(c_across(starts_with("DECISIONDECEN"))),
         ECONOMYLOCAL_mean = mean(c_across(starts_with("ECONOMYLOCAL")))
  ) %>%
  ungroup()%>%
  dplyr::select(contains("_mean")) %>%
   rename_with(~ gsub("_mean$", "", .x))

  
```


### Alpha test

```{r, echo=FALSE}

cNdevelop <-cecopol2 %>%
  dplyr::select((c(PRIDECOAL, NPRIDECOAL, DEVOVERENV, DECISIONCEN, OWNERPVT, OWNERNOREG, ECONOMYGLOBAL, DEVCOAL, PROSPERCOAL)))


cNdevelop_alpha <- psych::alpha(cNdevelop, check.keys = TRUE) # alpha = 0.75

cPdevelop <-cecopol2 %>%
  dplyr::select((c(BEAUTYCOAL , POLLUTECOAL , HEALTHCOAL , OWNERPUB , ENVOVERDEV , DISPLACECOAL)))

nPdevelop_alpha <- psych::alpha(nPdevelop , check.keys = TRUE) # alpha = 0.78


```


```{r, echo = FALSE}

coalCFAscores <- predict(cecopol_cfa, newdata = cecopol2)

cfacoalscoresfinal  <- cbind(formice1, coalCFAscores, nkahanfinal) %>%
      rename(Egalitarian = MR1, Communitarian = MR2)%>%mutate(Netben_Nuclear = Ben_Nuclear - Risky_Nuclear,
         Netben_Solar = Ben_Solar - Risky_Solar,
         Netben_Coal = Ben_Coal - Risky_Coal)

```

###  CFA LMs : Pdevelop Ndevelop 

```{r, echo = FALSE}


coalfinal4 <- lm(Risky_Coal ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian + Ndevelop + Pdevelop, data = cfacoalscoresfinal)

#summary(coalfinal4)

bencoal3lm <- lm(Ben_Coal ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian + Ndevelop + Pdevelop, data = cfacoalscoresfinal)

#summary(bencoal3lm)


netcoal3lm <- lm(Netben_Coal ~ Uppercaste + Male + Hindu + urban_rural + Age + State + Communitarian + Egalitarian + Ndevelop + Pdevelop, data = cfacoalscoresfinal)

#summary(netcoal3lm)


```



\blandscape
\newpage

## Stargazer : risk and benefit X all ecopol

```{r, echo=FALSE, results='asis'}
library(stargazer)


cat("\\begingroup")
cat("\\small")  # Adjusts the font size
cat("\\setlength{\\tabcolsep}{1pt}")
cat("\\renewcommand{\\arraystretch}{0.7}")
stargazer(nuclearfinal4, solarfinal4, coalfinal4, bennuclear3lm, bensolar3lm, bencoal3lm,
          title = " Perceived risk and Perceived benefit(Nuclear, Solar, Coal)",
          type = "latex"
)
cat("\\endgroup")


```
\elandscape

\newpage
## Stargazer : benefit X all ecopol

```{r, echo=FALSE, results='asis'}
library(stargazer)


cat("\\begingroup")
cat("\\setlength{\\tabcolsep}{1pt}")
cat("\\renewcommand{\\arraystretch}{0.7}")
stargazer( bennuclear3lm, bensolar3lm, bencoal3lm,
          title = "",
          type = "latex"
)
cat("\\endgroup")


```


\newpage

## Stargazer : net benefit X all ecopol

```{r, echo=FALSE, results='asis'}
library(stargazer)


cat("\\begingroup")
cat("\\setlength{\\tabcolsep}{1pt}")
cat("\\renewcommand{\\arraystretch}{0.7}")
stargazer(netnuclear3lm,  netsolar3lm, netcoal3lm,
          title = "",
          type = "latex"
)
cat("\\endgroup")


```

\newpage
\blandscape

## Stargazer : risk  X characteristics of tech 

```{r, echo=FALSE, results='asis'}
library(stargazer)


cat("\\begingroup")
cat("\\small")  # Adjusts the font size
cat("\\setlength{\\tabcolsep}{1pt}")
cat("\\renewcommand{\\arraystretch}{0.7}")
stargazer(nuclear2lm, solar2lm, coal2lm,bennuclear2lm, bensolar2lm, bencoal2lm,
          title = "",
          type = "latex"
)
cat("\\endgroup")

```

\elandscape

\newpage
## Stargazer : ben  X characteristics of tech 

```{r, echo=FALSE, results='asis'}
library(stargazer)


cat("\\begingroup")
cat("\\setlength{\\tabcolsep}{1pt}")
cat("\\renewcommand{\\arraystretch}{0.7}")
stargazer(bennuclear2lm, bensolar2lm, bencoal2lm, 
          title = "",
          type = "latex"
)
cat("\\endgroup")


```


\newpage
## Stargazer : netben  X characteristics of tech 

```{r, echo=FALSE, results='asis'}
library(stargazer)


cat("\\begingroup")
cat("\\setlength{\\tabcolsep}{1pt}")
cat("\\renewcommand{\\arraystretch}{0.7}")
stargazer(netnuclear2lm, netsolar2lm, netcoal2lm, 
          title = "",
          type = "latex"
)
cat("\\endgroup")


```






