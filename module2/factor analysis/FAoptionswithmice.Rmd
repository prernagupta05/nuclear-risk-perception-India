---
title: "FAoptionswithmice"
output:
  word_document: null
  keep_md: yes
---


```{r load packages, warning = FALSE, message = FALSE, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(tsibble))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(psych))
library(officer)
library(magrittr)

```



```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
moduletwo <- read_excel(here::here("thesis_surveydata/political_factors_complete.xlsx"))
save(moduletwo, file = "moduletwo.rda")
module2 <- data.frame(moduletwo)
module2[module2 == "Rather not say/ Don't know"] <- "Rather not say/Don't know"
#module2 %>% filter(!row_number() %in% c(1,2))

# loaded data set for module 2 eco -pol variables and removes the rows with question number and question text
```


```{r, eval =TRUE, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
#This chunk contains the coding schemes of various scales used in survey one: eco-political factors, kahan scale and acceptance scale
codedmodule2 <- module2 %>%
  
#remove row 1
  filter(!row_number() %in% c(1,2)) %>% 
  
# replace risky likert scale with numbers
  mutate_at(vars(starts_with("Risky")), funs(case_when(. =="Not at all risky" ~ 1, 
                                                       . =="Slightly risky" ~ 2, 
                                                       . =="Moderately risky" ~ 3, 
                                                       . =="Very risky" ~ 4, 
                                                       . =="Extremely risky" ~ 5))) %>%

# replace beneficial likert scale with numbers  
  mutate_at(vars(starts_with("Ben")), funs(case_when(. =="Not at all beneficial" ~ 1,
                                                     . =="Slightly beneficial" ~ 2,
                                                     . =="Moderately beneficial" ~ 3,
                                                     . =="Very beneficial" ~ 4,
                                                     . =="Extremely beneficial" ~ 5 ))) %>%

# replace nuclear acceptance likert scale with numbers
  mutate_at(vars(N_accept,N_reluctantlyaccept,N_reject), funs(case_when(. == "Strongly disagree" ~ 1, 
                                                                        . == "Somewhat disagree" ~ 2,
                                                                        . == "Neither agree nor disagree" ~3,
                                                                        . == "Somewhat agree" ~ 4,
                                                                        . == "Strongly agree" ~ 5))) %>%
  
# code likert scale for variables for Kahan scale into numbers
  mutate_at(vars(starts_with (c("K_I","K_H","DISPLACE", "POLLUTE", "HEALTH", "JOBS", "BEAUTY", "PRIDE", "NPRIDE", "DEVNUCLEAR","DEVSOLAR", "DEVCOAL", "PROSPER", "RELY"))), funs(case_when(. == "Strongly disagree" ~ 1, 
               . == "Somewhat disagree" ~ 2,
               . == "Neither agree nor disagree" ~3,
               . == "Somewhat agree" ~ 4,
               . == "Strongly agree" ~ 5))) %>%
  
# reverse code for likert scale for variables for Kahan scale into numbers
mutate_at(vars(starts_with (c("K_S","K_E"))), funs(case_when(. == "Strongly disagree" ~ 5, 
                                                               . == "Somewhat disagree" ~ 4,
                                                               . == "Neither agree nor disagree" ~3,
                                                               . == "Somewhat agree" ~ 2,
                                                               . == "Strongly agree" ~ 1))) %>%

# code eco-pol scale variables into numbers
  mutate_at(vars(SYSTEMDEMO,SYSTEMRELIGION,SYSTEMTECHNO,SYSTEMTOTAL,WEALTHLIM,MECHANISATION,DECISIONDECEN,INDUSTRYSMALL,ECONOMYLOCAL,ENVOVERDEV,OWNERPUB, OWNERREG), funs(case_when(. == "Strongly disagree" ~ 1, 
                        . == "Somewhat disagree" ~ 2,
                        . == "Neither agree nor disagree" ~3,
                        . == "Somewhat agree" ~ 4,
                        . == "Strongly agree" ~ 5))) %>%

# reverse code eco-pol scale variables into numbers 
 mutate_at(vars(DECISIONCEN,INDUSTRYLARGE,ECONOMYGLOBAL,OWNERPVT,OWNERNOREG, DEVOVERENV), funs(case_when(. == "Strongly disagree" ~ 1, 
                                                                                                         . == "Somewhat disagree" ~ 2,
                                                                                                         . == "Neither agree nor disagree" ~3,
                                                                                                         . == "Somewhat agree" ~ 4,
                                                                                                         . == "Strongly agree" ~ 5)))%>%
  mutate_all(~ifelse(. == "Rather not say/ Don't know", "Rather not say/Don't know", .))%>%
  mutate_all(~ifelse(. == "West bengal", "West Bengal", .))%>%
  mutate_all(~ifelse(. == "WEST BENGAL", "West Bengal", .))%>%
  mutate_all(~ifelse(. == "Up", "Uttar Pradesh", .))%>%
  mutate_all(~ifelse(. == "Tamilnadu", "Tamil Nadu", .))%>%
  mutate_all(~ifelse(. == "UP", "Uttar Pradesh", .))%>%
  mutate_at(vars(age), funs(case_when(. == "18-24 years old" ~ 1, 
                                      . == "25-34 years old" ~ 2,
                                      . ==  "35-44 years old" ~3,
                                      . == "45-54 years old" ~ 4,
                                      . == "55-64 years old" ~ 5,
                                      . == "65-74 years old" ~ 6,
                                      . == "75 years or older" ~ 7)))
```

```{r, echo = FALSE}
#sort demo vars 


# # Convert `caste` into binary variable 'upper' (1) vs 'non-upper' (0)
joineddf$Uppercaste <- ifelse(joineddf$caste %in% c('Brahmin', 'General'), 1, 0)
# Convert `gender` into binary variable 'male' (1) vs 'female' (0)
joineddf$Male <- ifelse(joineddf$gender == 'Male', 1, 0)
# Convert `religion` into binary variable 'Hinduism' (1) vs 'Non-Hinduism' (0)
joineddf$Hindu <- ifelse(joineddf$religion == 'Hinduism', 1, 0)
codedmodule2$State <- as.factor(codedmodule2$State)
codedmodule2$gender <- as.factor(codedmodule2$gender)
codedmodule2$Urban <- as.factor(codedmodule2$urban_rural)
joineddf$Urban <- as.factor(joineddf$urban_rural)
codedmodule2$caste <- as.factor(codedmodule2$caste)
codedmodule2$religion <- as.factor(codedmodule2$religion)
# # Convert `caste` into binary variable 'upper' (1) vs 'non-upper' (0)
codedmodule2$Uppercaste <- ifelse(codedmodule2$caste %in% c('Brahmin', 'General'), 1, 0)
# Convert `gender` into binary variable 'male' (1) vs 'female' (0)
codedmodule2$Male <- ifelse(codedmodule2$gender == 'Male', 1, 0)
# Convert `religion` into binary variable 'Hinduism' (1) vs 'Non-Hinduism' (0)
codedmodule2$Hindu <- ifelse(codedmodule2$religion == 'Hinduism', 1, 0)

codedmodule21 <- codedmodule2 %>%
            dplyr::select(Risky_Nuclear, Risky_Solar, Risky_Coal, Uppercaste, Male, Hindu, Urban, age, State) %>%
            na.omit()

# lm on nuclear energy with all demovars

alldemos <- codedmodule21 %>%
            dplyr::select(Risky_Nuclear, Uppercaste, Male, Hindu, Urban, age, State) %>%
  mutate_at(vars(age), funs(case_when(. == "18-24 years old" ~ 1, 
                                      . == "25-34 years old" ~ 2,
                                      . ==  "35-44 years old" ~3,
                                      . == "45-54 years old" ~ 4,
                                      . == "55-64 years old" ~ 5,
                                      . == "65-74 years old" ~ 6,
                                      . == "75 years or older" ~ 7)))
```







# Two factor solution (Combined Scales): People Centered Development and Nationalist Development 


## Nuclear- Factor Analysis 


```{r, echo=FALSE}
fascales <- codedmodule2 %>%
  dplyr::select(starts_with(c("K_","Risky_Nuclear","WEALTHLIM","MECHANISATION","DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","INDUSTRYSMALL","ECONOMYGLOBAL","ECONOMYLOCAL", "ENVOVERDEV","DEVOVERENV","OWNERPVT","OWNERNOREG","OWNERPUB", "OWNERREG","DISPLACENUCLEAR",  "POLLUTENUCLEAR", "HEALTHNUCLEAR", "JOBSNUCLEAR", "BEAUTYNUCLEAR", "PRIDENUCLEAR", "NPRIDENUCLEAR", "DEVNUCLEAR", "PROSPERNUCLEAR", "RELYNUCLEAR","SYSTEMDEMO","SYSTEMRELIGION", "SYSTEMTECHNO","SYSTEMTOTAL", "Uppercaste", "Male", "Hindu", "Urban", "State","age")))%>%
  mutate_at(vars(age), funs(case_when(. == "18-24 years old" ~ 1, 
                                      . == "25-34 years old" ~ 2,
                                      . ==  "35-44 years old" ~3,
                                      . == "45-54 years old" ~ 4,
                                      . == "55-64 years old" ~ 5,
                                      . == "65-74 years old" ~ 6,
                                      . == "75 years or older" ~ 7))) %>%
  na.omit()
```

```{r, echo=FALSE}
# Q6: Does the Kahan scale explain perception of risk from nuclear energy and other DVs ? 

# we conducted fa on the kahan scale 
# CFA for Kahan scale. We shouldn't do FA here since this a well used scale with theoretical basis for factor distinctions and also previous studies using the same scale 

library(lavaan)
library(semTools)
library(kableExtra)

fascales <- codedmodule2 %>%
  dplyr::select(starts_with(c("K_","Risky_Nuclear","WEALTHLIM","MECHANISATION","DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","INDUSTRYSMALL","ECONOMYGLOBAL","ECONOMYLOCAL", "ENVOVERDEV","DEVOVERENV","OWNERPVT","OWNERNOREG","OWNERPUB", "OWNERREG","DISPLACENUCLEAR",  "POLLUTENUCLEAR", "HEALTHNUCLEAR", "JOBSNUCLEAR", "BEAUTYNUCLEAR", "PRIDENUCLEAR", "NPRIDENUCLEAR", "DEVNUCLEAR", "PROSPERNUCLEAR", "RELYNUCLEAR", "Uppercaste", "Male", "Hindu", "Urban", "State","age")))%>%
  na.omit()

Kahan_fas <- '
  KahanS =~ K_SHARM + K_SLIMCHOI + K_SPROTECT 
  KahanH =~ K_HEQUAL+ K_ERADEQ1 + K_EWEALTH + K_ERADEQ2
'

# Run CFA
Kahan_cfa <- cfa(Kahan_fas, data = fascales, std.lv = TRUE)

# Print the summary of the CFA results, including fit measures
#summary(Kahan_cfa, fit.measure= TRUE, standardized = TRUE)

# RMSEA - between 0.05 and 0.08 (reasonable fit), less than 0.05 close fit and greater than 0.10 is poor fit 
# CFI - greater than 0.90 or 0.95 indicates good fit
#TFI - CFI>TFI >0.90 - indicates good fit
#pvalue should be greater than 0.05 p > 0.0.5

# after having removed a few variables that had very low loading, the model is now a good fit, we have two latent variables - Hierarchy- egalitarian and Communitarian. Again we see that individualistic variables just don't fit here. 

# creating table of factor scores 

Kahan_scores <- predict(Kahan_cfa, newdata = fascales)

Kahan_Kscores <- cbind(fascales, Kahan_scores)


## RMSEA is still pretty big. 


```


```{r, echo = FALSE}

# the psych code for FA on eco-pol scale for nuclear energy - all vars combined 

library(psych)
library(tidyverse)



ecopolall <- fascales %>%
        dplyr::select("WEALTHLIM","MECHANISATION","DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","INDUSTRYSMALL","ECONOMYGLOBAL","ECONOMYLOCAL", "ENVOVERDEV","DEVOVERENV","OWNERPVT","OWNERNOREG","OWNERPUB", "OWNERREG","DISPLACENUCLEAR",  "POLLUTENUCLEAR", "HEALTHNUCLEAR", "BEAUTYNUCLEAR", "PRIDENUCLEAR", "NPRIDENUCLEAR", "DEVNUCLEAR", "RELYNUCLEAR","PROSPERNUCLEAR", "JOBSNUCLEAR")%>%
    rename(
      "Limits on Wealth " = "WEALTHLIM",
      "Anti Mechanisation of work" = "MECHANISATION",
      "Pro Decentralisation" = "DECISIONDECEN",
      "Pro Centralisation" = "DECISIONCEN",
      "Pro Large Industries" = "INDUSTRYLARGE",
      "Anti Large Industries " = "INDUSTRYSMALL",
      "Pro Globaleconomy" = "ECONOMYGLOBAL",
      "Pro Localeconomy" = "ECONOMYLOCAL",
      "Environment over Development" = "ENVOVERDEV",
      "Development over Environment" = "DEVOVERENV",
      "Pro Private ownership " = "OWNERPVT",
      "Anti Regulations" = "OWNERNOREG",
      "Pro Public ownership" = "OWNERPUB",
      "Pro Regulations" = "OWNERREG",
      "Displacement risk(nuclear)" = "DISPLACENUCLEAR",
      "Pollution risk(nuclear) " = "POLLUTENUCLEAR",
      "Health risk(nuclear)" = "HEALTHNUCLEAR",
      "Job opportunities(nuclear)" = "JOBSNUCLEAR",
      "Spoils Natural Beauty(nuclear)" = "BEAUTYNUCLEAR",
      "Local prosperity(nuclear)" = "PROSPERNUCLEAR",
      "Community pride(nuclear)" = "PRIDENUCLEAR",
      "National pride(nuclear)" = "NPRIDENUCLEAR",
      "National development(nuclear)" = "DEVNUCLEAR",
      "Reliance on government(nuclear)" = "RELYNUCLEAR"
    )


ecopolall2.fa <- fa(ecopolall, nfactors = 2, rotate = "varimax")

print.psych(ecopolall2.fa, cut = 0.4, sort = TRUE)

ecopol_fas <- '
  Pdevelop =~ HEALTHNUCLEAR + BEAUTYNUCLEAR + DISPLACENUCLEAR + POLLUTENUCLEAR + INDUSTRYSMALL + OWNERREG + MECHANISATION
  Ndevelop =~ DEVNUCLEAR + PROSPERNUCLEAR + PRIDENUCLEAR + NPRIDENUCLEAR + JOBSNUCLEAR
'
ecopol_cfa <- cfa(ecopol_fas, data = fascales, std.lv = TRUE)
summary(ecopol_cfa, fit.measure= TRUE, standardized = TRUE)

```



## Nuclear - FA 2 factor solution

```{r, echo=FALSE}

library(flextable)

set_flextable_defaults(docx.landscape = TRUE)

flex <- function(data, title=NULL) {
  # this grabs the data and converts it to a flextbale
  flextable(data) %>%
  # this makes the table fill the page width
  set_table_properties(layout = "autofit", width = 1) %>%
  # font size
  fontsize(size=10, part="all") %>%
    #this adds a ttitlecreates an automatic table number
      set_caption(title, 
                  autonum = officer::run_autonum(seq_id = "tab", 
                                                 pre_label = "Table ", 
                                                 post_label = "\n", 
                                                 bkm = "anytable")) #%>%
  # font type
  #font(fontname="Times New Roman", part="all")
}

rename_map <- c(
  "Limits on Wealth" = "A limit should be put to how much wealth a person can amass",
  "Anti Mechanisation of work" = "Rapid mechanization of work is taking away jobs from workers in this country",
  "Pro Decentralisation" = "Local politicians shouldn't have to ask permission from the central government to implement policies",
  "Pro Centralisation" = "Laws and policies would be implemented more smoothly if more power lay with the central government",
  "Pro Large Industries" = "Large scale industries are required for the development of the country that will benefit everyone",
  "Anti Large Industries" = "Large corporations are destroying the local industries in India and benefiting only a handful of people",
  "Pro Globaleconomy" = "Foreign companies have led to a range of benefits for the Indian people and society",
  "Pro Localeconomy" = "India would be better off if foreign companies didn't come to here",
  "Environment over Development" = "Polluting industries that spoil the environment should be shut down even if it costs people their jobs",
  "Development over Environment" = "Economic growth and creating jobs should be prioritized over environmental protection",
  "Pro Private ownership" = "All businesses and industries should be owned privately",
  "Anti Regulations" = "There is too much red-tape and the government should not interfere with businesses and industries",
  "Pro Public ownership" = "The government should own most large businesses and industries",
  "Pro Regulations" = " Regardless of ownership, the government should pass strong regulations and implement them",
  "Displacement risk(nuclear)" = "Nuclear energy is leading to displacement of people from their land",
  "Spoils Natural Beauty(nuclear)" = "Nuclear energy spoils the natural beauty of the landscape",
  "Pollution risk(nuclear)" = "Nuclear energy increases pollution of air/water/land",
  "Health risk(nuclear)" = "Nuclear energy poses a great risk to the health of people living around it",
  "Job opportunities(nuclear)" = "Nuclear energy will bring jobs to the local community",
  "Community pride(nuclear)" = "I would be proud if my community used nuclear energy",
  "National pride(nuclear)" = "Nuclear energy is a mark of pride for our nation",
  "National development(nuclear)" = "Nuclear energy pushes forward the country's development",
  "Local prosperity(nuclear)" = "Nuclear energy brings economic prosperity to the surrounding regions",
  "Reliance on government(nuclear)" = "I don't like the idea that I have to rely on the government for electricity from nuclear energy"
)


fa_table <- function(x, cut) {
  #get sorted loadings
  loadings <- fa.sort(x)$loadings %>% round(3)
  #suppress loadings
  loadings[loadings > -cut & loadings < cut] <- ""
  #get additional info  
  add_info <- cbind(x$communalities, 
                    x$uniquenesses,
                    x$complexity) %>%
    # make it a data frame
    as.data.frame() %>%
    # column names
    rename("Communality" = V1,
           "Uniqueness" = V2,
           "Complexity" = V3) %>%
    #get the item names from the vector
    rownames_to_column("item")
  
  #build table
  loadings %>%
    unclass() %>%
    as.data.frame() %>%
    rownames_to_column("item") %>%
    left_join(add_info) %>%
    mutate(
      item = if_else(item %in% names(rename_map), rename_map[item], item),
      code = names(rename_map)[match(item, rename_map)], # extracting short form
      across(where(is.numeric), round, 3)
    ) %>%
    dplyr::select(code, everything()) # reorder columns to bring code to the front
}

fa_table(ecopolall2.fa, .4) %>%
  rename(Pdevelop = MR1, Ndevelop = MR2, Items= item) %>%
  flex("2 factor solution") %>%
  autofit()


```



```{r, echo = FALSE}
ecopolall2.fa[["Vaccounted"]] %>%
  as.data.frame() %>%
  rownames_to_column("Property") %>%
  rename(Pdevelop = MR1, Ndevelop = MR2) %>%
    mutate(across(where(is.numeric), round, 3)) %>%
    flex("Eigenvalues and Variance Explained for 2 Factor Solution")
```

\newpage 
## Nuclear - linear regression with 2 Factor solution 

```{r, echo=FALSE}

# Linear Model with 2 factor solution for  Risk perception from Nuclear Energy 

#binding factor scores to the dataset
ecopolall_scores <- predict(ecopol_cfa, newdata = fascales)

fascale_scores <- cbind(Kahan_Kscores, ecopolall_scores)# %>%
  #rename(Pdevelop = MR1)%>%
  #rename(Ndevelop = MR2)

nuclearfa2 <- lm(Risky_Nuclear ~ age + Uppercaste + Male + Hindu + Urban + State + KahanS + KahanH + Pdevelop + Ndevelop, data = fascale_scores)

#m2_allscales <- lm(Risky_Nuclear ~ age + Uppercaste + Male + Hindu + Urban +State+ KahanS + KahanH + NPRIDENUCLEAR + PRIDENUCLEAR + DEVNUCLEAR + PROSPERNUCLEAR, data = fascale_scores)
# Print model summary
summary(nuclearfa2)

```








\newpage
## Solar : P develop and Ndevelop

```{r, echo=FALSE}
library(psych)
library(tidyverse)

sfascales <- codedmodule2 %>%
  dplyr::select(starts_with(c("K_","Risky_Solar","WEALTHLIM","MECHANISATION","DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","INDUSTRYSMALL","ECONOMYGLOBAL","ECONOMYLOCAL", "ENVOVERDEV","DEVOVERENV","OWNERPVT","OWNERNOREG","OWNERPUB", "OWNERREG","DISPLACESOLAR", "POLLUTESOLAR", "HEALTHSOLAR", "JOBSSOLAR", "BEAUTYSOLAR", "PRIDESOLAR", "NPRIDESOLAR", "DEVSOLAR", "PROSPERSOLAR", "RELYSOLAR", "Uppercaste", "Male", "Hindu", "Urban", "State","age")))%>%
  na.omit()

secopolall <- sfascales %>%
        dplyr::select("WEALTHLIM","MECHANISATION","DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","INDUSTRYSMALL","ECONOMYGLOBAL","ECONOMYLOCAL", "ENVOVERDEV","DEVOVERENV","OWNERPVT","OWNERNOREG","OWNERPUB", "OWNERREG","DISPLACESOLAR", "POLLUTESOLAR", "HEALTHSOLAR", "JOBSSOLAR", "BEAUTYSOLAR", "PRIDESOLAR", "NPRIDESOLAR", "DEVSOLAR", "PROSPERSOLAR", "RELYSOLAR")%>%
    rename(
      "Limits on Wealth " = "WEALTHLIM",
      "Anti Mechanisation of work" = "MECHANISATION",
      "Pro Decentralisation" = "DECISIONDECEN",
      "Pro Centralisation" = "DECISIONCEN",
      "Pro Large Industries" = "INDUSTRYLARGE",
      "Anti Large Industries " = "INDUSTRYSMALL",
      "Pro Globaleconomy" = "ECONOMYGLOBAL",
      "Pro Localeconomy" = "ECONOMYLOCAL",
      "Environment over Development" = "ENVOVERDEV",
      "Development over Environment" = "DEVOVERENV",
      "Pro Private ownership " = "OWNERPVT",
      "Anti Regulations" = "OWNERNOREG",
      "Pro Public ownership" = "OWNERPUB",
      "Pro Regulations" = "OWNERREG",
      "Displacement risk(solar)" = "DISPLACESOLAR",
      "Pollution risk(solar) " = "POLLUTESOLAR",
      "Health risk(solar)" = "HEALTHSOLAR",
      "Job opportunities(solar)" = "JOBSSOLAR",
      "Spoils Natural Beauty(solar)" = "BEAUTYSOLAR",
      "Community pride(solar)" = "PRIDESOLAR",
      "National pride(solar)" = "NPRIDESOLAR",
      "National development(solar)" = "DEVSOLAR",
      "Local prosperity(solar)" = "PROSPERSOLAR",
      "Reliance on government(solar)" = "RELYSOLAR"
    )

secopolall2.fa <- fa(secopolall, nfactors = 2, rotate = "varimax")


```

## EFA : Two factor soltuion 

```{r, echo=FALSE}

library(flextable)

set_flextable_defaults(docx.landscape = TRUE)

flex <- function(data, title=NULL) {
  # this grabs the data and converts it to a flextbale
  flextable(data) %>%
  # this makes the table fill the page width
  set_table_properties(layout = "autofit", width = 1) %>%
  # font size
  fontsize(size=10, part="all") %>%
    #this adds a ttitlecreates an automatic table number
      set_caption(title, 
                  autonum = officer::run_autonum(seq_id = "tab", 
                                                 pre_label = "Table ", 
                                                 post_label = "\n", 
                                                 bkm = "anytable")) #%>%
  # font type
  #font(fontname="Times New Roman", part="all")
}

srename_map <- c(
  "Limits on Wealth" = "A limit should be put to how much wealth a person can amass",
  "Anti Mechanisation of work" = "Rapid mechanization of work is taking away jobs from workers in this country",
  "Pro Decentralisation" = "Local politicians shouldn't have to ask permission from the central government to implement policies",
  "Pro Centralisation" = "Laws and policies would be implemented more smoothly if more power lay with the central government",
  "Pro Large Industries" = "Large scale industries are required for the development of the country that will benefit everyone",
  "Anti Large Industries" = "Large corporations are destroying the local industries in India and benefiting only a handful of people",
  "Pro Globaleconomy" = "Foreign companies have led to a range of benefits for the Indian people and society",
  "Pro Localeconomy" = "India would be better off if foreign companies didn't come to here",
  "Environment over Development" = "Polluting industries that spoil the environment should be shut down even if it costs people their jobs",
  "Development over Environment" = "Economic growth and creating jobs should be prioritized over environmental protection",
  "Pro Private ownership" = "All businesses and industries should be owned privately",
  "Anti Regulations" = "There is too much red-tape and the government should not interfere with businesses and industries",
  "Pro Public ownership" = "The government should own most large businesses and industries",
  "Pro Regulations" = "Regardless of ownership, the government should pass strong regulations and implement them",
  "Displacement risk(solar)" = "Solar energy is leading to displacement of people from their land",
  "Spoils Natural Beauty(solar)" = "Solar energy spoils the natural beauty of the landscape",
  "Pollution risk(solar)" = "Solar energy increases pollution of air/water/land",
  "Health risk(solar)" = "Solar energy poses a great risk to the health of people living around it",
  "Job opportunities(solar)" = "Solar energy will bring jobs to the local community",
  "Community pride(solar)" = "I would be proud if my community used solar energy",
  "National pride(solar)" = "Solar energy is a mark of pride for our nation",
  "National development(solar)" = "Solar energy pushes forward the country's development",
  "Local prosperity(solar)" = "Solar energy brings economic prosperity to the surrounding regions",
  "Reliance on government(solar)" = "I don't like the idea that I have to rely on the government for electricity from solar energy"
)


fa_table <- function(x, cut) {
  #get sorted loadings
  loadings <- fa.sort(x)$loadings %>% round(3)
  #suppress loadings
  loadings[loadings > -cut & loadings < cut] <- ""
  #get additional info  
  add_info <- cbind(x$communalities, 
                    x$uniquenesses,
                    x$complexity) %>%
    # make it a data frame
    as.data.frame() %>%
    # column names
    rename("Communality" = V1,
           "Uniqueness" = V2,
           "Complexity" = V3) %>%
    #get the item names from the vector
    rownames_to_column("item")
  
  #build table
  loadings %>%
    unclass() %>%
    as.data.frame() %>%
    rownames_to_column("item") %>%
    left_join(add_info) %>%
    mutate(
      item = if_else(item %in% names(srename_map), srename_map[item], item),
      code = names(srename_map)[match(item, srename_map)], # extracting short form
      across(where(is.numeric), round, 3)
    ) %>%
    dplyr::select(code, everything()) # reorder columns to bring code to the front
}

fa_table(secopolall2.fa, .4) %>%
  #rename(Pdevelop = MR1, Ndevelop = MR2, Items= item) %>%
  flex("2 factor solution") %>%
  autofit()


```



```{r, echo = FALSE}
secopolall2.fa[["Vaccounted"]] %>%
  as.data.frame() %>%
  rownames_to_column("Property") %>%
  #rename(Pdevelop = MR1, Ndevelop = MR2) %>%
    mutate(across(where(is.numeric), round, 3)) %>%
    flex("Solar: Eigenvalues and Variance Explained for 2 Factor Solution")
```
\newpage

# CFA on solar energy - 2 factor solution 
```{r, echo = FALSE}
# kahan scores for solar 
sfascales <- codedmodule2 %>%
  dplyr::select(starts_with(c("K_","Risky_Solar","WEALTHLIM","MECHANISATION","DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","INDUSTRYSMALL","ECONOMYGLOBAL","ECONOMYLOCAL", "ENVOVERDEV","DEVOVERENV","OWNERPVT","OWNERNOREG","OWNERPUB", "OWNERREG","DISPLACESOLAR",  "POLLUTESOLAR", "HEALTHSOLAR", "JOBSSOLAR", "BEAUTYSOLAR", "PRIDESOLAR", "NPRIDESOLAR", "DEVSOLAR", "PROSPERSOLAR", "RELYSOLAR", "Uppercaste", "Male", "Hindu", "Urban", "State","age")))%>%
  na.omit()

sKahan_fas <- '
  KahanS =~ K_SHARM + K_SLIMCHOI + K_SPROTECT 
  KahanH =~ K_HEQUAL+ K_ERADEQ1 + K_EWEALTH + K_ERADEQ2
'

# Run CFA
sKahan_cfa <- cfa(sKahan_fas, data = sfascales, std.lv = TRUE)

# Print the summary of the CFA results, including fit measures
summary(sKahan_cfa, fit.measure= TRUE, standardized = TRUE)

sKahan_scores <- predict(sKahan_cfa, newdata = sfascales)

sKahan_Kscores <- cbind(sfascales, sKahan_scores)

sm1_kahan <- lm(Risky_Solar ~ Uppercaste + Male + Hindu + Urban + age + State + KahanS + KahanH , data = sKahan_Kscores)


## CFA on ecopol vars for solar energy 

secopol_fas <- '
  Pdevelop =~ HEALTHSOLAR + BEAUTYSOLAR + DISPLACESOLAR + POLLUTESOLAR + INDUSTRYSMALL + OWNERREG + MECHANISATION
  Ndevelop =~ DEVSOLAR + PRIDESOLAR + NPRIDESOLAR + PROSPERSOLAR + JOBSSOLAR
'

secopol_cfa <- cfa(secopol_fas, data = sfascales, std.lv = TRUE)
summary(secopol_cfa, fit.measure= TRUE, standardized = TRUE)



# Cronbach's alpha test on Pdevelop and Ndevelop for Solar energy 

solarpdevelop <- sfascales %>%
  dplyr::select(HEALTHSOLAR, BEAUTYSOLAR, DISPLACESOLAR, POLLUTESOLAR, INDUSTRYSMALL, OWNERREG, MECHANISATION)%>%
  na.omit()

solarpdevelop.alpha <- psych::alpha(solarpdevelop, check.keys = TRUE)

# alpha is strong at 0.75!

solarndevelop <- sfascales %>%
  dplyr::select(DEVSOLAR, PRIDESOLAR, NPRIDESOLAR, PROSPERSOLAR, JOBSSOLAR)%>%
  na.omit()

solarndevelop.alpha <- psych::alpha(solarndevelop, check.keys = TRUE)

#alpha is strong at 0.86!


```


## Solar - linear regression with 2 Factor solution 

```{r, echo=FALSE}

# Linear Model with 2 factor solution for  Risk perception from Solar Energy 

#binding factor scores to the dataset
secopolall_scores <- predict(secopol_cfa, newdata = sfascales)

sfascale_scores <- cbind(sKahan_Kscores, secopolall_scores)# %>%
  #rename(Pdevelop = MR1)%>%
  #rename(Ndevelop = MR2)

solar2fa <- lm(Risky_Solar ~ age + Uppercaste + Male + Hindu + Urban + State + KahanS + KahanH + Pdevelop + Ndevelop, data = sfascale_scores)

#m2_allscales <- lm(Risky_Nuclear ~ age + Uppercaste + Male + Hindu + Urban +State+ KahanS + KahanH + NPRIDENUCLEAR + PRIDENUCLEAR + DEVNUCLEAR + PROSPERNUCLEAR, data = fascale_scores)
# Print model summary
summary(solar2fa)

```




\newpage
## Coal 

```{r, echo = FALSE}

cecopolall <- codedmodule2 %>%
        dplyr::select("WEALTHLIM","MECHANISATION","DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","INDUSTRYSMALL","ECONOMYGLOBAL","ECONOMYLOCAL", "ENVOVERDEV","DEVOVERENV","OWNERPVT","OWNERNOREG","OWNERPUB", "OWNERREG","DISPLACECOAL", "POLLUTECOAL", "HEALTHCOAL", "JOBSCOAL", "BEAUTYCOAL", "PRIDECOAL", "NPRIDECOAL", "DEVCOAL", "PROSPERCOAL", "RELYCOAL")%>%
      rename(
      "Limits on Wealth " = "WEALTHLIM",
      "Anti Mechanisation of work" = "MECHANISATION",
      "Pro Decentralisation" = "DECISIONDECEN",
      "Pro Centralisation" = "DECISIONCEN",
      "Pro Large Industries" = "INDUSTRYLARGE",
      "Anti Large Industries " = "INDUSTRYSMALL",
      "Pro Globaleconomy" = "ECONOMYGLOBAL",
      "Pro Localeconomy" = "ECONOMYLOCAL",
      "Environment over Development" = "ENVOVERDEV",
      "Development over Environment" = "DEVOVERENV",
      "Pro Private ownership " = "OWNERPVT",
      "Anti Regulations" = "OWNERNOREG",
      "Pro Public ownership" = "OWNERPUB",
      "Pro Regulations" = "OWNERREG",
      "Displacement risk(coal)" = "DISPLACECOAL",
      "Pollution risk(coal) " = "POLLUTECOAL",
      "Health risk(coal)" = "HEALTHCOAL",
      "Job opportunities(coal)" = "JOBSCOAL",
      "Spoils Natural Beauty(coal)" = "BEAUTYCOAL",
      "Community pride(coal)" = "PRIDECOAL",
      "National pride(coal)" = "NPRIDECOAL",
      "National development(coal)" = "DEVCOAL",
      "Local prosperity(coal)" = "PROSPERCOAL",
      "Reliance on government(coal)" = "RELYCOAL"
    )


cecopolall2.fa <- fa(cecopolall, nfactors = 2, rotate = "varimax")

print.psych(cecopolall2.fa, cut = 0.5, sort = TRUE)

```



```{r, echo=FALSE}

library(flextable)

set_flextable_defaults(docx.landscape = TRUE)

flex <- function(data, title=NULL) {
  # this grabs the data and converts it to a flextbale
  flextable(data) %>%
  # this makes the table fill the page width
  set_table_properties(layout = "autofit", width = 1) %>%
  # font size
  fontsize(size=10, part="all") %>%
    #this adds a ttitlecreates an automatic table number
      set_caption(title, 
                  autonum = officer::run_autonum(seq_id = "tab", 
                                                 pre_label = "Table ", 
                                                 post_label = "\n", 
                                                 bkm = "anytable")) #%>%
  # font type
  #font(fontname="Times New Roman", part="all")
}

crename_map <- c(
  "Limits on Wealth" = "A limit should be put to how much wealth a person can amass",
  "Anti Mechanisation of work" = "Rapid mechanization of work is taking away jobs from workers in this country",
  "Pro Decentralisation" = "Local politicians shouldn't have to ask permission from the central government to implement policies",
  "Pro Centralisation" = "Laws and policies would be implemented more smoothly if more power lay with the central government",
  "Pro Large Industries" = "Large scale industries are required for the development of the country that will benefit everyone",
  "Anti Large Industries" = "Large corporations are destroying the local industries in India and benefiting only a handful of people",
  "Pro Globaleconomy" = "Foreign companies have led to a range of benefits for the Indian people and society",
  "Pro Localeconomy" = "India would be better off if foreign companies didn't come to here",
  "Environment over Development" = "Polluting industries that spoil the environment should be shut down even if it costs people their jobs",
  "Development over Environment" = "Economic growth and creating jobs should be prioritized over environmental protection",
  "Pro Private ownership" = "All businesses and industries should be owned privately",
  "Anti Regulations" = "There is too much red-tape and the government should not interfere with businesses and industries",
  "Pro Public ownership" = "The government should own most large businesses and industries",
  "Pro Regulations" = "Regardless of ownership, the government should pass strong regulations and implement them",
  "Displacement risk(coal)" = "Coal powered plants are leading to displacement of people from their land",
  "Spoils Natural Beauty(coal)" = "Coal powered plants spoil the natural beauty of the landscape",
  "Pollution risk(coal)" = "Coal powered plants increase pollution of air/water/land",
  "Health risk(coal)" = "Coal powered plants pose a great risk to the health of people living around it",
  "Job opportunities(coal)" = "Coal powered plants will bring jobs to the local community",
  "Community pride(coal)" = "I would be proud if my community used coal powered plants",
  "National pride(coal)" = "Coal powered plants are a mark of pride for our nation",
  "National development(coal)" = "Coal powered plants push forward the country's development",
  "Local prosperity(coal)" = "Coal powered plants bring economic prosperity to the surrounding regions",
  "Reliance on government(coal)" = "I don't like the idea that I have to rely on the government for electricity from coal powered plants"
)


fa_table <- function(x, cut) {
  #get sorted loadings
  loadings <- fa.sort(x)$loadings %>% round(3)
  #suppress loadings
  loadings[loadings > -cut & loadings < cut] <- ""
  #get additional info  
  add_info <- cbind(x$communalities, 
                    x$uniquenesses,
                    x$complexity) %>%
    # make it a data frame
    as.data.frame() %>%
    # column names
    rename("Communality" = V1,
           "Uniqueness" = V2,
           "Complexity" = V3) %>%
    #get the item names from the vector
    rownames_to_column("item")
  
  #build table
  loadings %>%
    unclass() %>%
    as.data.frame() %>%
    rownames_to_column("item") %>%
    left_join(add_info) %>%
    mutate(
      item = if_else(item %in% names(crename_map), crename_map[item], item),
      code = names(crename_map)[match(item, crename_map)], # extracting short form
      across(where(is.numeric), round, 3)
    ) %>%
    dplyr::select(code, everything()) # reorder columns to bring code to the front
}

fa_table(cecopolall2.fa, .4) %>%
  #rename(Pdevelop = MR1, Ndevelop = MR2, Items= item) %>%
  flex("2 factor solution") %>%
  autofit()


```




```{r, echo = FALSE}
cecopolall2.fa[["Vaccounted"]] %>%
  as.data.frame() %>%
  rownames_to_column("Property") %>%
  #rename(Pdevelop = MR1, Ndevelop = MR2) %>%
    mutate(across(where(is.numeric), round, 3)) %>%
    flex("Coal: Eigenvalues and Variance Explained for 2 Factor Solution")
```

## CFA on coal 

```{r, echo = FALSE}
# kahan scores for coal and CFA on ecopol vars  
cfascales <- codedmodule2 %>%
  dplyr::select(starts_with(c("K_","Risky_Coal","WEALTHLIM","MECHANISATION","DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","INDUSTRYSMALL","ECONOMYGLOBAL","ECONOMYLOCAL", "ENVOVERDEV","DEVOVERENV","OWNERPVT","OWNERNOREG","OWNERPUB", "OWNERREG","DISPLACECOAL",  "POLLUTECOAL", "HEALTHCOAL", "JOBSCOAL", "BEAUTYCOAL", "PRIDECOAL", "NPRIDECOAL", "DEVCOAL", "PROSPERCOAL", "RELYCOAL", "Uppercaste", "Male", "Hindu", "Urban", "State","age"))) %>%
  na.omit()

cKahan_fas <- '
  KahanS =~ K_SHARM + K_SLIMCHOI + K_SPROTECT 
  KahanH =~ K_HEQUAL+ K_ERADEQ1 + K_EWEALTH + K_ERADEQ2
'

# Run CFA
cKahan_cfa <- cfa(cKahan_fas, data = cfascales, std.lv = TRUE)


cKahan_scores <- predict(cKahan_cfa, newdata = cfascales)

cKahan_Kscores <- cbind(cfascales, cKahan_scores)



cecopol_fas <- '
  Pdevelop =~ HEALTHCOAL + BEAUTYCOAL + DISPLACECOAL + POLLUTECOAL + INDUSTRYSMALL + OWNERREG + MECHANISATION
  Ndevelop =~ DEVCOAL + PROSPERCOAL + JOBSCOAL + PRIDECOAL + NPRIDECOAL 
'

cecopol_cfa <- cfa(cecopol_fas, data = cfascales, std.lv = TRUE)
#summary(cecopol_cfa, fit.measure= TRUE, standardized = TRUE)



# 3) lm with kahan 
cm1_kahan <- lm(Risky_Coal ~ Uppercaste + Male + Hindu + Urban + age + State + KahanS + KahanH , data = cKahan_Kscores)
# Print model summary
#summary(cm1_kahan)
#plot(cm1_kahan)

# Cronbach's alpha test on Pdevelop and Ndevelop for Solar energy 

coalpdevelop <- cfascales %>%
  dplyr::select(HEALTHCOAL, BEAUTYCOAL, DISPLACECOAL, POLLUTECOAL, INDUSTRYSMALL, OWNERREG, MECHANISATION)%>%
  na.omit()

coalpdevelop.alpha <- psych::alpha(coalpdevelop, check.keys = TRUE)

# alpha is strong at 0.78!

coalndevelop <- cfascales %>%
  dplyr::select(DEVCOAL, PRIDECOAL, NPRIDECOAL, PROSPERCOAL, JOBSCOAL,)%>%
  na.omit()

coalndevelop.alpha <- psych::alpha(coalndevelop, check.keys = TRUE)

#alpha


```


## Coal linear regression - 2 FA solution


```{r, echo=FALSE}

# Linear Model with 2 factor solution for  Risk perception from coal Energy 

#binding factor scores to the dataset
cecopolall_scores <- predict(cecopol_cfa, newdata = cfascales)

cfascale_scores <- cbind(cKahan_Kscores, cecopolall_scores)# %>%
  #rename(Pdevelop = MR1)%>%
  #rename(Ndevelop = MR2)

coal2fa <- lm(Risky_Coal ~ age + Uppercaste + Male + Hindu + Urban + State + KahanS + KahanH + Pdevelop + Ndevelop, data = cfascale_scores)

#m2_allscales <- lm(Risky_Nuclear ~ age + Uppercaste + Male + Hindu + Urban +State+ KahanS + KahanH + NPRIDENUCLEAR + PRIDENUCLEAR + DEVNUCLEAR + PROSPERNUCLEAR, data = fascale_scores)
# Print model summary
summary(coal2fa)

```

\newpage

# Here make a table with the three linear regression models to compare 2 fa solution










\newpage
# Alternative Solution :  FA on Two Separate scales 

## Scale 1: Factor analysis on Eco-political values of the perceiver scale
 4 factor solution 

```{r, echo = FALSE}

# below are only eco-pol values of the perceiver scale. 


ecopolonly <- codedmodule2 %>%
            filter(!is.na(WEALTHLIM) & !is.na(MECHANISATION) & !is.na(INDUSTRYSMALL)  & !is.na(ECONOMYGLOBAL)  & !is.na(ENVOVERDEV)  & !is.na(OWNERNOREG) & !is.na(OWNERPUB) & !is.na(OWNERREG) & !is.na(DECISIONDECEN) & !is.na(DECISIONCEN) & !is.na(INDUSTRYLARGE) & !is.na(ECONOMYLOCAL) & !is.na(DEVOVERENV) & !is.na(OWNERPVT))
        #dplyr::select("WEALTHLIM","MECHANISATION","INDUSTRYSMALL","ECONOMYGLOBAL", "ENVOVERDEV","OWNERNOREG","OWNERPUB", "OWNERREG", "DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","ECONOMYLOCAL", "DEVOVERENV","OWNERPVT") %>%
  #na.omit()

ecopolval <- codedmodule2 %>%
        dplyr::select("WEALTHLIM","MECHANISATION","INDUSTRYSMALL","ECONOMYGLOBAL", "ENVOVERDEV","OWNERNOREG","OWNERPUB", "OWNERREG", "DECISIONDECEN","DECISIONCEN","INDUSTRYLARGE","ECONOMYLOCAL", "DEVOVERENV","OWNERPVT")%>%
  na.omit() %>%
    rename(
      "Limits on Wealth" = "WEALTHLIM",
      "Anti Mechanisation of work" = "MECHANISATION",
      "Pro Decentralisation" = "DECISIONDECEN",
      "Pro Centralisation" = "DECISIONCEN",
      "Pro Large Industries" = "INDUSTRYLARGE",
      "Anti Large Industries" = "INDUSTRYSMALL",
      "Pro Globaleconomy" = "ECONOMYGLOBAL",
      "Pro Localeconomy" = "ECONOMYLOCAL",
      "Environment over Development" = "ENVOVERDEV",
      "Development over Environment" = "DEVOVERENV",
      "Pro Private ownership" = "OWNERPVT",
      "Anti Regulations" = "OWNERNOREG",
      "Pro Public ownership" = "OWNERPUB",
      "Pro Regulations" = "OWNERREG"
    )

#alpha(ecopolval, check.keys = TRUE) # 0.71

#ncol(ecopolval)  number of cols is 14 

#ecopolval_cor <- cor(ecopolval)
#PCA14 <- principal(ecopolval, nfactors = 14, rotate = "none") # no rotation to start with. 

#print(PCA14)

#PCA14$loadings

#fa.parallel(ecopolval_cor)

ecopolval2.fa <- fa(ecopolval, nfactors = 2, rotate = "varimax")
print.psych(ecopolval2.fa, cut = 0.4, sort = TRUE)


ecopolval4.fa <- fa(ecopolval, nfactors = 4, rotate = "varimax")
print.psych(ecopolval4.fa, cut = 0.4, sort = TRUE)

# 4 fA extraction

ecopolval_scores <- psych::factor.scores(ecopolval, ecopolval4.fa)

# The factor scores will be stored in the scores element of the returned list
ecopolonlyscores <- ecopolval_scores$scores

#binding factor scores to the dataset

ecopolonlywscores <- cbind(ecopolonly, ecopolonlyscores) %>%
  rename(regulateindustry = MR1)%>%
  rename(localisation = MR3)%>%
   rename(freemarket = MR4)%>%
  rename(pvtdevelopment = MR2)

# 2 factor 

ecopolval2_scores <- psych::factor.scores(ecopolval, ecopolval2.fa)

# The factor scores will be stored in the scores element of the returned list
ecopolonlyscores2 <- ecopolval2_scores$scores

#binding factor scores to the dataset

ecopolonlywscores2 <- cbind(ecopolonly, ecopolonlyscores2)


#cor(ecopolval)

# questions for Terre , 2) 4 factors/3 factors/2 factors - variation explained how should i deal with that. 
# four factor analysis - MR1 -regulated industrialization MR3 - localisation MR4 - free market MR2- private development  

# Reverse coded DECISIONCEN,INDUSTRYLARGE,ECONOMYGLOBAL,OWNERPVT,OWNERNOREG, DEVOVERENV

```

```{r, echo = FALSE}
# linear regression with 4 factor solution 

#Risky_Nuclear

nuclear4fa <- lm(Risky_Nuclear ~ Uppercaste + Male + Hindu + Urban + age + State + regulateindustry +  localisation + freemarket + pvtdevelopment , data = ecopolonlywscores)
# Print model summary
summary(nuclear4fa)


#Ben_Nuclear
bennuclear4fa <- lm(Ben_Nuclear ~ Uppercaste + Male + Hindu + Urban + age + State + regulateindustry +  localisation + freemarket + pvtdevelopment , data = ecopolonlywscores)
# Print model summary
summary(bennuclear4fa)

#Risky_Solar
solar4fa <- lm(Risky_Solar ~ Uppercaste + Male + Hindu + Urban + age + State + regulateindustry +  localisation + freemarket + pvtdevelopment , data = ecopolonlywscores)
# Print model summary
summary(solar4fa)


#Ben_Solar

bensolar4fa <- lm(Ben_Solar ~ Uppercaste + Male + Hindu + Urban + age + State + regulateindustry +  localisation + freemarket + pvtdevelopment , data = ecopolonlywscores)
# Print model summary
summary(bensolar4fa)

#Risky_Coal

coal4fa <- lm(Risky_Coal ~ Uppercaste + Male + Hindu + Urban + age + State + regulateindustry +  localisation + freemarket + pvtdevelopment , data = ecopolonlywscores)
# Print model summary
summary(coal4fa)

#Ben_Coal 

bencoal4fa <- lm(Ben_Coal ~ Uppercaste + Male + Hindu + Urban + age + State + regulateindustry +  localisation + freemarket + pvtdevelopment , data = ecopolonlywscores)
# Print model summary
summary(bencoal4fa)

```

```{r, echo = FALSE}
# linear regression with 2 factor solution 

#Risky_Nuclear

nuclear2fa <- lm(Risky_Nuclear ~ Uppercaste + Male + Hindu + Urban + age + State + MR1 +MR2 , data = ecopolonlywscores2)
# Print model summary
summary(nuclear2fa)


#Ben_Nuclear
bennuclear2fa <- lm(Ben_Nuclear ~ Uppercaste + Male + Hindu + Urban + age + State + MR1 +MR2 , data = ecopolonlywscores2)
# Print model summary
summary(bennuclear2fa)

#Risky_Solar
solar2fa <- lm(Risky_Solar ~ Uppercaste + Male + Hindu + Urban + age + State + MR1 +MR2 , data = ecopolonlywscores2)
# Print model summary
summary(solar2fa)


#Ben_Solar

bensolar2fa <- lm(Ben_Solar ~ Uppercaste + Male + Hindu + Urban + age + State + MR1 +MR2 , data = ecopolonlywscores2)
# Print model summary
summary(bensolar2fa)

#Risky_Coal

coal2fa <- lm(Risky_Coal ~ Uppercaste + Male + Hindu + Urban + age + State + MR1 +MR2 , data = ecopolonlywscores2)
# Print model summary
summary(coal2fa)

#Ben_Coal 

bencoal2fa <- lm(Ben_Coal ~ Uppercaste + Male + Hindu + Urban + age + State + MR1 +MR2 , data = ecopolonlywscores2)
# Print model summary
summary(bencoal2fa)

```

## 4 factor solution - pretty table


```{r, echo=FALSE}

library(flextable)

set_flextable_defaults(docx.landscape = TRUE)

flex <- function(data, title=NULL) {
  # this grabs the data and converts it to a flextbale
  flextable(data) %>%
  # this makes the table fill the page width
  set_table_properties(layout = "autofit", width = 1) %>%
  # font size
  fontsize(size=10, part="all") %>%
    #this adds a ttitlecreates an automatic table number
      set_caption(title, 
                  autonum = officer::run_autonum(seq_id = "tab", 
                                                 pre_label = "Table ", 
                                                 post_label = "\n", 
                                                 bkm = "anytable")) #%>%
  # font type
  #font(fontname="Times New Roman", part="all")
}

rename_map <- c(
  "Limits on Wealth" = "A limit should be put to how much wealth a person can amass",
  "Anti Mechanisation of work" = "Rapid mechanization of work is taking away jobs from workers in this country",
  "Pro Decentralisation" = "Local politicians shouldn't have to ask permission from the central government to implement policies",
  "Pro Centralisation" = "Laws and policies would be implemented more smoothly if more power lay with the central government",
  "Pro Large Industries" = "Large scale industries are required for the development of the country that will benefit everyone",
  "Anti Large Industries" = "Large corporations are destroying the local industries in India and benefiting only a handful of people",
  "Pro Globaleconomy" = "Foreign companies have led to a range of benefits for the Indian people and society",
  "Pro Localeconomy" = "India would be better off if foreign companies didn't come to here",
  "Environment over Development" = "Polluting industries that spoil the environment should be shut down even if it costs people their jobs",
  "Development over Environment" = "Economic growth and creating jobs should be prioritized over environmental protection",
  "Pro Private ownership" = "All businesses and industries should be owned privately",
  "Anti Regulations" = "There is too much red-tape and the government should not interfere with businesses and industries",
  "Pro Public ownership" = "The government should own most large businesses and industries",
  "Pro Regulations" = " Regardless of ownership, the government should pass strong regulations and implement them"
)

fa_table <- function(x, cut) {
  #get sorted loadings
  loadings <- fa.sort(x)$loadings %>% round(3)
  #suppress loadings
  loadings[loadings > -cut & loadings < cut] <- ""
  #get additional info  
  add_info <- cbind(x$communalities, 
                    x$uniquenesses,
                    x$complexity) %>%
    # make it a data frame
    as.data.frame() %>%
    # column names
    rename("Communality" = V1,
           "Uniqueness" = V2,
           "Complexity" = V3) %>%
    #get the item names from the vector
    rownames_to_column("item")
  
  #build table
  loadings %>%
    unclass() %>%
    as.data.frame() %>%
    rownames_to_column("item") %>%
    left_join(add_info) %>%
    mutate(
      item = if_else(item %in% names(rename_map), rename_map[item], item),
      code = names(rename_map)[match(item, rename_map)], # extracting short form
      across(where(is.numeric), round, 3)
    ) %>%
    select(code, everything()) # reorder columns to bring code to the front
}

fa_table(ecopolval4.fa, .4) %>%
  #rename(Pdevelop = MR1, Ndevelop = MR2, Items= item) %>%
  flex("4 factor solution same for all technologies") %>%
  autofit()


```



```{r, echo=FALSE}

library(flextable)


flex <- function(data, title=NULL) {
  # this grabs the data and converts it to a flextbale
  flextable(data) %>%
  # this makes the table fill the page width
  set_table_properties(layout = "autofit", width = 1) %>%
  # font size
  fontsize(size=10, part="all") %>%
    #this adds a ttitlecreates an automatic table number
      set_caption(title, 
                  autonum = officer::run_autonum(seq_id = "tab", 
                                                 pre_label = "Table ", 
                                                 post_label = "\n", 
                                                 bkm = "anytable")) #%>%
  # font type
  #font(fontname="Times New Roman", part="all")
}



ecopolval4.fa[["Vaccounted"]] %>%
  as.data.frame() %>%
  rownames_to_column("Property") %>%
  #rename(Pdevelop = MR1, Ndevelop = MR2) %>%
    mutate(across(where(is.numeric), round, 3)) %>%
    flex("Eigenvalues and Variance Explained for Rotated Factor Solution")



```

```{r, echo = FALSE}
 # Adjust as per the number of factors

#fa.diagram(ecopolval4.fa, marg=c(.5,5,1,.5),size =1, adj = 0.25, e.size=.05,rsize=.35, main = "Four Factor Solution")

```



\newpage
## Option 1: Factor analysis on Scale 2 - Characteristics of the Technology
 2 factor solution 


```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

#alpha test on Eco-pol characteristics of the technology



Nuclear <- codedmodule2 %>%
  filter(complete.cases(dplyr::select(., DISPLACENUCLEAR:RELYNUCLEAR)))

Nuclear2 <- codedmodule2  %>%
  dplyr::select("DISPLACENUCLEAR":"RELYNUCLEAR")%>%
    rename(
   "Displacement risk(nuclear)" = "DISPLACENUCLEAR",
  "Pollution risk(nuclear)" = "POLLUTENUCLEAR",
  "Health risk(nuclear)" = "HEALTHNUCLEAR",
  "Job opportunities(nuclear)" = "JOBSNUCLEAR",
  "Spoils Natural Beauty(nuclear)" = "BEAUTYNUCLEAR",
  "Community pride(nuclear)" = "PRIDENUCLEAR",
  "National pride(nuclear)" = "NPRIDENUCLEAR",
  "National development(nuclear)" = "DEVNUCLEAR",
  "Local prosperity(nuclear)" = "PROSPERNUCLEAR",
  "Reliance on government(nuclear)" = "RELYNUCLEAR"
    )%>%
  na.omit()


Nuclear.fa <- fa(Nuclear2, nfactors = 2, rotate = "varimax")

print.psych(Nuclear.fa, cut = 0.40, sort = TRUE)

#fa.diagram(Nuclear.fa)


```

```{r, echo=FALSE}


# 2 factor 

Nuclear_scores <- psych::factor.scores(Nuclear2, Nuclear.fa)

# The factor scores will be stored in the scores element of the returned list
Nuclear_scores2 <- Nuclear_scores$scores

#binding factor scores to the dataset

Nuclearwscores2 <- cbind(Nuclear, Nuclear_scores2)%>%
    rename(negative = MR1)%>%
  rename(positive = MR2)


nuclearfa <- lm(Risky_Nuclear ~ Uppercaste + Male + Hindu + Urban + age + State +  negative + positive , data = Nuclearwscores2)
# Print model summary
summary(nuclearfa)

bennuclearfa <- lm(Ben_Nuclear ~ Uppercaste + Male + Hindu + Urban + age + State +  negative + positive , data = Nuclearwscores2)
# Print model summary
summary(bennuclearfa)

```



```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

#alpha test on Eco-pol characteristics of the technology



Solar <- codedmodule2 %>%
  filter(complete.cases(dplyr::select(., DISPLACESOLAR:RELYSOLAR)))

Solar2 <- codedmodule2  %>%
  dplyr::select("DISPLACESOLAR":"RELYSOLAR")%>%
    rename(
   "Displacement risk(Solar)" = "DISPLACESOLAR",
  "Pollution risk(Solar)" = "POLLUTESOLAR",
  "Health risk(Solar)" = "HEALTHSOLAR",
  "Job opportunities(Solar)" = "JOBSSOLAR",
  "Spoils Natural Beauty(Solar)" = "BEAUTYSOLAR",
  "Community pride(Solar)" = "PRIDESOLAR",
  "National pride(Solar)" = "NPRIDESOLAR",
  "National development(Solar)" = "DEVSOLAR",
  "Local prosperity(Solar)" = "PROSPERSOLAR",
  "Reliance on government(Solar)" = "RELYSOLAR"
    )%>%
  na.omit()


Solar.fa <- fa(Solar2, nfactors = 2, rotate = "varimax")

print.psych(Solar.fa, cut = 0.40, sort = TRUE)

#fa.diagram(Solar.fa)


```


```{r, echo=FALSE}


# 2 factor 

Solar_scores <- psych::factor.scores(Solar2, Solar.fa)

# The factor scores will be stored in the scores element of the returned list
Solar_scores2 <- Solar_scores$scores

#binding factor scores to the dataset

Solarwscores2 <- cbind(Solar, Solar_scores2)%>%
    rename(positive = MR1)%>%
  rename(negative = MR2)



Solarfa <- lm(Risky_Solar ~  Uppercaste + Male + Hindu + Urban + age + State + positive + negative, data = Solarwscores2)
# Print model summary
summary(Solarfa)


benSolarfa <- lm(Ben_Solar ~  Uppercaste + Male + Hindu + Urban + age + State + positive + negative, data = Solarwscores2)
# Print model summary
summary(benSolarfa)


```


```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

#alpha test on Eco-pol characteristics of the technology



Coal <- codedmodule2 %>%
  filter(complete.cases(dplyr::select(., DISPLACECOAL:RELYCOAL)))

Coal2 <- codedmodule2 %>%
  dplyr::select("DISPLACECOAL":"RELYCOAL")%>%
    rename(
   "Displacement risk(Coal)" = "DISPLACECOAL",
  "Pollution risk(Coal)" = "POLLUTECOAL",
  "Health risk(Coal)" = "HEALTHCOAL",
  "Job opportunities(Coal)" = "JOBSCOAL",
  "Spoils Natural Beauty(Coal)" = "BEAUTYCOAL",
  "Community pride(Coal)" = "PRIDECOAL",
  "National pride(Coal)" = "NPRIDECOAL",
  "National development(Coal)" = "DEVCOAL",
  "Local prosperity(Coal)" = "PROSPERCOAL",
  "Reliance on government(Coal)" = "RELYCOAL"
    )%>%
  na.omit()


Coal.fa <- fa(Coal2, nfactors = 2, rotate = "varimax")

print.psych(Coal.fa, cut = 0.40, sort = TRUE)

#fa.diagram(Coal.fa)


```



```{r, echo=FALSE}


# 2 factor 

Coal_scores <- psych::factor.scores(Coal2, Coal.fa)

# The factor scores will be stored in the scores element of the returned list
Coal_scores2 <- Coal_scores$scores

#binding factor scores to the dataset

Coalwscores2 <- cbind(Coal, Coal_scores2) %>%
  rename(negative = MR1)%>%
  rename(positive = MR2)


Coalfa <- lm(Risky_Coal ~  Uppercaste + Male + Hindu + Urban + age + State + negative + positive , data = Coalwscores2)
# Print model summary
summary(Coalfa)

benCoalfa <- lm(Ben_Coal ~  Uppercaste + Male + Hindu + Urban + age + State + positive + negative, data = Coalwscores2)
# Print model summary
summary(benCoalfa)
```

```{r, echo=FALSE}

library(flextable)

set_flextable_defaults(docx.landscape = TRUE)

flex <- function(data, title=NULL) {
  # this grabs the data and converts it to a flextbale
  flextable(data) %>%
  # this makes the table fill the page width
  set_table_properties(layout = "autofit", width = 1) %>%
  # font size
  fontsize(size=10, part="all") %>%
    #this adds a ttitlecreates an automatic table number
      set_caption(title, 
                  autonum = officer::run_autonum(seq_id = "tab", 
                                                 pre_label = "Table ", 
                                                 post_label = "\n", 
                                                 bkm = "anytable")) #%>%
  # font type
  #font(fontname="Times New Roman", part="all")
}

rename_map <- c(
  "Displacement risk(nuclear)" = "Nuclear energy is leading to displacement of people from their land",
  "Spoils Natural Beauty(nuclear)" = "Nuclear energy spoils the natural beauty of the landscape",
  "Pollution risk(nuclear)" = "Nuclear energy increases pollution of air/water/land",
  "Health risk(nuclear)" = "Nuclear energy poses a great risk to the health of people living around it",
  "Job opportunities(nuclear)" = "Nuclear energy will bring jobs to the local community",
  "Community pride(nuclear)" = "I would be proud if my community used nuclear energy",
  "National pride(nuclear)" = "Nuclear energy is a mark of pride for our nation",
  "National development(nuclear)" = "Nuclear energy pushes forward the country's development",
  "Local prosperity(nuclear)" = "Nuclear energy brings economic prosperity to the surrounding regions",
  "Reliance on government(nuclear)" = "I don't like the idea that I have to rely on the government for electricity from nuclear energy"
)


fa_table <- function(x, cut) {
  #get sorted loadings
  loadings <- fa.sort(x)$loadings %>% round(3)
  #suppress loadings
  loadings[loadings > -cut & loadings < cut] <- ""
  #get additional info  
  add_info <- cbind(x$communalities, 
                    x$uniquenesses,
                    x$complexity) %>%
    # make it a data frame
    as.data.frame() %>%
    # column names
    rename("Communality" = V1,
           "Uniqueness" = V2,
           "Complexity" = V3) %>%
    #get the item names from the vector
    rownames_to_column("item")
  
  #build table
  loadings %>%
    unclass() %>%
    as.data.frame() %>%
    rownames_to_column("item") %>%
    left_join(add_info) %>%
    mutate(
      item = if_else(item %in% names(rename_map), rename_map[item], item),
      code = names(rename_map)[match(item, rename_map)], # extracting short form
      across(where(is.numeric), round, 3)
    ) %>%
    select(code, everything()) # reorder columns to bring code to the front
}

fa_table(Nuclear.fa, .4) %>%
  rename("Negative Characteristics" = MR1, "Positive Characteristics" = MR2, Items= item, Code = code) %>%
  flex("Nuclear Energy: 2 factor solution") %>%
  autofit()


```

```{r, echo=FALSE}

library(flextable)


flex <- function(data, title=NULL) {
  # this grabs the data and converts it to a flextbale
  flextable(data) %>%
  # this makes the table fill the page width
  set_table_properties(layout = "autofit", width = 1) %>%
  # font size
  fontsize(size=10, part="all") %>%
    #this adds a ttitlecreates an automatic table number
      set_caption(title, 
                  autonum = officer::run_autonum(seq_id = "tab", 
                                                 pre_label = "Table ", 
                                                 post_label = "\n", 
                                                 bkm = "anytable")) #%>%
  # font type
  #font(fontname="Times New Roman", part="all")
}



Nuclear.fa[["Vaccounted"]] %>%
  as.data.frame() %>%
  rownames_to_column("Property") %>%
  rename("Negative Characteristics" = MR1, "Positive Characteristics" = MR2) %>%
    mutate(across(where(is.numeric), round, 3)) %>%
    flex("Eigenvalues and Variance Explained for 2 Factor Solution")



```

\newpage 




