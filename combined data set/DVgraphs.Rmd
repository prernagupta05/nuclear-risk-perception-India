---
title: "Dependent Variable Graphs"
output:
  pdf_document:
    toc: yes
    number_sections: yes
    toc_depth: 2
    fig_width: 9
    fig_height: 6
    fig_caption: yes
  html_document:
    fig_width: 9
    fig_height: 6
    fig_caption: yes
    keep_md: yes
    theme: paper
    df_print: paged
---

```{r load packages, warning = FALSE, message = FALSE, echo=FALSE}
  knitr::opts_chunk$set(warning = FALSE, message = FALSE)

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(hablar))
suppressPackageStartupMessages(library(tsibble))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(DT))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(psych)) # psychometrics

```



```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
moduletwo <- read_excel(here::here("thesis_surveydata/political_factors_complete.xlsx"))

module2 <- data.frame(moduletwo)
module2[module2 == "Rather not say/ Don't know"] <- "Rather not say/Don't know"

# loaded data set for module 2 eco -pol variables and removes the rows with question number and question text
```



```{r, eval =TRUE, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
#This chunk contains the coding schemes of various scales used in survey one: eco-political factors, kahan scale and acceptance scale
codedmodule2 <- module2 %>%
  
#remove row 1
  filter(!row_number() %in% c(1,2)) %>% 
  
# replace risky likert scale with numbers
  mutate_at(vars(starts_with("Risky")), funs(case_when(. =="Not at all risky" ~ 1, 
                                                       . =="Slightly risky" ~ 2, 
                                                       . =="Moderately risky" ~ 3, 
                                                       . =="Very risky" ~ 4, 
                                                       . =="Extremely risky" ~ 5))) %>%

# replace beneficial likert scale with numbers  
  mutate_at(vars(starts_with("Ben")), funs(case_when(. =="Not at all beneficial" ~ 1,
                                                     . =="Slightly beneficial" ~ 2,
                                                     . =="Moderately beneficial" ~ 3,
                                                     . =="Very beneficial" ~ 4,
                                                     . =="Extremely beneficial" ~ 5 ))) %>%

# replace nuclear acceptance likert scale with numbers
  mutate_at(vars(N_accept,N_reluctantlyaccept,N_reject), funs(case_when(. == "Strongly disagree" ~ 1, 
                                                                        . == "Somewhat disagree" ~ 2,
                                                                        . == "Neither agree nor disagree" ~3,
                                                                        . == "Somewhat agree" ~ 4,
                                                                        . == "Strongly agree" ~ 5))) %>%
  
# code likert scale for variables for Kahan scale into numbers
  mutate_at(vars(starts_with (c("K_I","K_H","DISPLACE", "POLLUTE", "HEALTH", "JOBS", "BEAUTY", "PRIDE", "NPRIDE", "DEV", "PROSPER", "RELY"))), funs(case_when(. == "Strongly disagree" ~ 1, 
               . == "Somewhat disagree" ~ 2,
               . == "Neither agree nor disagree" ~3,
               . == "Somewhat agree" ~ 4,
               . == "Strongly agree" ~ 5))) %>%
  
# reverse code for likert scale for variables for Kahan scale into numbers
  mutate_at(vars(starts_with (c("K_S","K_E"))), funs(case_when(. == "Strongly disagree" ~ 5, 
                                                               . == "Somewhat disagree" ~ 4,
                                                               . == "Neither agree nor disagree" ~3,
                                                               . == "Somewhat agree" ~ 2,
                                                               . == "Strongly agree" ~ 1))) %>%

# code eco-pol scale variables into numbers
  mutate_at(vars(SYSTEMDEMO,SYSTEMRELIGION,SYSTEMTECHNO,SYSTEMTOTAL,WEALTHLIM,MECHANISATION,DECISIONDECEN,INDUSTRYLARGE,ECONOMYGLOBAL,OWNERPVT,OWNERNOREG), funs(case_when(. == "Strongly disagree" ~ 1, 
                        . == "Somewhat disagree" ~ 2,
                        . == "Neither agree nor disagree" ~3,
                        . == "Somewhat agree" ~ 4,
                        . == "Strongly agree" ~ 5))) %>%

# reverse code eco-pol scale variables into numbers 
 mutate_at(vars(DECISIONCEN, INDUSTRYSMALL, ECONOMYLOCAL, ENVOVERDEV,OWNERPUB, OWNERREG), funs(case_when(. == "Strongly disagree" ~ 5, 
                                                                                                         . == "Somewhat disagree" ~ 4,
                                                                                                         . == "Neither agree nor disagree" ~3,
                                                                                                         . == "Somewhat agree" ~ 2,
                                                                                                         . == "Strongly agree" ~ 1)))
```


```{r, eval=TRUE, echo=FALSE}

moduleone <- read_excel(here::here("thesis_surveydata/livelihood_insecurity_complete.xlsx"))

module1 <- data.frame(moduleone)

# loaded data set for module 2 eco -pol variables and removes the rows with question number and question text
```


```{r, eval =TRUE, echo=FALSE}
#This chunk contains the coding schemes of various scales used in survey one: eco-political factors, kahan scale and acceptance scale
codedmodule1 <- module1 %>%
  
#remove row 1
  filter(!row_number() %in% c(1,2)) %>% 
  
# replace risky likert scale with numbers
  mutate_at(vars(starts_with("Risky")), funs(case_when(. =="Not at all risky" ~ 1, 
                                                       . =="Slightly risky" ~ 2, 
                                                       . =="Moderately risky" ~ 3, 
                                                       . =="Very risky" ~ 4, 
                                                       . =="Extremely risky" ~ 5))) %>%

# replace beneficial likert scale with numbers  
  mutate_at(vars(starts_with("Ben")), funs(case_when(. =="Not at all beneficial" ~ 1,
                                                     . =="Slightly beneficial" ~ 2,
                                                     . =="Moderately beneficial" ~ 3,
                                                     . =="Very beneficial" ~ 4,
                                                     . =="Extremely beneficial" ~ 5 ))) %>%

# replace nuclear acceptance likert scale with numbers
  mutate_at(vars(N_accept,N_reluctantlyaccept,N_reject), funs(case_when(. == "Strongly disagree" ~ 1, 
                                                                        . == "Somewhat disagree" ~ 2,
                                                                        . == "Neither agree nor disagree" ~3,
                                                                        . == "Somewhat agree" ~ 4,
                                                                        . == "Strongly agree" ~ 5)))


#coded dependent variables for module 1 livelihood and income security survey
                                            
```


```{r, echo=FALSE}

suppressPackageStartupMessages(library(tidyselect))
# combine codedmodule1 and codedmodule2. Therefore these graphs are made on the combined data set from both the surveys. 

numcol2 <- codedmodule2 %>% add_column(Respondent = 1:1099, .before = "Language") 
numcol1 <- codedmodule1 %>% add_column(Respondent = 1099:2160, .before = "Language")

joineddf <-  full_join(numcol2, numcol1, by = c("Respondent", "Language", "Survey_Date", "State", "Risky_Hydro", "Risky_Solar", "Risky_Wind", "Risky_Nuclear", "Risky_Coal", "Risky_Gas", "Risky_Oil", "Risky_INDHydro", "Risky_INDSolar", "Risky_INDWind", "Risky_INDBiogas", "Risky_INDDiesel", "Risky_INDKerosene", "Risky_INDFirewoodetc", "Risky_INDLPG", "Ben_Hydro", "Ben_Solar", "Ben_Wind", "Ben_Nuclear", "Ben_Coal", "Ben_Gas", "Ben_Oil", "Ben_INDHydro", "Ben_INDSolar", "Ben_INDWind", "Ben_INDDiesel", "Ben_INDBiogas", "Ben_INDFirewoodetc", "Ben_INDLPG", "Ben_INDKerosene", "N_accept", "N_reluctantlyaccept", "N_reject", "age", "urban_rural", "gender", "caste", "religion", "religiontext")) 

```

\newpage

## Q1. Below is a list of various centrally managed sources of energy. How risky are each of these energy technologies according to you?  Please tell me whether you see each technology as: not at all risky(1), slightly risky(2), moderately risky(3), very risky(4), or extremely risky(5)

```{r, eval=TRUE, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# summary statistics for risks from different energy sources

risksumcentral <- joineddf %>%
  dplyr::select(!starts_with(c("RISKY_IND")))%>%
  summarize_at(vars(starts_with(c("RISKY"))), list(~mean(., na.rm = TRUE), ~median(., na.rm = TRUE), ~sd(.,na.rm = TRUE),~var(.,na.rm = TRUE), ~n())) %>%
  #add row index so later spreading indexed correctly
  add_rownames()%>%
  #melt to long format
  gather(technology, value, -rowname) %>%
  # separate risky from variable suffix
  separate(technology, c("Risky", "var"), extra = "merge", fill = "left") %>%
  #separate mean from variable prefix
  separate(var, c("technology", "summary")) %>%
  # spread summary values back to wide form
  spread(summary,value) %>%
  #clean up
  dplyr::select(-rowname, -Risky) %>%
  arrange(mean) %>%
  setNames(paste0('perceivedrisk.', names(.))) %>%
  dplyr::rename(technology= perceivedrisk.technology)

data.frame(risksumcentral)


```




```{r, echo=FALSE}

knitr::opts_chunk$set(warning = FALSE, message = FALSE)

risksumcentral %>%
  dplyr::select(technology, perceivedrisk.mean, perceivedrisk.sd) %>%
  mutate(technology = fct_reorder(technology, perceivedrisk.mean, .desc = FALSE))%>%
  ggplot(aes(x=technology, y= perceivedrisk.mean))+
  geom_bar(stat="identity", position=position_dodge(), fill = "firebrick2")+
  ylim(0,5)+
  geom_errorbar(aes(ymin=perceivedrisk.mean-perceivedrisk.sd, ymax=perceivedrisk.mean + perceivedrisk.sd), width=.2,
                 position=position_dodge(.9))+
  labs(y = "Mean Values of Perceived Risk", x = "Energy Technologies")+
  ggtitle("Perceived risk from centrally managed energy technologies")+
  coord_flip()


```

\newpage

## Q2. Following is a list of various individually or community-owned and managed sources of energy. How risky are each of these energy technologies according to you? Please tell me whether you see each technology as: not at all risky(1), slightly risky(2), moderately risky(3), very risky(4), or extremely risky(5). 

prefix IND stands for individually or community-owned and managed. 

```{r, eval=TRUE, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# summary statistics for risks from different energy sources

risksumIND <- joineddf %>%
  summarize_at(vars(starts_with(c("RISKY_IND"))), list(~mean(., na.rm = TRUE), ~median(., na.rm = TRUE), ~sd(.,na.rm = TRUE),~var(.,na.rm = TRUE), ~n())) %>%
  #add row index so later spreading indexed correctly
  add_rownames()%>%
  #melt to long format
  gather(technology, value, -rowname) %>%
  # separate risky from variable suffix
  separate(technology, c("Risky", "var"), extra = "merge", fill = "left") %>%
  #separate mean from variable prefix
  separate(var, c("technology", "summary")) %>%
  # spread summary values back to wide form
  spread(summary,value) %>%
  #clean up
  dplyr::select(-rowname, -Risky) %>%
  arrange(mean) %>%
  setNames(paste0('perceivedrisk.', names(.))) %>%
  dplyr::rename(technology= perceivedrisk.technology)

data.frame(risksumIND)


```

```{r, echo=FALSE}

knitr::opts_chunk$set(warning = FALSE, message = FALSE)

risksumIND %>%
  dplyr::select(technology, perceivedrisk.mean,perceivedrisk.sd) %>%
  mutate(technology = fct_reorder(technology, perceivedrisk.mean, .desc = FALSE))%>%
  ggplot(aes(x=technology, y= perceivedrisk.mean))+
  geom_bar(stat="identity", position=position_dodge(), fill = "firebrick2")+
  geom_errorbar(aes(ymin=perceivedrisk.mean-perceivedrisk.sd, ymax=perceivedrisk.mean + perceivedrisk.sd), width=.2,
                 position=position_dodge(.9))+
  ylim(0,5)+
  labs(y = "Mean Values of Perceived Risk", x = "Energy Technologies")+
  ggtitle("Perceived risk from individually or community owned energy technologies")+
  coord_flip()


```
\newpage

## Q3. Following is a list of centrally managed sources of energy. How beneficial are each of these according to you? Please tell me whether you see each technology as: not at all beneficial(1), slightly beneficial(2), moderately beneficial(3), very beneficial(4), or extremely beneficial(5)?

```{r, eval=TRUE, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# summary statistics for risks from different energy sources

bensumcentral <- joineddf %>%
  dplyr::select(!starts_with(c("Ben_IND")))%>%
  summarize_at(vars(starts_with(c("Ben"))), list(~mean(., na.rm = TRUE), ~median(., na.rm = TRUE), ~sd(.,na.rm = TRUE),~var(.,na.rm = TRUE), ~n())) %>%
  #add row index so later spreading indexed correctly
  add_rownames()%>%
  #melt to long format
  gather(technology, value, -rowname) %>%
  # separate risky from variable suffix
  separate(technology, c("Ben", "var"), extra = "merge", fill = "left") %>%
  #separate mean from variable prefix
  separate(var, c("technology", "summary")) %>%
  # spread summary values back to wide form
  spread(summary,value) %>%
  #clean up
  dplyr::select(-rowname, -Ben) %>%
  arrange(mean) %>%
  setNames(paste0('perceivedbenefit.', names(.))) %>%
  dplyr::rename(technology= perceivedbenefit.technology)

data.frame(bensumcentral)


```


```{r, echo=FALSE}

knitr::opts_chunk$set(warning = FALSE, message = FALSE)

bensumcentral %>%
  dplyr::select(technology, perceivedbenefit.mean,perceivedbenefit.sd) %>%
  mutate(technology = fct_reorder(technology, perceivedbenefit.mean, .desc = FALSE))%>%
  ggplot(aes(x=technology, y= perceivedbenefit.mean))+
  geom_bar(stat="identity", position=position_dodge(), fill = "palegreen3")+
   geom_errorbar(aes(ymin=perceivedbenefit.mean-perceivedbenefit.sd, ymax=perceivedbenefit.mean + perceivedbenefit.sd), width=.2,
                 position=position_dodge(.9))+
  ylim(0,5)+
  labs(y = "Mean Values of Perceived Benefit", x = "Energy Technologies")+
  ggtitle("Perceived benefit from centrally managed energy technologies")+
  coord_flip()


```

\newpage

## Q4. Following is a list of various individually or community owned and managed sources of energy. How beneficial are each of these according to you? Please tell me whether you see each technology as: not at all beneficial(1), slightly beneficial(2), moderately beneficial(3), very beneficial(4) or extremely beneficial(5) ?

prefix IND stands for individually or community-owned and managed. 

```{r, eval=TRUE, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

# summary statistics for risks from different energy sources

bensumIND <- joineddf %>%
  summarize_at(vars(starts_with(c("Ben_IND"))), list(~mean(., na.rm = TRUE), ~median(., na.rm = TRUE), ~sd(.,na.rm = TRUE),~var(.,na.rm = TRUE), ~n())) %>%
  #add row index so later spreading indexed correctly
  add_rownames()%>%
  #melt to long format
  gather(technology, value, -rowname) %>%
  # separate risky from variable suffix
  separate(technology, c("Ben", "var"), extra = "merge", fill = "left") %>%
  #separate mean from variable prefix
  separate(var, c("technology", "summary")) %>%
  # spread summary values back to wide form
  spread(summary,value) %>%
  #clean up
  dplyr::select(-rowname, -Ben) %>%
  arrange(mean) %>%
  setNames(paste0('perceivedbenefit.', names(.))) %>%
  dplyr::rename(technology= perceivedbenefit.technology)

data.frame(bensumIND)


```

```{r, echo=FALSE}

knitr::opts_chunk$set(warning = FALSE, message = FALSE)

bensumIND %>%
  dplyr::select(technology, perceivedbenefit.mean, perceivedbenefit.sd) %>%
  mutate(technology = fct_reorder(technology, perceivedbenefit.mean, .desc = FALSE))%>%
  ggplot(aes(x=technology, y= perceivedbenefit.mean))+
  geom_bar(stat="identity", position=position_dodge(), fill = "palegreen3")+
  geom_errorbar(aes(ymin=perceivedbenefit.mean-perceivedbenefit.sd, ymax=perceivedbenefit.mean + perceivedbenefit.sd), width=.2,
                 position=position_dodge(.9))+
  ylim(0,5)+
  labs(y = "Mean Values of Perceived Benefit", x = "Energy Technologies")+
  ggtitle("Perceived benefit from individually or community owned energy technologies")+
  coord_flip()


```

\newpage

```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)


center_barplot <- full_join( bensumcentral,risksumcentral, by = NULL, copy = FALSE, keep = FALSE) %>%
 dplyr::select(technology, perceivedbenefit.mean, perceivedrisk.mean, perceivedbenefit.sd, perceivedrisk.sd) %>%
  mutate(technology = fct_reorder(technology, perceivedbenefit.mean, .desc = FALSE))%>%
   gather(key = "level", value = "mean", perceivedbenefit.mean, perceivedrisk.mean)
   
  
center_barplot$level <- as.factor(center_barplot$level)  


 center_barplot%>% 
  ggplot(aes(x=technology, y= mean, fill =  (factor(level, levels = c("perceivedrisk.mean", "perceivedbenefit.mean")))))+
  geom_bar(stat="identity", position=position_dodge())+
   
#geom_errorbar(aes(ymin= mean - sd, ymax= mean + sd), width =.2, position=position_dodge(.9))+
  ylim(0,4)+
  scale_fill_manual("legend", values = c("perceivedbenefit.mean" = "palegreen3","perceivedrisk.mean" = "firebrick2"))+
  labs(y = "Mean Values", x = "Energy Technologies")+
  ggtitle("Perceived risk and benefit from centrally owned energy technologies")+
  coord_flip()

 


```

Prefix IND stands for individually or community-owned and managed. 


```{r, echo=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)


IND_barplot <- full_join(bensumIND,risksumIND, by = NULL, copy = FALSE, keep = FALSE) %>%
 dplyr::select(technology, perceivedbenefit.mean, perceivedrisk.mean) %>%
  mutate(technology = fct_reorder(technology, perceivedbenefit.mean, .desc = FALSE))%>%
  gather(key = "level", value = "mean", perceivedbenefit.mean, perceivedrisk.mean)
  
IND_barplot$level <- as.factor(IND_barplot$level)
    
IND_barplot%>%  ggplot(aes(x=technology, y= mean, fill = (factor(IND_barplot$level, levels = c("perceivedrisk.mean", "perceivedbenefit.mean")))))+
  geom_bar(stat="identity", position=position_dodge())+
  ylim(0,4)+
  scale_fill_manual("legend", values = c("perceivedbenefit.mean" = "palegreen3","perceivedrisk.mean" = "firebrick2"))+
  labs(y = "Mean Values", x = "Energy Technologies")+
  ggtitle("Perceived risk and benefit from individually owned energy technologies")+
  coord_flip()

```

```{r, echo=FALSE}

library(dplyr)
library(tidyr)

perceivedrisk <-joineddf %>% select(starts_with("Risky")) %>%
  gather(key = "technology", value = "perceived_risk") %>% 
  mutate(technology = gsub("Risky_", "", technology)) %>%
  na.omit()


perceivedrisk

```



```{r}
# checking assumptions for kruskal wallis test

duplicated(joineddf)
sum(duplicated(joineddf))

# there are no duplicate responses in our dataframe :). 

ggplot(perceivedrisk, aes(x = perceived_risk, y = technology)) + 
  geom_boxplot()
 
ggplot(perceivedrisk, aes(x = perceived_risk, y = technology)) + 
  geom_violin()
#the violin graph shows that the data is definitely not normally distributed 

levels(perceivedrisk$technology)


bartlett.test(perceived_risk ~ technology, data = perceivedrisk)

str(perceivedrisk)


```


```{r, echo=FALSE}
# create a list of technology levels
tech_levels <- unique(perceivedrisk$technology)

# perform Shapiro test for each technology
shapiro_results <- lapply(tech_levels, function(x) {
  shapiro.test(perceivedrisk$perceived_risk[perceivedrisk$technology == x])
})

#extract the W and p-value from the htest object 
shapiro_results_df <- data.frame(W = sapply(shapiro_results, function(x) x$statistic),
                                  p.value = sapply(shapiro_results, function(x) x$p.value), 
                                  technology = tech_levels)




```



```{r}
# load the stats package
library(stats)

perceivedrisk$technology <- factor(perceivedrisk$technology)

# perform the Kruskal-Wallis H-test, the technologies are treated as independent groups and the mean of perceived risk is of interest. 
kruskal_result <- kruskal.test(perceived_risk ~ technology, data = perceivedrisk)

# print the test statistic and p-value
print(kruskal_result) 

#library(emmeans)
#emm_results <- emmeans(kruskal_result, ~ technology)
#summary(emm_results, infer = c(T, T))

```



```{r}

library(dplyr)
ggplot(perceivedrisk %>%
  mutate(technology = reorder(technology, perceived_risk, FUN = median)), 
         aes(x = technology, y = perceived_risk)) +
  geom_boxplot(width = 0.5) +
  geom_hline(aes(yintercept = median(perceived_risk)), linetype = "dashed", color = "red") +
  coord_flip()




```



```{r}
library(dplyr)
perceivedrisk %>%
  group_by(technology) %>%
  summarise(
    count = n(),
    mean = mean(perceived_risk, na.rm = TRUE),
    sd = sd(perceived_risk, na.rm = TRUE),
    median = median(perceived_risk, na.rm = TRUE),
    IQR = IQR(perceived_risk, na.rm = TRUE)
  )

levels(perceivedrisk$technology)

```
```{r}

pairwise.wilcox.test(perceivedrisk$perceived_risk, perceivedrisk$technology, p.adjust.method = "BH")


```

```{r}

# visualising the pairwaise wilcox test results. the non significant pairs are grey 

library(broom)
result <- pairwise.wilcox.test(perceivedrisk$perceived_risk, perceivedrisk$technology, p.adjust.method = "BH")
tidy_result <- tidy(result)

library(ggplot2)
ggplot(tidy_result, aes(x = group1, y = group2, fill = p.value)) + 
  geom_tile(color = "white") + 
  scale_fill_gradient2(low = "red", high = "white", midpoint = 0.025, 
                       limits = c(0, 0.05), space = "Lab", 
                       name = "P-value") + 
  theme_classic() + 
  labs(x = "Technology 1", y = "Technology 2") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


```



```{r, echo=FALSE}
library(dplyr)
library(tidyr)

perceivedbenefit <-joineddf %>% select(starts_with("Ben")) %>%
  gather(key = "technology", value = "perceived_benefit") %>% 
  mutate(technology = gsub("Ben_", "", technology)) %>%
  na.omit()


perceivedbenefit

```

```{r}
# checking assumptions for kruskal wallis test

duplicated(joineddf)
sum(duplicated(joineddf))

# there are no duplicate responses in our dataframe :). 


#what was I doing here - check again ? assumptions for running it on perceived benefit 

ggplot(perceivedbenefit, aes(x = perceived_benefit, y = technology)) + 
  geom_boxplot()
 

levels(perceivedbenefit$technology)


bartlett.test(perceived_benefit ~ technology, data = perceivedbenefit)

str(perceivedbenefit)


```

```{r}
# load the stats package
library(stats)

perceivedbenefit$technology <- factor(perceivedbenefit$technology)

# perform the Kruskal-Wallis H-test, the technologies are treated as independent groups and the mean of perceived risk is of interest. 
kruskal_resultben <- kruskal.test(perceived_benefit ~ technology, data = perceivedbenefit)

# print the test statistic and p-value
print(kruskal_resultben) 


```

```{r}

library(dplyr)
ggplot(perceivedbenefit %>%
  mutate(technology = reorder(technology, perceived_benefit, FUN = median)), 
         aes(x = technology, y = perceived_benefit)) +
  geom_boxplot(width = 0.5) +
  geom_hline(aes(yintercept = median(perceived_benefit)), linetype = "dashed", color = "red") +
  coord_flip()



```

```{r}
library(dplyr)
perceivedbenefit %>%
  group_by(technology) %>%
  summarise(
    count = n(),
    mean = mean(perceived_benefit, na.rm = TRUE),
    sd = sd(perceived_benefit, na.rm = TRUE),
    median = median(perceived_benefit, na.rm = TRUE),
    IQR = IQR(perceived_benefit, na.rm = TRUE)
  )

```


```{r}

pairwise.wilcox.test(perceivedbenefit$perceived_benefit, perceivedbenefit$technology, p.adjust.method = "BH")


```


```{r}

# visualising the pairwaise wilcox test results. the non significant pairs are grey 

library(broom)
result <- pairwise.wilcox.test(perceivedbenefit$perceived_benefit, perceivedbenefit$technology, p.adjust.method = "BH")
tidy_result <- tidy(result)

library(ggplot2)
ggplot(tidy_result, aes(x = group1, y = group2, fill = p.value)) + 
  geom_tile(color = "white") + 
  scale_fill_gradient2(low = "green", high = "white", midpoint = 0.025, 
                       limits = c(0, 0.05), space = "Lab", 
                       name = "P-value") + 
  theme_classic() + 
  labs(x = "Technology 1", y = "Technology 2") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


```

```{r, echo=FALSE}
# Calculate median and IQR for each technology and category (risk or benefit)
summary_df_median <- long_format %>%
  group_by(technology, risk_or_benefit) %>%
  summarise(median = median(value, na.rm = TRUE),
            IQR = IQR(value, na.rm = TRUE),
            .groups = "drop")

# Order technologies by median risk
order_risk_median <- summary_df_median %>% 
  filter(risk_or_benefit == "risk") %>%
  arrange(median) %>% 
  pull(technology)

# Change the levels of factor 'technology'
summary_df_median$technology <- factor(summary_df_median$technology, levels = order_risk_median)

# Plotting the data
ggplot(summary_df_median, aes(x = technology, y = median, fill = risk_or_benefit)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = median - 0.5*IQR, ymax = median + 0.5*IQR), 
                width = 0.3, position = position_dodge(0.9)) +
  ylim(0, 5) +
  scale_fill_manual("legend", 
                    values = c("benefit" = "palegreen3", "risk" = "firebrick2"), 
                    labels = c("benefit" = "Perceived Benefit", "risk" = "Perceived Risk")) +
  labs(y = "Median Values", x = "Energy Technologies", fill = "Perceived") +
  ggtitle("Perceived risk and benefit from centrally owned energy technologies\n(Median)") +
  coord_flip()



```

```{r}

# **Perceived risk by Support for Totalitarian government**

#The following is a list of statements about governance. How strongly do you agree or disagree with each of these statements? Do you strongly disagree(1), somewhat disagree(2), neither agree nor disagree(3), somewhat agree(4) or strongly agree(5)? - It is good to have a strong leader who does not have to bother with elections.

govtrisk$grouped_total <- ifelse(govtrisk$SYSTEMTOTAL %in% c(1,2), "low", ifelse(govtrisk$SYSTEMTOTAL %in% c(4,5), "high", NA))

totalrisk2 <- govtrisk %>%
  group_by(grouped_total) %>%
  filter(grouped_total %in% c("low", "high")) %>%
  summarize_at(vars(starts_with(c("RISKY"))), list(~mean(., na.rm = TRUE), ~median(., na.rm = TRUE), ~sd(.,na.rm = TRUE),~var(.,na.rm = TRUE), ~n())) %>%
  gather(key = "technology", value = "summary", Risky_Hydro_mean, Risky_Solar_mean, Risky_Wind_mean, Risky_Nuclear_mean, Risky_Coal_mean, Risky_Gas_mean, Risky_Oil_mean, Risky_Hydro_sd, Risky_Solar_sd, Risky_Wind_sd, Risky_Nuclear_sd, Risky_Coal_sd, Risky_Gas_sd, Risky_Oil_sd, Risky_Hydro_n, Risky_Solar_n, Risky_Wind_n, Risky_Nuclear_n, Risky_Coal_n, Risky_Gas_n, Risky_Oil_n) %>%
  dplyr::select(grouped_total, technology, summary) %>%
  separate(technology, c("Risky", "var"), extra = "merge", fill = "left") %>%
  separate(var, c("technology", "meansd")) %>%
  spread(meansd,summary) %>%
  select(-Risky) %>%
  arrange(grouped_total) 

data.frame(totalrisk2)

totalrisk2 <- totalrisk2 %>%
  mutate(technology = reorder(technology, -mean))  # reorder based on -mean, to get high to low

t <- totalrisk2 %>%
  group_by(technology) %>%
  ggplot(aes(x = technology, y= mean, group = grouped_total))+
  geom_line(aes(colour = grouped_total, line = grouped_total)) +
  labs(y = "mean perceived risk", x = "energy technology", color = "Totalitarianism Value") +
  ggtitle("Q:It is good to have a strong leader who does not have to bother with\nelections.")

t



# **Perceived risk by Support for Technocratic government**

#The following is a list of statements about governance. How strongly do you agree or disagree with each of these statements? Do you strongly disagree(1), somewhat disagree(2), neither agree nor disagree(3), somewhat agree(4) or strongly agree(5)? - Experts, not the government, should make decisions according to what they think is best for the country.

govtrisk$grouped_techno <- ifelse(govtrisk$SYSTEMTECHNO %in% c(1,2), "low", ifelse(govtrisk$SYSTEMTECHNO %in% c(4,5), "high", NA))

technorisk2 <- govtrisk %>%
  group_by(grouped_techno) %>%
  filter(grouped_techno %in% c("low", "high")) %>%
  summarize_at(vars(starts_with(c("RISKY"))), list(~mean(., na.rm = TRUE), ~median(., na.rm = TRUE), ~sd(.,na.rm = TRUE),~var(.,na.rm = TRUE), ~n())) %>%
  gather(key = "technology", value = "summary", Risky_Hydro_mean, Risky_Solar_mean, Risky_Wind_mean, Risky_Nuclear_mean, Risky_Coal_mean, Risky_Gas_mean, Risky_Oil_mean, Risky_Hydro_sd, Risky_Solar_sd, Risky_Wind_sd, Risky_Nuclear_sd, Risky_Coal_sd, Risky_Gas_sd, Risky_Oil_sd, Risky_Hydro_n, Risky_Solar_n, Risky_Wind_n, Risky_Nuclear_n, Risky_Coal_n, Risky_Gas_n, Risky_Oil_n) %>%
  dplyr::select(grouped_techno, technology, summary) %>%
  separate(technology, c("Risky", "var"), extra = "merge", fill = "left") %>%
  separate(var, c("technology", "meansd")) %>%
  spread(meansd,summary) %>%
  select(-Risky) %>%
  arrange(grouped_techno) 

data.frame(technorisk2)

technorisk2 <- technorisk2 %>%
  mutate(technology = reorder(technology, -mean))  # reorder based on -mean, to get high to low

techno <- technorisk2 %>%
  group_by(technology) %>%
  ggplot(aes(x = technology, y= mean, group = grouped_techno))+
  geom_line(aes(colour = grouped_techno, line = grouped_techno)) +
  labs(y = "mean perceived risk", x = "energy technology", color = "Technocratic Value") +
  ggtitle("Q:Experts, not the government, should make decisions according to\nwhat they think is best for the country.")

techno

# **Perceived risk by Support for Religious government**

#The following is a list of statements about governance. How strongly do you agree or disagree with each of these statements? Do you strongly disagree(1), somewhat disagree(2), neither agree nor disagree(3), somewhat agree(4) or strongly agree(5)? - There should be a system governed by religious law.

govtrisk$grouped_religion <- ifelse(govtrisk$SYSTEMRELIGION %in% c(1,2), "low", ifelse(govtrisk$SYSTEMRELIGION %in% c(4,5), "high", NA))

religionrisk2 <- govtrisk %>%
  group_by(grouped_religion) %>%
  filter(grouped_religion %in% c("low", "high")) %>%
  summarize_at(vars(starts_with(c("RISKY"))), list(~mean(., na.rm = TRUE), ~median(., na.rm = TRUE), ~sd(.,na.rm = TRUE),~var(.,na.rm = TRUE), ~n())) %>%
  gather(key = "technology", value = "summary", Risky_Hydro_mean, Risky_Solar_mean, Risky_Wind_mean, Risky_Nuclear_mean, Risky_Coal_mean, Risky_Gas_mean, Risky_Oil_mean, Risky_Hydro_sd, Risky_Solar_sd, Risky_Wind_sd, Risky_Nuclear_sd, Risky_Coal_sd, Risky_Gas_sd, Risky_Oil_sd, Risky_Hydro_n, Risky_Solar_n, Risky_Wind_n, Risky_Nuclear_n, Risky_Coal_n, Risky_Gas_n, Risky_Oil_n) %>%
  dplyr::select(grouped_religion, technology, summary) %>%
  separate(technology, c("Risky", "var"), extra = "merge", fill = "left") %>%
  separate(var, c("technology", "meansd")) %>%
  spread(meansd,summary) %>%
  select(-Risky) %>%
  arrange(grouped_religion) 

data.frame(religionrisk2)

religionrisk2 <- religionrisk2 %>%
  mutate(technology = reorder(technology, -mean))  # reorder based on -mean, to get high to low

r <- religionrisk2 %>%
  group_by(technology) %>%
  ggplot(aes(x = technology, y= mean, group = grouped_religion))+
  geom_line(aes(colour = grouped_religion, line = grouped_religion)) +
  labs(y = "mean perceived risk", x = "energy technology", color = "Religious law Value") +
  ggtitle("Q:There should be a system governed by religious law.")

r
```


